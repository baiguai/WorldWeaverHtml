<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standalone Console</title>

    <!--
        Formatting notes:
        This code is formatted for indentation level folding.
        There are sections indented between comments, so that they
        remain collapsed at certain levels, to make code navigation
        and reading easier.
    -->

    <!-- Styles -->
        <style>
            body {
                background-color: black;
                color: white;
                font-family: monospace;
                margin: 0;
                display: flex;
                flex-direction: column;
                height: 100vh;
            }

            #game-interface {
                display: flex;
                flex-direction: column;
                flex: 1;
            }

            #output {
                flex: 1;
                padding: 10px;
                overflow-y: auto;
                white-space: pre-wrap;
                border-bottom: 1px solid white;
            }

            #input-container {
                display: flex;
                padding: 10px;
                background: black;
                border-top: 1px solid white;
            }

            #input {
                flex: 1;
                background: black;
                color: white;
                border: none;
                padding: 10px;
                font-size: 1rem;
                font-family: monospace;
            }

            #input:focus {
                outline: none;
            }

            /* Initially hide the admin interface */
            #admin-interface {
                display: none; /* Hide admin interface by default */
                flex: 1;
                height: 100vh;
                display: flex;
            }

            #treeview {
                width: 200px;
                border-right: 1px solid white;
                overflow-y: auto;
                padding: 10px;
                resize: horizontal;
                min-width: 100px;
                max-width: 50%;
            }

            #treeview ul {
                list-style: none;
                padding-left: 10px;
            }

            #treeview li {
                cursor: pointer;
                padding: 5px;
            }

            #details {
                flex: 1;
                padding: 10px;
            }

            #admin-input-container {
                display: none;
                padding: 10px;
                background: black;
                border-top: 1px solid white;
            }

            #admin-input {
                width: 100%;
                background: black;
                color: white;
                border: none;
                padding: 10px;
                font-size: 1rem;
                font-family: monospace;
            }

            #admin-input:focus {
                outline: none;
            }

            #editor-container {
                display: none;
                flex: 1;
                padding: 10px;
                flex-direction: column;
            }

            #editor {
                flex: 1;
                background: black;
                color: white;
                border: 1px solid white;
                padding: 10px;
                font-size: 1rem;
                font-family: monospace;
                white-space: pre;
                overflow-y: auto;
            }

            #editor-close {
                align-self: flex-end;
                cursor: pointer;
                padding: 5px;
                color: red;
            }

            .link {
                cursor: pointer;
                text-decoration: underline;
            }
        </style>
    <!-- End Styles -->
</head>
<body>
    <div id="game-interface" style="display: none;">
        <div id="output"></div>
        <div id="input-container">
            <input type="text" id="input" autofocus="">
        </div>
    </div>
    
    <div id="admin-interface" style="display: flex;">
        <div id="treeview"><ul><li data-key="game"><span style="cursor: pointer;"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g aria-label="G" id="text8654" style="font-weight:bold;font-size:3.8988px;font-family:'ITC Bauhaus';-inkscape-font-specification:'ITC Bauhaus Bold';fill:none;stroke:#8e8e8e;stroke-width:0.0142143;stroke-linejoin:bevel;paint-order:stroke fill markers"> <path d="m 2.2882142,3.5085379 c 0.4054751,0 0.7563671,-0.1208628 1.0448783,-0.3586896 V 1.9490179 H 2.1790478 v 0.428868 h 0.6666947 v 0.5770224 c -0.136458,0.070178 -0.3041063,0.1130652 -0.4912487,0.1130652 -0.565326,0 -0.9279144,-0.3781836 -0.9279144,-0.9824976 0,-0.58482 0.3391956,-0.9162179 0.9396108,-0.9162179 0.2378268,0 0.5146415,0.050684 0.7251767,0.1247616 L 3.2317237,0.90024076 C 2.9977957,0.78717557 2.7014869,0.72479477 2.3973806,0.72479477 c -0.9084204,0 -1.4971392,0.56922483 -1.4971392,1.41916313 0,0.818748 0.5536296,1.36458 1.3879728,1.36458 z" style="font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;stroke:none" id="path9293"></path> </g> </svg> Sample Game</span><ul style="display: block;"><li data-key="wj6twhnjsy8m913m34g"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> admin pass</span></li><li data-key="4ijqt5uojvhm913n248"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> game started</span></li><li data-key="die_message"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> die msg</span></li></ul></li><li data-key="player"><span style="cursor: pointer;"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g id="layer1" style="fill:#ffffff;fill-opacity:1;stroke:none" transform="matrix(0.74013018,0,0,0.74013018,0.55005776,0.55005778)"> <g aria-label="G" id="text147" style="font-weight:bold;font-size:5.4836px;font-family:'DejaVu Sans';-inkscape-font-specification:'DejaVu Sans Bold';fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.931837;stroke-linecap:round;stroke-linejoin:round"> <path id="path1202" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.245993;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="M 2.1154655,0.29958256 A 0.95769183,0.95769183 0 0 0 1.157917,1.2576116 0.95769183,0.95769183 0 0 0 1.5470861,2.0268214 C 1.0473631,2.1507604 0.63085688,2.4696209 0.63085688,3.1299481 V 3.9337508 H 3.6024763 V 3.1299481 c 0,-0.6590471 -0.4175177,-0.9788423 -0.9176706,-1.1031267 A 0.95769183,0.95769183 0 0 0 3.0734944,1.2576116 0.95769183,0.95769183 0 0 0 2.1154655,0.29958256 Z"></path> </g> </g> </svg> player</span><ul style="display: block;"><li data-key="ayqqaay4zmdm9143u3b"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> stats dice</span></li><li data-key="i4nouxuljhm91451p3"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> money dice</span></li><li data-key="sul6ikoi66m9146he5"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> life roll</span></li><li data-key="jovjjxtokr9m914bgg1"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> armor roll</span></li><li data-key="hjmswbobc19m914cdko"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> strength roll</span></li><li data-key="1fczu23k3cbm914dswe"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> intelligence roll</span></li><li data-key="fq32x27hg4sm914ek65"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> cunning roll</span></li><li data-key="qa78uu7zk7m914frsk"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> gold roll</span></li><li data-key="k3rd5lhuqemm914grvf"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> life</span></li><li data-key="zmdwl033hpmm914hoqa"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> max life</span></li><li data-key="did9rck82rm914iskh"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> armor rating</span></li><li data-key="7uxaw5bk8agm914k9vk"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> strength</span></li><li data-key="t899jq5zdfom914lkaf"><span style="cursor: pointer;"><svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"></path></svg> intelligence</span></li></ul></li><li data-key="bdu5ey7m1k5m913pjkt"><span style="cursor: pointer;"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <circle style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path17273" cx="2.1166666" cy="2.1166666" r="1.3248924"></circle> <path style="fill:none;fill-opacity:1;stroke:#8e8e8e;stroke-width:0.19686;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" d="M 1.1448412,2.1166666 H 3.0884921" id="path17275"></path> </svg> global 01</span><ul style="display: none;"><li data-key="i51aqmgrcdqm913tba1"><span style="cursor: pointer;"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="path19523" d="m 1.275162,2.0133541 -0.7057629,0.4074724 -0.70576287,0.4074724 3e-8,-0.8149449 -3e-8,-0.8149447 0.70576291,0.4074724 z" transform="translate(0.61360234,0.10331256)"></path> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers;stroke-opacity:1" d="M 1.952999,2.9316113 H 3.5563688" id="path19525"></path> </svg> stats input</span><ul style="display: none;"><li data-key="3ivbu6m1jxem913ttsh"><span style="cursor: pointer;"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g aria-label="!" id="text18965" style="font-weight:bold;font-size:4.37606px;font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;stroke-width:0.0159544;stroke-linejoin:bevel;paint-order:stroke fill markers"> <path d="m 1.9000508,2.5849076 h 0.437606 L 2.3989217,0.57629608 H 1.838786 Z m 0.214427,1.0721347 c 0.223179,0 0.3763411,-0.1619142 0.3763411,-0.3719651 0,-0.223179 -0.1531621,-0.3850933 -0.3763411,-0.3850933 -0.2231791,0 -0.3719651,0.1619143 -0.3719651,0.3850933 0,0.2100509 0.148786,0.3719651 0.3719651,0.3719651 z" id="path19468"></path> </g> </svg> stats action</span></li></ul></li><li data-key="pntabkpr54nm913v74v"><span style="cursor: pointer;"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="path19523" d="m 1.275162,2.0133541 -0.7057629,0.4074724 -0.70576287,0.4074724 3e-8,-0.8149449 -3e-8,-0.8149447 0.70576291,0.4074724 z" transform="translate(0.61360234,0.10331256)"></path> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers;stroke-opacity:1" d="M 1.952999,2.9316113 H 3.5563688" id="path19525"></path> </svg> inv input</span><ul style="display: none;"><li data-key="k73lo7us3xom913w48e"><span style="cursor: pointer;"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g aria-label="!" id="text18965" style="font-weight:bold;font-size:4.37606px;font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;stroke-width:0.0159544;stroke-linejoin:bevel;paint-order:stroke fill markers"> <path d="m 1.9000508,2.5849076 h 0.437606 L 2.3989217,0.57629608 H 1.838786 Z m 0.214427,1.0721347 c 0.223179,0 0.3763411,-0.1619142 0.3763411,-0.3719651 0,-0.223179 -0.1531621,-0.3850933 -0.3763411,-0.3850933 -0.2231791,0 -0.3719651,0.1619143 -0.3719651,0.3850933 0,0.2100509 0.148786,0.3719651 0.3719651,0.3719651 z" id="path19468"></path> </g> </svg> inv action</span></li></ul></li><li data-key="724mwcb6d5xm913xmrx"><span style="cursor: pointer;"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="path19523" d="m 1.275162,2.0133541 -0.7057629,0.4074724 -0.70576287,0.4074724 3e-8,-0.8149449 -3e-8,-0.8149447 0.70576291,0.4074724 z" transform="translate(0.61360234,0.10331256)"></path> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers;stroke-opacity:1" d="M 1.952999,2.9316113 H 3.5563688" id="path19525"></path> </svg> arm input</span><ul style="display: block;"><li data-key="w593t2zjgym913zu96"><span style="cursor: pointer;"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="path19523" d="m 1.275162,2.0133541 -0.7057629,0.4074724 -0.70576287,0.4074724 3e-8,-0.8149449 -3e-8,-0.8149447 0.70576291,0.4074724 z" transform="translate(0.61360234,0.10331256)"></path> <rect style="fill:#ffffff;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="rect20904" width="1.4300268" height="1.9852276" x="2.4454238" y="1.1240529"></rect> </svg> arm set</span></li></ul></li></ul></li></ul></div>
        <div id="details" style="display: block;">
                <p><strong>Element Type:</strong><span id="element-type-parent"><span id="element-type" class="link">attribute</span></span></p>
                <p><strong>Element Key:</strong> <span id="element-key" class="link">t899jq5zdfom914lkaf</span></p>
                <p><strong>Name:</strong> <span id="element-name" class="link">intelligence</span></p>
                <p><strong>Parent Key:</strong> <select id="parentSelect"><option value="null">No Parent</option><option value="game">Sample Game</option><option value="player" selected="">player</option><option value="wj6twhnjsy8m913m34g">admin pass</option><option value="4ijqt5uojvhm913n248">game started</option><option value="die_message">die msg</option><option value="bdu5ey7m1k5m913pjkt">global 01</option><option value="i51aqmgrcdqm913tba1">stats input</option><option value="3ivbu6m1jxem913ttsh">stats action</option><option value="pntabkpr54nm913v74v">inv input</option><option value="k73lo7us3xom913w48e">inv action</option><option value="724mwcb6d5xm913xmrx">arm input</option><option value="w593t2zjgym913zu96">arm set</option><option value="ayqqaay4zmdm9143u3b">stats dice</option><option value="i4nouxuljhm91451p3">money dice</option><option value="sul6ikoi66m9146he5">life roll</option><option value="jovjjxtokr9m914bgg1">armor roll</option><option value="hjmswbobc19m914cdko">strength roll</option><option value="1fczu23k3cbm914dswe">intelligence roll</option><option value="fq32x27hg4sm914ek65">cunning roll</option><option value="qa78uu7zk7m914frsk">gold roll</option><option value="k3rd5lhuqemm914grvf">life</option><option value="zmdwl033hpmm914hoqa">max life</option><option value="did9rck82rm914iskh">armor rating</option><option value="7uxaw5bk8agm914k9vk">strength</option></select></p>
                <p><strong>Syntax:</strong> <span id="syntax-caption" class="link">Click to Edit</span></p>
                <p><strong>Logic:</strong> <span id="logic-field" class="link">Click to View/Edit</span></p>
                <p><strong>Output:</strong> <span id="output-field" class="link">[roll:(6)&lt;&lt;[self]((stats_dice))&gt;&gt;d6]</span></p>
                <p><strong>Tags:</strong> <span id="tags-field" class="link">Click to Edit</span></p>
                <p><strong>Repeat:</strong> <span id="repeat-field-parent"><span id="repeat-field" class="link">Click to Edit</span><span></span></span></p>
                <p><strong>Active:</strong> <span><input id="element-active" type="checkbox" checked=""></span></p>
                <p><strong>Sort:</strong> <span id="sort-field" class="link">Click to Edit</span></p>
                <br>
                <p><span id="delete-element" class="link">Delete</span></p>
            </div>
        <div id="editor-container" style="display: none;">
            <div id="editor-close">X</div>
            <textarea id="editor"></textarea>
        </div>
    </div>
    <div id="admin-input-container" style="display: flex;">
        <input type="text" id="admin-input">
    </div>
    
    <script>
        let database = [];
        let currentParent = null;
        let newElementParentKey = "";
        let expandedNodes = new Set();

        // Icons
            const icoGame = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g aria-label="G" id="text8654" style="font-weight:bold;font-size:3.8988px;font-family:'ITC Bauhaus';-inkscape-font-specification:'ITC Bauhaus Bold';fill:none;stroke:#8e8e8e;stroke-width:0.0142143;stroke-linejoin:bevel;paint-order:stroke fill markers"> <path d="m 2.2882142,3.5085379 c 0.4054751,0 0.7563671,-0.1208628 1.0448783,-0.3586896 V 1.9490179 H 2.1790478 v 0.428868 h 0.6666947 v 0.5770224 c -0.136458,0.070178 -0.3041063,0.1130652 -0.4912487,0.1130652 -0.565326,0 -0.9279144,-0.3781836 -0.9279144,-0.9824976 0,-0.58482 0.3391956,-0.9162179 0.9396108,-0.9162179 0.2378268,0 0.5146415,0.050684 0.7251767,0.1247616 L 3.2317237,0.90024076 C 2.9977957,0.78717557 2.7014869,0.72479477 2.3973806,0.72479477 c -0.9084204,0 -1.4971392,0.56922483 -1.4971392,1.41916313 0,0.818748 0.5536296,1.36458 1.3879728,1.36458 z" style="font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;stroke:none" id="path9293" /> </g> </svg>`;
            const icoPlayer = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g id="layer1" style="fill:#ffffff;fill-opacity:1;stroke:none" transform="matrix(0.74013018,0,0,0.74013018,0.55005776,0.55005778)"> <g aria-label="G" id="text147" style="font-weight:bold;font-size:5.4836px;font-family:'DejaVu Sans';-inkscape-font-specification:'DejaVu Sans Bold';fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.931837;stroke-linecap:round;stroke-linejoin:round"> <path id="path1202" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.245993;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="M 2.1154655,0.29958256 A 0.95769183,0.95769183 0 0 0 1.157917,1.2576116 0.95769183,0.95769183 0 0 0 1.5470861,2.0268214 C 1.0473631,2.1507604 0.63085688,2.4696209 0.63085688,3.1299481 V 3.9337508 H 3.6024763 V 3.1299481 c 0,-0.6590471 -0.4175177,-0.9788423 -0.9176706,-1.1031267 A 0.95769183,0.95769183 0 0 0 3.0734944,1.2576116 0.95769183,0.95769183 0 0 0 2.1154655,0.29958256 Z" /> </g> </g> </svg>`;
            const icoRoom = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path id="path3110" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.128568;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="M 2.1166666,0.6755942 1.3764382,1.2733867 0.63620985,1.8711792 H 1.094196 V 3.4357827 H 3.1391372 V 1.8711792 H 3.5971234 L 2.856895,1.2733867 Z" /> <rect style="fill:#9c9c9c;fill-opacity:1;stroke:none;stroke-width:0.150738;stroke-linejoin:bevel;paint-order:stroke fill markers" id="rect12310" width="0.49860835" height="0.72685415" x="2.2512157" y="2.7089283" /> <rect style="fill:#9c9c9c;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="rect13248" width="0.47124618" height="0.46280029" x="1.540359" y="1.9300244" /> </svg>`;
            const icoAttrib = `<svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"/></svg>`;
            const icoObject = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" sodipodi:docname="object_ico.svg" inkscape:version="1.2.2 (b0a8486, 2022-12-01)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <sodipodi:namedview id="namedview38" pagecolor="#505050" bordercolor="#eeeeee" borderopacity="1" inkscape:showpageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#505050" showgrid="false" inkscape:zoom="42.382213" inkscape:cx="4.1408881" inkscape:cy="8.0104359" inkscape:window-width="1916" inkscape:window-height="1074" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg5" showguides="true"> <sodipodi:guide position="2.1166666,4.4412308" orientation="16.206024,0" id="guide328" inkscape:locked="false" /> <sodipodi:guide position="2.3785036,2.3187412" orientation="0,-1" id="guide334" inkscape:locked="false" /> <sodipodi:guide position="2.9715688,0.78298396" orientation="0,-1" id="guide336" inkscape:locked="false" /> <sodipodi:guide position="0.69898409,1.7050026" orientation="1,0" id="guide338" inkscape:locked="false" /> <sodipodi:guide position="3.5343492,2.7683155" orientation="1,0" id="guide340" inkscape:locked="false" /> <sodipodi:guide position="3.5343493,2.9508443" orientation="0,-1" id="guide352" inkscape:locked="false" /> <sodipodi:guide position="3.5343492,1.4150872" orientation="0,-1" id="guide354" inkscape:locked="false" /> <sodipodi:guide position="2.4534171,3.5829476" orientation="0,-1" id="guide1047" inkscape:locked="false" /> </sodipodi:namedview> <defs id="defs2" /> <path style="fill:#ffffff;stroke:none;stroke-width:0.185208;stroke-linecap:round;stroke-dasharray:none;paint-order:stroke fill markers;fill-opacity:1" d="M 2.1166666,0.65038564 3.5343491,1.282489 v 1.5357571 l -1.4176825,0.63832 -1.4176825,-0.63832 V 1.282489 Z" id="path1063" /> <path style="fill:#ffffff;stroke:none;stroke-width:0.185208;stroke-linecap:round;stroke-dasharray:none;paint-order:stroke fill markers;fill-opacity:1" d="M 2.1166666,0.65038564 3.5343491,1.282489 v 1.5357571 l -1.4176825,0.63832 -1.4176825,-0.63832 V 1.282489 Z" id="path2373" /> <path style="fill:none;fill-opacity:1;stroke:#8e8e8e;stroke-width:0.18520833;stroke-linecap:butt;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers;stroke-linejoin:bevel" d="M 0.6989841,1.282489 2.1166666,1.9145921 3.5343491,1.282489" id="path5018" /> <path style="fill:none;fill-opacity:1;stroke:#8e8e8e;stroke-width:0.185208;stroke-linecap:butt;stroke-linejoin:bevel;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="M 2.1166666,1.9145921 V 3.4503492" id="path6370" /> </svg>`;
            const icoMessage = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.165345;stroke-linejoin:bevel;paint-order:stroke fill markers" id="rect15482" width="1.9418752" height="2.6706309" x="1.1457291" y="0.78135115" /> <path style="fill:none;fill-opacity:1;stroke:#939393;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" d="M 1.5488185,1.5004032 H 2.6845148" id="path15542" /> <path style="fill:none;fill-opacity:1;stroke:#939393;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" d="M 1.5488185,2.1166666 H 2.6845148" id="path16407" /> </svg>`;
            const icoMove = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path16515" d="m 2.8393816,2.1992004 -1.0961629,0.6328699 -1.09616284,0.6328699 0,-1.2657398 0,-1.26573985 1.09616294,0.63286995 z" transform="translate(0.37344791,-0.08253377)" /> </svg>`;
            const icoAttack = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g id="g17152" transform="rotate(45,2.1018541,2.1105311)"> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.198799;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="rect17051" width="0.73135507" height="2.6537266" x="1.7509891" y="0.90471673" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path17125" d="m 2.1166666,0.3620086 0.1814879,0.31434643 0.181488,0.31434643 -0.3629759,-1e-8 -0.362976,-10e-9 0.181488,-0.31434641 z" transform="translate(7.521059e-8,-0.07733837)" /> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="rect17127" width="2.029305" height="0.49957958" x="1.1020142" y="2.3346605" /> </g> </svg>`;
            const icoGlobal = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <circle style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path17273" cx="2.1166666" cy="2.1166666" r="1.3248924" /> <path style="fill:none;fill-opacity:1;stroke:#8e8e8e;stroke-width:0.19686;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" d="M 1.1448412,2.1166666 H 3.0884921" id="path17275" /> </svg>`;
            const icoAction = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g aria-label="!" id="text18965" style="font-weight:bold;font-size:4.37606px;font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;stroke-width:0.0159544;stroke-linejoin:bevel;paint-order:stroke fill markers"> <path d="m 1.9000508,2.5849076 h 0.437606 L 2.3989217,0.57629608 H 1.838786 Z m 0.214427,1.0721347 c 0.223179,0 0.3763411,-0.1619142 0.3763411,-0.3719651 0,-0.223179 -0.1531621,-0.3850933 -0.3763411,-0.3850933 -0.2231791,0 -0.3719651,0.1619143 -0.3719651,0.3850933 0,0.2100509 0.148786,0.3719651 0.3719651,0.3719651 z" id="path19468" /> </g> </svg>`;
            const icoInput = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="path19523" d="m 1.275162,2.0133541 -0.7057629,0.4074724 -0.70576287,0.4074724 3e-8,-0.8149449 -3e-8,-0.8149447 0.70576291,0.4074724 z" transform="translate(0.61360234,0.10331256)" /> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers;stroke-opacity:1" d="M 1.952999,2.9316113 H 3.5563688" id="path19525" /> </svg>`;
            const icoLogic = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g aria-label="?" id="text20223" style="font-weight:bold;font-size:3.75627px;font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;stroke-width:0.0136947;stroke-linejoin:bevel;paint-order:stroke fill markers"> <path d="m 1.8931671,2.5486401 h 0.47329 V 2.3983893 c 0,-0.3042579 0.5446591,-0.4432398 0.5446591,-0.9766302 0,-0.4019209 -0.3080141,-0.6460784 -0.8151106,-0.6460784 -0.2629389,0 -0.5409028,0.0676129 -0.7737916,0.18405722 L 1.4349021,1.3240961 c 0.180301,-0.086394 0.3606019,-0.1277132 0.5371466,-0.1277132 0.277964,0 0.4394836,0.1089319 0.4394836,0.2892328 0,0.319283 -0.5183652,0.47329 -0.5183652,0.9127736 z m 0.236645,0.9090173 c 0.1878135,0 0.3192829,-0.1352257 0.3192829,-0.3192829 0,-0.1953261 -0.1277132,-0.3305518 -0.3192829,-0.3305518 -0.1915698,0 -0.3230392,0.1352257 -0.3230392,0.3305518 0,0.1840572 0.1352257,0.3192829 0.3230392,0.3192829 z" id="path20755" /> </g> </svg>`;
            const icoInject = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <text xml:space="preserve" style="font-weight:bold;font-size:5.9418px;font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.0216628;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" x="0.3608638" y="4.0744905" id="text20814"><tspan id="tspan20812" style="stroke-width:0.0216628" x="0.3608638" y="4.0744905">+</tspan></text> </svg>`;
            const icoSet = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="path19523" d="m 1.275162,2.0133541 -0.7057629,0.4074724 -0.70576287,0.4074724 3e-8,-0.8149449 -3e-8,-0.8149447 0.70576291,0.4074724 z" transform="translate(0.61360234,0.10331256)" /> <rect style="fill:#ffffff;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="rect20904" width="1.4300268" height="1.9852276" x="2.4454238" y="1.1240529" /> </svg>`;

        // Global Vars
            const output = document.getElementById("output");
            const input = document.getElementById("input");
            const adminInput = document.getElementById("admin-input");
            const gameInterface = document.getElementById("game-interface");
            const adminInterface = document.getElementById("admin-interface");
            const adminInputContainer = document.getElementById("admin-input-container");
            const treeview = document.getElementById("treeview");
            const details = document.getElementById("details");
            const editor = document.getElementById("editor");
            const editorClose = document.getElementById("editor-close");
            const elementTypes = [
                "action", "attack", "attribute", "custom", "dev_note", "enter_message", "global", "injection",
                "input", "link", "logic", "message", "move", "navigation", "nothing", "npc", "object",
                "room", "set", "travel"
            ];


        function createNewElement(elementKey, elementType, name, doLogging, doShowDetails)
        {
            if (elementKey == "")
            {
                elementKey = getGuid();
            }

            let entry = {
                ElementType: elementType,
                ElementKey: elementKey,
                Name: name,
                ParentKey: currentParent,
                Syntax: "",
                Logic: "",
                Output: "",
                Tags: "",
                Repeat: "",
                RepeatIndex: "",
                Template: "",
                Active: "true",
                Sort: ""
            };

            database.push(entry);

            if (entry.ParentKey) {
                newElementParentKey = entry.ParentKey;
            }

            if (doShowDetails)
            {
                showDetails(entry);
            }

            buildTreeView();

            if (doLogging == true)
            {
                logAdminMessage("Added: " + entry.Name);
            }
        }

        function updateElementType(item, newType) {
            item.ElementType = newType;
            showDetails(item);
        }


        function logMessage(message) {
            output.innerHTML = message + "<br>";
            output.scrollTop = output.scrollHeight;
        }
        function logAdminMessage(message) {
            details.innerHTML = message + "<br>";
            details.scrollTop = output.scrollHeight;
        }

        function getGuid() {
            return Math.random().toString(36).substring(2) + (new Date()).getTime().toString(36);
        }

        function processInput(command) {
            if (command === "!_admin") {
                enterAdminMode();
                return;
            }
        }

        function processAdminInput(command) {
            if (command === "exit") {
                exitAdminMode();
            }

            if (command.startsWith("add ")) {
                createNewElement("", "", command.substring(4), true, true);
            } else if (command === "save") {
                saveFile();
            } else {
                logMessage("Unknown command: " + command);
            }
        }

        function saveFile() {
            let htmlDoc = document.documentElement.cloneNode(true);
            htmlDoc.querySelector("#output").innerHTML = ""; // Clear output before saving
            let htmlContent = "<!DOCTYPE html>" + htmlDoc.outerHTML;
            htmlContent = htmlContent.replace(/let database = \[.*?\];/, `let database = ${JSON.stringify(database)};`);
            let blob = new Blob([htmlContent], { type: "text/html" });
            let a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "console.html";
            a.click();
        }

        function enterAdminMode() {
            gameInterface.style.display = "none";
            adminInterface.style.display = "flex";  // Show admin interface
            adminInputContainer.style.display = "flex";  // Show admin input field
            input.value = "";
            buildTreeView();
            adminInput.focus();  // Focus the admin input field
        }

        function exitAdminMode() {
            gameInterface.style.display = "flex";
            adminInterface.style.display = "none"; // Hide admin interface
            adminInputContainer.style.display = "none"; // Hide admin input field
            adminInput.value = "";
            input.focus();  // Focus the game input field
        }

        function buildTreeView() {
            // Save the currently expanded nodes
            expandedNodes.clear();
            document.querySelectorAll("#treeview ul").forEach(ul => {
                if (ul.style.display === "block") {
                    let parentLi = ul.closest("li");
                    if (parentLi && parentLi.dataset.key) {
                        expandedNodes.add(parentLi.dataset.key);
                    }
                }
            });

            if (newElementParentKey) {
                expandedNodes.add(newElementParentKey);
                newElementParentKey = "";
            }

            treeview.innerHTML = "";
            let rootItems = database.filter(item => item.ParentKey === null);
            let ul = document.createElement("ul");
            rootItems.forEach(item => ul.appendChild(createTreeNode(item)));
            treeview.appendChild(ul);
        }

        function createTreeNode(item) {
            let li = document.createElement("li");
            li.dataset.key = item.ElementKey; // Store the ElementKey as a dataset

            let span = document.createElement("span");
            span.style.cursor = "pointer";

            // Determine which icon to use
            let iconHTML = "";
            switch (item.ElementType)
            {
                case "game":
                    iconHTML = icoGame;
                    break;

                case "player":
                case "npc":
                    iconHTML = icoPlayer;
                    break;

                case "room":
                    iconHTML = icoRoom;
                    break;

                case "object":
                    iconHTML = icoObject;
                    break;

                case "message":
                case "dev_note":
                case "enter_message":
                    iconHTML = icoMessage;
                    break;

                case "action":
                    iconHTML = icoAction;
                    break;

                case "move":
                case "navigation":
                case "travel":
                    iconHTML = icoMove;
                    break;

                case "attack":
                    iconHTML = icoAttack;
                    break;

                case "global":
                    iconHTML = icoGlobal;
                    break;

                case "input":
                    iconHTML = icoInput;
                    break;

                case "logic":
                    iconHTML = icoLogic;
                    break;

                case "injection":
                case "link":
                    iconHTML = icoInject;
                    break;

                case "set":
                    iconHTML = icoSet;
                    break;

                default:
                    iconHTML = icoAttrib;
                    break;
            }

            // Set the inner HTML with the icon and text
            span.innerHTML = `${iconHTML} ${item.Name}`;

            span.addEventListener("click", (event) => {
                event.stopPropagation();
                showDetails(item);
                let childUl = li.querySelector("ul");
                if (childUl) {
                    let isExpanded = childUl.style.display === "block";
                    childUl.style.display = isExpanded ? "none" : "block";

                    if (isExpanded) {
                        expandedNodes.delete(item.ElementKey);
                    } else {
                        expandedNodes.add(item.ElementKey);
                    }
                }
            });

            li.appendChild(span);

            let children = database.filter(child => child.ParentKey === item.ElementKey);
            if (children.length > 0) {
                children.sort((a, b) => parseInt(a.Sort) - parseInt(b.Sort));

                let ul = document.createElement("ul");
                ul.style.display = expandedNodes.has(item.ElementKey) ? "block" : "none";
                children.forEach(child => ul.appendChild(createTreeNode(child)));
                li.appendChild(ul);
            }

            return li;
        }

        function isSpecialSyntax(str) {
            str = str.trim(); // Ensure no leading/trailing spaces
            const pattern = /^\[[a-zA-Z0-9_]+\]\(\([a-zA-Z0-9_]+\)\)$/;
            const result = pattern.test(str);

            return result;
        }

        function escapeSpecialChars(str) {
            return str
                .replace(/[-\/\\^$+?.()|[\]{}]/g, "\\$&") // Escape special regex characters
                .replace(/\*/g, ".*"); // Convert * to .*
        }

        function showEditor(item, currentField) {
            document.getElementById("details").style.display = "none";
            document.getElementById("editor-container").style.display = "flex";
            const btn = document.getElementById("editor-close");

            switch (currentField)
            {
                case "logic":
                    if (item.Logic == null)
                    {
                        editor.value = "";
                    }
                    else
                    {
                        editor.value = item.Logic;
                    }
                    break;
                case "output":
                    if (item.Output == null)
                    {
                        editor.value = "";
                    }
                    else
                    {
                        editor.value = item.Output;
                    }
                    break;
            }
            editor.focus();

            editor.addEventListener("keydown", function(event) {
                if (event.key === "Escape") {
                    switch (currentField)
                    {
                        case "logic":
                            alert("Setting logic to: " + editor.value);
                            item.Logic = editor.value;
                            break;
                        case "output":
                            alert("Setting output to: " + editor.value);
                            item.Output = editor.value;
                            break;
                    }
                    closeEditor(item);
                }
            });
            btn.addEventListener("click", function(event) {
                switch (currentField)
                {
                    case "logic":
                        item.Logic = editor.value;
                        break;
                    case "output":
                        item.Output = editor.value;
                        break;
                }
                closeEditor(item);
            });
        }

        function closeEditor(item) {
            document.getElementById("details").style.display = "block";
            document.getElementById("editor-container").style.display = "none";
            showDetails(item);
            adminInput.focus();  // Focus the admin input field

            editor.replaceWith(editor.cloneNode(true));
            btn.replaceWith(btn.cloneNode(true));
        }

        // !@! details
        function showDetails(item) {
            currentParent = item.ElementKey;
            
            let parentDropdown = `<select id="parentSelect">`;
            parentDropdown += `<option value="null" ${item.ParentKey === null ? "selected" : ""}>No Parent</option>`;
            database.forEach(otherItem => {
                if (otherItem.ElementKey !== item.ElementKey) {
                    parentDropdown += `<option value="${otherItem.ElementKey}" ${item.ParentKey === otherItem.ElementKey ? "selected" : ""}>${otherItem.Name}</option>`;
                }
            });
            parentDropdown += `</select>`;

            details.innerHTML = `
                <p><strong>Element Type:</strong><span id="element-type-parent"><span id="element-type" class="link">${item.ElementType || "Click to Edit"}</span></span></p>
                <p><strong>Element Key:</strong> <span id="element-key" class="link">${item.ElementKey}</span></p>
                <p><strong>Name:</strong> <span id="element-name" class="link">${item.Name || "Click to Edit"}</span></p>
                <p><strong>Parent Key:</strong> ${(item.ElementType != "game") ? parentDropdown : ""}</p>
                <p><strong>Syntax:</strong> <span id="syntax-caption" class="link">${item.Syntax || "Click to Edit"}</span></p>
                <p><strong>Logic:</strong> <span id="logic-field" class="link">${item.Logic || "Click to View/Edit"}</span></p>
                <p><strong>Output:</strong> <span id="output-field" class="link">${(item.Output && item.Output.length > 100) ? item.Output.substring(0, 100)+"..." : item.Output || "Click to View/Edit"}</span></p>
                <p><strong>Tags:</strong> <span id="tags-field" class="link">${item.Tags || "Click to Edit"}</span></p>
                <p><strong>Repeat:</strong> <span id="repeat-field-parent"><span id="repeat-field" class="link">${item.Repeat || "Click to Edit"}</span><span></p>
                <p><strong>Active:</strong> <span><input id="element-active" type="checkbox" ${(item.Active === "true") ? "checked" : ""} /></span></p>
                <p><strong>Sort:</strong> <span id="sort-field" class="link">${item.Sort || "Click to Edit"}</span></p>
                <br />
                <p><span id="delete-element" class="link">Delete</span></p>
            `;

            document.getElementById("element-active").addEventListener("change", function() {
                alert(document.getElementById("element-active").checked);
                if (document.getElementById("element-active").checked) {
                    item.Active = "true";
                } else {
                    item.Active = "false";
                }
            });

            // Handle inline editing for ElementKey
            document.getElementById("element-key").addEventListener("click", function() {
                let inputField = document.createElement("input");
                inputField.type = "text";
                inputField.value = item.ElementKey;
                inputField.style = "width: 200px";
                inputField.select();

                inputField.addEventListener("keypress", function(event) {
                    if (event.key === "Enter") {
                        let newKey = inputField.value.trim();

                        if (newKey == "")
                        {
                            newKey = getGuid();
                        }

                        newKey = newKey.replace(" ", "_");
                        
                        if (newKey && !database.some(entry => entry.ElementKey === newKey)) {
                            // Update ElementKey in the database
                            item.ElementKey = newKey;
                            buildTreeView(); // Rebuild tree view
                        }
                        
                        // Restore original ElementKey if not unique
                        showDetails(item);
                    }
                });

                inputField.addEventListener("keydown", function(event) {
                    if (event.key === "Escape") {
                        showDetails(item);
                    }
                });

                this.replaceWith(inputField);
                inputField.focus();
            });

            function showEditField(currItem, fieldName)
            {
                let parent = null;
                let textField = null;
                let inputField = document.createElement("input");
                inputField.type = "text";

                switch(fieldName)
                {
                    case "name":
                        inputField.value = item.Name;
                        inputField.style = "width: 200px";
                        break;
                    case "sort":
                        inputField.type = "number";
                        inputField.value = item.Sort;
                        inputField.style = "width: 50px";
                        break;
                    case "tags":
                        inputField.value = item.Tags;
                        inputField.style = "width: 500px";
                        break;
                    case "repeat":
                        inputField = document.createElement("select");
                        const options = ["none", "random", "repeat", "other"];
                        options.forEach(option => {
                            let opt = document.createElement("option");
                            opt.value = option;
                            opt.textContent = option;
                            inputField.appendChild(opt);
                        });
                        inputField.value = item.Repeat;
                        parent = document.getElementById("repeat-field-parent");
                        
                        textField = document.createElement("input");
                        textField.type = "text";
                        textField.style.width = "100px";
                        
                        inputField.addEventListener("change", function() {
                            if (inputField.value === "other") {
                                if (parent) {
                                    parent.replaceChild(textField, inputField); // Replace dropdown with textbox
                                }
                                textField.value = item.Repeat;
                                textField.focus();
                                textField.select();

                                textField.addEventListener("keydown", function(event) {
                                    if (event.key === "Enter") {
                                        item.Repeat = textField.value.trim();
                                        buildTreeView();
                                        showDetails(item);
                                        return;
                                    }
                                    if (event.key === "Escape") {
                                        showDetails(item);
                                    }
                                });
                            } else {
                                item.Repeat = inputField.value;
                                buildTreeView();
                                showDetails(item);
                                return;
                            }
                        });
                        break;
                    case "type":
                        if (item.ElementType === "game" || item.ElementType === "player") {
                            showDetails(item);
                        }
                        inputField = document.createElement("select");
                        inputField.style.width = "200px";
                        elementTypes.forEach(option => {
                            let opt = document.createElement("option");
                            opt.value = option;
                            opt.textContent = option;
                            inputField.appendChild(opt);
                        });
                        inputField.value = item.ElementType;
                        parent = document.getElementById("element-type-parent");
                        
                        textField = document.createElement("input");
                        textField.type = "text";
                        textField.style.width = "200px";
                        
                        inputField.addEventListener("change", function() {
                            if (inputField.value === "custom") {
                                if (parent) {
                                    parent.replaceChild(textField, inputField); // Replace dropdown with textbox
                                }
                                textField.value = item.ElementType;
                                textField.focus();
                                textField.select();

                                textField.addEventListener("keydown", function(event) {
                                    if (event.key === "Enter") {
                                        item.ElementType = textField.value.trim();
                                        buildTreeView();
                                        showDetails(item);
                                        return;
                                    }
                                    if (event.key === "Escape") {
                                        showDetails(item);
                                    }
                                });
                            } else {
                                item.ElementType = inputField.value;
                                buildTreeView();
                                showDetails(item);
                                return;
                            }
                        });
                        break;
                }

                try {
                    inputField.select();
                }
                catch(err) {
                    // select not possible - likely due to it being a drop down
                }

                inputField.addEventListener("keypress", function(event) {
                    if (event.key === "Enter") {

                        switch(fieldName)
                        {
                            case "name":
                                item.Name = inputField.value.trim();
                                break;
                            case "sort":
                                item.Sort = inputField.value.trim();
                                break;
                            case "tags":
                                item.Tags = inputField.value.trim();
                                break;
                            case "repeat":
                                item.Repeat = inputField.value === "other" ? textField.value.trim() : inputField.value;
                                break;
                            case "type":
                                item.ElementType = inputField.value === "custom" ? textField.value.trim() : inputField.value;
                                break;
                        }

                        buildTreeView();
                        showDetails(item);
                    }
                });

                inputField.addEventListener("keydown", function(event) {
                    if (event.key === "Escape") {
                        showDetails(item);
                    }
                });

                currItem.replaceWith(inputField);
                inputField.focus();
            }

            // !@! delete
            function deleteElement(elementKey) {
                // Find all children of the element
                let children = database.filter(el => el.ParentKey === elementKey);

                // Recursively delete each child first
                for (let child of children) {
                    deleteElement(child.ElementKey);
                }

                // Now remove the element itself
                let index = database.findIndex(el => el.ElementKey === elementKey);
                if (index !== -1) {
                    database.splice(index, 1);
                }
            }

            // Handle inline editing for ElementType
            document.getElementById("element-type").addEventListener("click", function() {
                showEditField(this, "type");
            });

            // Handle inline editing for ElementName
            document.getElementById("element-name").addEventListener("click", function() {
                showEditField(this, "name");
            });

            // Handle inline editing for Tags
            document.getElementById("tags-field").addEventListener("click", function() {
                showEditField(this, "tags");
            });

            // Handle inline editing for Sort
            document.getElementById("sort-field").addEventListener("click", function() {
                showEditField(this, "sort");
            });

            // Handle inline editing for Repeat
            document.getElementById("repeat-field").addEventListener("click", function() {
                showEditField(this, "repeat");
            });

            // Add event listener for syntax caption click
            document.getElementById("syntax-caption").addEventListener("click", function() {
                let inputField = document.createElement("input");
                inputField.type = "text";
                inputField.value = item.Syntax || "";
                inputField.style = "width: 400px";
                inputField.select();
                inputField.addEventListener("keypress", function(event) {
                    if (event.key === "Enter") {
                        let inputText = inputField.value.trim();
                        if (inputText) {
                            try {
                                if (inputText.indexOf("(?i)") !== -1) {
                                    showDetails(item);
                                    return;
                                }

                                // If input is special syntax, store it as-is and exit
                                if (isSpecialSyntax(inputText)) {
                                    item.Syntax = inputText;
                                    showDetails(item);
                                    return; // Exit event listener
                                }

                                // Otherwise, process normally (escape and wildcard handling)
                                let escapedInput = inputText
                                    .split("|")
                                    .map(part => part.trim())
                                    .map(part => escapeSpecialChars(part)) // Escape regex special characters
                                    .join("|");

                                // Construct the regex string
                                let regexString = `\\b(${escapedInput})\\b`; // Match whole words

                                // Store the regex string with case-insensitive flag
                                item.Syntax = `/(?i)${regexString}/`;

                                // Log for debugging
                                console.log("Escaped Regex Input:", escapedInput);
                                console.log("Regex String:", item.Syntax);

                                showDetails(item); // Update details view
                            } catch (error) {
                                alert("Error generating regex: " + error.message);
                            }
                        }
                    }
                });
                inputField.addEventListener("keydown", function(event) {
                    if (event.key === "Escape") {
                        showDetails(item);
                    }
                });

                // Replace the caption with the input field
                this.replaceWith(inputField);
                inputField.focus();  // Focus on the input field
            });

            // Update parent key when selection changes
            if (document.getElementById("parentSelect")) {
                document.getElementById("parentSelect").addEventListener("change", function() {
                    let newParentKey = this.value === "null" ? null : this.value;
                    if (item.ParentKey !== newParentKey) {
                        item.ParentKey = newParentKey;
                        buildTreeView(); // Rebuild the tree view after the parent key change
                    }
                });
            }

            document.getElementById("logic-field").addEventListener("click", function() {
                showEditor(item, "logic");
            });

            document.getElementById("output-field").addEventListener("click", function() {
                showEditor(item, "output");
            });

            // Handle delete
            document.getElementById("delete-element").addEventListener("click", function() {
                deleteElement(item.ElementKey);
                buildTreeView();
                details.innerHTML = "Select an item to see details.";
            });

            adminInput.focus();  // Focus the admin input field
        }


        // Events
        input.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                let command = input.value.trim();
                if (command) {
                    processInput(command);
                }
                input.value = "";
            }
        });
        
        adminInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                let command = adminInput.value.trim();
                if (command) {
                    processAdminInput(command);
                }
                adminInput.value = "";
            }
        });


        // Ensure admin interface is hidden on load
        window.onload = function() {
            gameInterface.style.display = "flex";
            output.innerHTML = "Game Output Will Be Here";
            adminInterface.style.display = "none";
            adminInputContainer.style.display = "none";

            // Ensure the database is not overwritten if it was injected from a saved file
            if (!Array.isArray(database) || database.length === 0) {
                database = [];
                createNewElement("game", "game", "Game", false, false);
                createNewElement("player", "player", "Player", false, false);
            }

            buildTreeView();
            input.focus();  // Focus the admin input field
        };
    </script>



</body></html>
