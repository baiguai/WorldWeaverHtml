<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorldWeaver</title>

    <!--
        Formatting notes:
        This code is formatted for indentation level folding.
        There are sections indented between comments, so that they
        remain collapsed at certain levels, to make code navigation
        and reading easier.


        Sample Game Notes:
        ------------------------------------------------------------------------

        ROOMS:
        - Gold Room
        - Putting
        - Fight
        - Arming
        - Npc Follow
        - Npc Path
        - Tests Room
        - Output Logic Test 01
        - Dev Note
        - Conversation Room
        - Die Room
        - Spawn Room
        - Ammo Room

    -->

    <!-- Styles -->
        <style>
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }

            body {
                background-color: black;
                color: white;
                font-family: monospace;
                display: flex;
                flex-direction: column;
                height: 100dvh; /* better on mobile than 100vh */
                overflow: hidden;
            }

            #game-interface {
                display: flex;
                flex-direction: column;
                flex: 1;
                min-height: 0; /* Allows flex children to shrink properly */
            }

            #output {
                flex: 1;
                padding: 10px;
                overflow-y: auto;
                white-space: pre-wrap;
                border-bottom: 1px solid white;
                min-height: 0;
            }

            #input-container {
                display: flex;
                padding: 10px;
                background: black;
                border-top: 1px solid white;
            }

            #input {
                flex: 1;
                background: black;
                color: white;
                border: none;
                padding: 10px;
                font-size: 1rem;
                font-family: monospace;
            }

            #input:focus {
                outline: none;
            }

            .link {
                cursor: pointer;
                text-decoration: underline;
            }
        </style>
    <!-- End Styles -->
</head>
<body>
    <div id="game-interface" style="display: none;">
        <div id="output"></div>
        <div id="input-container">
            <input type="text" id="input" autofocus="">
        </div>
    </div>
    <div id="fight-interface" style="display: none; flex-direction: column; flex: 1; padding: 20px; position: relative;">
        <div style="position: absolute; top: 20px; left: 20px;">
            <div>Player Life: <span id="player-life">0</span></div>
            <div>Enemy Life: <span id="enemy-life">0</span></div>
        </div>

        <div id="fight-intro" style="
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1.6em;
            text-align: center;
            z-index: 20;
        ">
        </div>

        <div id="fight-message" style="
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.5em;
            text-align: center;
            z-index: 10;
        ">
        </div>

        <div style="flex: 1; display: flex; justify-content: center; align-items: center;">
            <div style="margin-right: 50px;">
<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="24mm" height="48mm" viewBox="0 0 24 48" version="1.1" id="svg130" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><defs id="defs127" /><g id="layer1"><path style="fill:#ffffff;stroke-width:0.0108946;fill-opacity:1" d="M 9.9604001,38.69619 C 9.1735285,38.629484 8.4623604,38.17153 8.0843307,37.488105 7.9507341,37.24658 7.870335,37.011109 7.8200355,36.714041 7.8017565,36.606089 7.8004786,36.372934 7.7973387,32.574079 l -0.00333,-4.025568 -1.4102125,-1.127595 -1.4102126,-1.127595 0.00318,-1.710457 c 0.00338,-1.820078 0.00238,-1.781662 0.056602,-2.168033 0.1429605,-1.018659 0.5499296,-2.002058 1.1722421,-2.832605 0.8195195,-1.093743 1.9706849,-1.887415 3.2876982,-2.266707 0.092367,-0.0266 0.1692362,-0.04966 0.1708214,-0.05125 0.00158,-0.0016 -0.04911,-0.03224 -0.1126549,-0.06811 -0.9459878,-0.534086 -1.638575,-1.430681 -1.901845,-2.462049 -0.09383,-0.367586 -0.1212933,-0.594871 -0.1211102,-1.002307 1.525e-4,-0.336912 0.013863,-0.486067 0.071107,-0.773519 0.2291196,-1.150525 0.9535944,-2.135622 1.9905447,-2.70662 0.4477091,-0.246532 0.9425221,-0.4021994 1.4783391,-0.4650843 0.208138,-0.024428 0.663432,-0.024428 0.871571,0 0.660553,0.077524 1.244326,0.2908173 1.781273,0.6508233 1.348343,0.904022 2.004513,2.502753 1.683019,4.100603 -0.22342,1.110414 -0.941096,2.090095 -1.947257,2.658153 -0.06354,0.03588 -0.114249,0.06652 -0.112675,0.06809 0.0016,0.0016 0.0858,0.02703 0.187163,0.05657 0.851626,0.248175 1.600864,0.64847 2.292414,1.224765 0.197027,0.164191 0.577186,0.542335 0.740962,0.737037 0.779499,0.926689 1.263046,2.014057 1.415711,3.183554 0.04772,0.365587 0.0475,0.356369 0.05108,2.122134 l 0.0035,1.70501 -1.356182,1.083526 -1.356183,1.083526 -9e-6,4.004269 c -6e-6,2.579841 -0.0039,4.0469 -0.01089,4.12411 -0.09012,0.992235 -0.817878,1.817908 -1.809776,2.05328 -0.256853,0.06095 -0.191317,0.05882 -1.87805,0.06106 -0.856863,0.0011 -1.605543,-0.002 -1.6637348,-0.0069 z" id="path266" /></g></svg>
            </div>
            <div style="margin-left: 50px;">
<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="24mm" height="48mm" viewBox="0 0 24 48" version="1.1" id="svg130" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><defs id="defs127" /><g id="layer1"><path style="fill:#ffffff;stroke-width:0.0404355;fill-opacity:1" d="m 2.4287764,35.493786 0.00823,-0.960343 0.7986009,-0.01096 0.7986008,-0.01096 V 33.62279 32.734064 h 0.626095 0.6260953 l 0.01145,-8.380254 0.01145,-8.380255 0.090076,-0.26283 C 5.708615,14.808398 6.5057076,14.151126 7.3987593,14.062059 l 0.2948604,-0.02941 0.011162,-0.616641 0.011162,-0.616641 h 1.0704875 1.070487 v -0.62675 -0.62675 h 2.1430808 2.143081 v 0.62675 0.62675 h 1.070487 1.070487 l 0.01116,0.616641 0.01116,0.616641 0.280694,0.02774 c 0.908081,0.08973 1.700375,0.738819 2.014441,1.650337 l 0.09056,0.26283 0.01076,8.380255 0.01076,8.380254 h 0.626096 0.626095 v 0.888726 0.888726 l 0.7986,0.01096 0.798601,0.01096 0.0082,0.960343 0.0082,0.960343 H 20.004275 18.42917 v -0.970452 -0.970452 h -1.43546 -1.435459 v -1.152411 -1.152411 h -0.424209 -0.424209 l -0.01047,2.092536 -0.01047,2.092536 -1.08165,0.01077 -1.081649,0.01077 v -2.103306 -2.103305 h -0.525661 -0.525661 v 2.103305 2.103306 l -1.08165,-0.01077 -1.0816489,-0.01077 -0.010473,-2.092536 -0.010473,-2.092536 H 8.8658849 8.4416762 v 1.152411 1.152411 H 7.0062165 5.5707567 v 0.970452 0.970452 H 3.9956514 2.4205461 Z M 10.82737,25.341148 c 0.0158,-0.23176 0.03735,-0.309004 0.09871,-0.353811 0.115072,-0.08404 2.073205,-0.08404 2.188277,0 0.06136,0.04481 0.08291,0.122051 0.09871,0.353811 l 0.02022,0.296488 0.602558,0.01122 0.602557,0.01122 -0.02539,-0.357651 c -0.04176,-0.588281 -0.238172,-1.077936 -0.521921,-1.301133 -0.05945,-0.04676 -0.195383,-0.125322 -0.302077,-0.174578 -0.188224,-0.08689 -0.234869,-0.08955 -1.569677,-0.08955 h -1.375689 l -0.261948,0.12977 c -0.298081,0.147669 -0.4563327,0.323463 -0.5906901,0.656167 -0.1371612,0.339646 -0.2294693,1.028067 -0.1486829,1.108854 0.015411,0.01541 0.2838013,0.02299 0.596423,0.01685 l 0.568404,-0.01117 z M 9.7356117,20.461894 V 19.956451 H 8.9875552 8.2394988 v 0.505443 0.505444 h 0.7480564 0.7480565 z m 6.0653233,0 v -0.505443 h -0.748057 -0.748056 v 0.505443 0.505444 h 0.748056 0.748057 z" id="path6103" /></g></svg>
            </div>
        </div>

        <div style="display: flex; justify-content: center; gap: 20px; margin-top: 20px;">
            <button onclick="attackEnemy()">Attack</button>
            <button onclick="exitFight()">Flee</button>
        </div>
    </div>

    <script>
        // !@! Database
        let database = [
  {"ElementType":"attribute","ElementKey":"axa98cvapsmboo8ezo","Name":"","ParentKey":"zw621c5irqmboo8ezo","Syntax":"","Logic":"","Output":"admin","Tags":"!_adminpass","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"attribute","ElementKey":"xdqjvzzm36mboo8ezp","Name":"","ParentKey":"zw621c5irqmboo8ezo","Syntax":"","Logic":"","Output":"sample game","Tags":"!_filename","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"attribute","ElementKey":"46m4pedzbaumboo8ezp","Name":"","ParentKey":"zw621c5irqmboo8ezo","Syntax":"","Logic":"","Output":"\nI don't understand what you are trying to do.","Tags":"!_error","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"attribute","ElementKey":"5l8liw43dzvmboo8ezp","Name":"","ParentKey":"zw621c5irqmboo8ezo","Syntax":"","Logic":"","Output":"look","Tags":"!_defact","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"attribute","ElementKey":"yr9prz0c83bmboo8ezp","Name":"","ParentKey":"zw621c5irqmboo8ezo","Syntax":"","Logic":"","Output":"4","Tags":"!_easingrounds","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"message","ElementKey":"5915azl3d0gmboo8ezp","Name":"","ParentKey":"zw621c5irqmboo8ezo","Syntax":"","Logic":"","Output":"\nYou have died.","Tags":"!_die","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"message","ElementKey":"9012k32wraqmboo8ezp","Name":"","ParentKey":"zw621c5irqmboo8ezo","Syntax":"","Logic":"","Output":"\n\n███████╗ █████╗ ███╗   ███╗██████╗ ██╗     ███████╗     ██████╗  █████╗ ███╗   ███╗███████╗\n██╔════╝██╔══██╗████╗ ████║██╔══██╗██║     ██╔════╝    ██╔════╝ ██╔══██╗████╗ ████║██╔════╝\n███████╗███████║██╔████╔██║██████╔╝██║     █████╗      ██║  ███╗███████║██╔████╔██║█████╗\n╚════██║██╔══██║██║╚██╔╝██║██╔═══╝ ██║     ██╔══╝      ██║   ██║██╔══██║██║╚██╔╝██║██╔══╝\n███████║██║  ██║██║ ╚═╝ ██║██║     ███████╗███████╗    ╚██████╔╝██║  ██║██║ ╚═╝ ██║███████╗\n╚══════╝╚═╝  ╚═╝╚═╝     ╚═╝╚═╝     ╚══════╝╚══════╝     ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝╚══════╝\n\n\n\n","Tags":"!_start","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"game","ElementKey":"zw621c5irqmboo8ezo","Name":"Sample Game","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"attribute","ElementKey":"ptq11k624lkmboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:3|5]","Tags":"stats_dice","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"hi7c7y9wz76mboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:4|6]","Tags":"money_dice","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"6tetpzqor02mboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|6]","Tags":"life_dice","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"4e0z22oloj9mboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|4]","Tags":"armor_dice","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"gpco2zpwizbmboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|5]","Tags":"strength_dice","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"w4951fjku8emboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|5]","Tags":"int_dice","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"ksjzl2wb4npmboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|5]","Tags":"cunning_dice","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"atm8rfcjtrqmboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((money_dice))>>|9]","Tags":"gold_dice","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"se5i4lgcddhmboo8ezp","Name":"Life","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:(8)<<[self]((life_dice))>>d6]","Tags":"stats|!_life","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"lejyyq2au8smboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"init_[player]((life))","Tags":"maxlife","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"71szo7m223omboo8ezp","Name":"Armor Rating","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:(6)<<[self]((armor_dice))>>d6+3]","Tags":"stats|armor","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"1kisjndq7i2mboo8ezp","Name":"Hit Score","ParentKey":"player","Syntax":"","Logic":"","Output":"<<[self]((armor))>>","Tags":"!_hitscore","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},
  {"ElementType":"attribute","ElementKey":"p0vijioowqmboo8ezp","Name":"Strength","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:(6)<<[self]((strength_dice))>>d6]","Tags":"stats","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"3m31h4onqbrmboo8ezp","Name":"Intelligence","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:(6)<<[self]((int_dice))>>d6]","Tags":"stats","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"3xwjysfd7wkmboo8ezp","Name":"Cunning","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:(6)<<[self]((cunning_dice))>>d6]","Tags":"stats","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"h95i20isgadmboo8ezp","Name":"Gold","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:<<[self]((gold_dice))>>d8]","Tags":"stats|gold","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"l4jaa8tkyvkmboo8ezp","Name":"Armed Weapon","ParentKey":"player","Syntax":"","Logic":"","Output":"long-sword_01","Tags":"!_armed|stats|name","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"1k8ne01avaqmboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"0","Tags":"!_damageadj","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"experience","Name":"Experience","ParentKey":"player","Syntax":"","Logic":"","Output":"0","Tags":"experience|stats","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"irvwm0tcmdmboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"5","Tags":"heal_rounds","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"gjbvnub5g67mboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"0","Tags":"cur_heal_round","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"a7vxam5q9rlmboo8ezp","Name":"Quest","ParentKey":"player","Syntax":"","Logic":"","Output":"","Tags":"stats|quest","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"wg1znbk3f8mboo8ezp","Name":"","ParentKey":"pvrz771o419mboo8ezp","Syntax":"","Logic":"","Output":"[player]","Tags":"target","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attack","ElementKey":"pvrz771o419mboo8ezp","Name":"","ParentKey":"1e1hdypugxymboo8ezp","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attackplayer","ElementKey":"1e1hdypugxymboo8ezp","Name":"","ParentKey":"player","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"nemisovg7hmboo8ezp","Name":"Damage","ParentKey":"long-sword_01","Syntax":"","Logic":"rdm_[rand:4|12]","Output":"","Tags":"!_damage","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"enoyr0qspiemboo8ezq","Name":"","ParentKey":"long-sword_01","Syntax":"","Logic":"","Output":"a Long Sword","Tags":"title","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"object","ElementKey":"long-sword_01","Name":"Long Sword","ParentKey":"player","Syntax":"\\b(?:your\\s+)?long\\s+sword\\b","Logic":"","Output":"","Tags":"inventory|!_weapon","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"player","ElementKey":"player","Name":"","ParentKey":"home","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":5},{"ElementType":"attribute","ElementKey":"bp45z26d72mboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"^l(ook( around)?)?$","Tags":"look","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"bxlfs82pnamboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"^(examine|x)(?: the)? tables$","Tags":"x_tables","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"12qqty4hlcsrmboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"^(examine|x)(?: the)? parchment$","Tags":"x_parchment","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},
  {"ElementType":"attribute","ElementKey":"1tdc10ujfhsmboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":".*key.*","Tags":"key_id","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"thvi56aq42mboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"(spear).*","Tags":"spear_id","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"3223mr8nul7mboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"^(take|pick up)( the)?( gold)? coin","Tags":"coin_take","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"t686yf4zvwgmboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"^(take|pick up)( the)? key$","Tags":"key_take","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"89kmjnfr5nymboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"^(take|pick up)( the)? parchment$","Tags":"parchment_take","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"kq8mh9y7avrmboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"^(take|pick up)( the)? spear$","Tags":"spear_take","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"cjdtzlvazejmboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"(drop.*parchment)","Tags":"parchment_drop","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"aow4wvuv79nmboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"(drop.*spear)","Tags":"spear_drop","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"xjssveifo1pmboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"put.*in.*box","Tags":"box_put","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"zsd2pjq0k3mboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"examine.*box|x.*box","Tags":"box_examine","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"61t20s20277mboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"^(push|press)( the)?( green)? button$","Tags":"greenbutton_push","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"6acy9s34h09mboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"^(push|press)( the)?( red)? button$","Tags":"redbutton_push","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"attribute","ElementKey":"5xniqldzq8smboo8ezq","Name":"","ParentKey":"tplt_syntax","Syntax":"","Logic":"","Output":"(attack.*rat|!.*rat)","Tags":"rat_attack","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"object","ElementKey":"tplt_syntax","Name":"","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":6},{"ElementType":"macro","ElementKey":"tr01","Name":"","ParentKey":"root","Syntax":"","Logic":"","Output":"l|~|coin|~|take coin|~|home|~|tests|~|home","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":7},{"ElementType":"action","ElementKey":"41xvn2qlgs9mboo8ezq","Name":"","ParentKey":"z8grm9js2dgmboo8ezq","Syntax":"","Logic":"[player]((stats))","Output":"Stats:","Tags":"!_list","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"input","ElementKey":"z8grm9js2dgmboo8ezq","Name":"","ParentKey":"global01","Syntax":"(stats)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"action","ElementKey":"qn6lvgnpccmboo8ezq","Name":"","ParentKey":"o5sjgm0koammboo8ezq","Syntax":"","Logic":"[player]((inventory))","Output":"Inventory:","Tags":"!_list|!_bullet","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"input","ElementKey":"o5sjgm0koammboo8ezq","Name":"","ParentKey":"global01","Syntax":"(inventory|inv)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"set","ElementKey":"7lgatiumi6rmboo8ezq","Name":"","ParentKey":"0gy6zr4qp2kvmboo8ezq","Syntax":"","Logic":"","Output":"","Tags":"!_arm","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},
  {"ElementType":"input","ElementKey":"0gy6zr4qp2kvmboo8ezq","Name":"","ParentKey":"global01","Syntax":"(arm .*)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"set","ElementKey":"59ji5qk680fmboo8ezq","Name":"","ParentKey":"kqvsvcsrb8mboo8ezq","Syntax":"","Logic":"[player]((cur_heal_round))","Output":"++","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"action","ElementKey":"kqvsvcsrb8mboo8ezq","Name":"","ParentKey":"global01","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"logic","ElementKey":"tzxkykbtt7amboo8ezq","Name":"","ParentKey":"0rfz97hkyr3gmboo8ezq","Syntax":"","Logic":"?[player]((cur_heal_round)) >= [player]((heal_rounds))\nand\n?[player]((life)) < [player]((maxlife))","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"set","ElementKey":"667it0gozw9mboo8ezq","Name":"","ParentKey":"0rfz97hkyr3gmboo8ezq","Syntax":"","Logic":"[player]((life))","Output":"++","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"set","ElementKey":"nhngkztm9ybmboo8ezq","Name":"","ParentKey":"0rfz97hkyr3gmboo8ezq","Syntax":"","Logic":"[player]((cur_heal_round))","Output":"0","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"action","ElementKey":"0rfz97hkyr3gmboo8ezq","Name":"","ParentKey":"global01","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"global","ElementKey":"global01","Name":"","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":9},{"ElementType":"attribute","ElementKey":"trkoduczkxbmboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"spn_[rand:3|4]","Output":"","Tags":"stats_dice","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"luvp0ujp1rmboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"spn_[rand:<<[self]((stats_dice))>>|4]","Tags":"life_roll","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"z0y1ar46izkmboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"spn_[rand:<<[self]((stats_dice))>>|5]","Tags":"armor_roll","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"muotpsb38snmboo8ezr","Name":"Life","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"spn_[rand:<<[self]((stats_dice))>>|4]","Tags":"stats|!_life","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"4vpwjfkcibgmboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"spn_[roll:(6)<<[self]((armor_roll))>>d4+3]","Tags":"stats|armor","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"joqy09134kmboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"<<[self]((armor))>>","Tags":"!_hitscore","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"3geo6sxw755mboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"0","Tags":"!_damageadj","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"4kboxru19zsmboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"rat_claws_01","Tags":"!_armed|name","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"fk845xnnfdgmboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"\nYou have hit the rat.\n","Tags":"!_hitmsg","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"k42yrh5187mboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"\nYou have attacked the rat, but missed.\n","Tags":"!_missmsg","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"qa4t27taqrhmboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"\nYou have killed the rat.\n","Tags":"!_killmsg","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"3ume9ifwn3umboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"\nThe rat has attacked you!\n","Tags":"!_hitplayermsg","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"attribute","ElementKey":"29hc8qp1h56mboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"\nThe rat has attacked you, but missed.\n","Tags":"!_missplayermsg","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"5rwcdbq3hhmmboo8ezr","Name":"","ParentKey":"cz9k301y7s8mboo8ezr","Syntax":"","Logic":"","Output":"\n\nYou see a rat.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"cz9k301y7s8mboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attack","ElementKey":"7mdebw1mv6kmboo8ezr","Name":"","ParentKey":"9axv8hjivbsmboo8ezr","Syntax":"","Logic":"[self]","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"9axv8hjivbsmboo8ezr","Name":"","ParentKey":"npc_rat","Syntax":"(attack.*rat|!.*rat)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"0o1bija5smomboo8ezr","Name":"","ParentKey":"rat_claws_01","Syntax":"","Logic":"rdm_[rand:4|9]","Output":"","Tags":"!_damage","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"jeh61xo8z1pmboo8ezr","Name":"","ParentKey":"rat_claws_01","Syntax":"","Logic":"","Output":"rat claws","Tags":"title","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"object","ElementKey":"rat_claws_01","Name":"","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"","Tags":"!_weapon","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"npc","ElementKey":"npc_rat","Name":"","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"enemy","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"n21cw9h96fmboo8ezr","Name":"","ParentKey":"arming_room","Syntax":"","Logic":"","Output":"\nWelcome to the weapon arming room.\nThis is a place where you can pick up a weapon.\nOnce you have picked it up you can use:\n\narm [weapon]\n\nIf you drop that armed weapon, you should automatically be armed\nwith any other weapon you are carrying.\nIf you have no weapons, you will deal a very low, empty hand\namount of damage in fights.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"zi7qpyb2trmboo8ezr","Name":"","ParentKey":"s9zkvnfjt6fmboo8ezr","Syntax":"","Logic":"","Output":"\nYou look around...\nYou are in a room where you can pick up a weapon.\nOnce you have picked it up you can use:\n\narm [weapon]\n\nIf you drop that armed weapon, you should automatically be armed\nwith any other weapon you are carrying.\nIf you have no weapons, you will deal a very low, empty hand\namount of damage in fights.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"s9zkvnfjt6fmboo8ezr","Name":"","ParentKey":"arming_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"2zj00d82hjkmboo8ezr","Name":"","ParentKey":"rcmt25jqzndmboo8ezr","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"rcmt25jqzndmboo8ezr","Name":"","ParentKey":"arming_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"088w6rbozntkmboo8ezr","Name":"","ParentKey":"qmt1ebkf26jmboo8ezr","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"qmt1ebkf26jmboo8ezr","Name":"","ParentKey":"arming_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"wozpv5x5l0emboo8ezr","Name":"","ParentKey":"yg3e4y0zdrnmboo8ezr","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"yg3e4y0zdrnmboo8ezr","Name":"","ParentKey":"arming_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"arming_room","Name":"Arming Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"df8x6j2yp7cmboo8ezr","Name":"","ParentKey":"spear_01","Syntax":"","Logic":"[roll:(4)2d8]","Output":"","Tags":"!_damage","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"attribute","ElementKey":"v6aawybxg5mboo8ezr","Name":"","ParentKey":"spear_01","Syntax":"","Logic":"","Output":"a spear","Tags":"!_title","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"9o63hf0k88omboo8ezr","Name":"","ParentKey":"spear_01","Syntax":"","Logic":"","Output":"\nYou see a spear.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"v8pdn5t8wdmboo8ezr","Name":"","ParentKey":"qhaooubzbmmboo8ezr","Syntax":"","Logic":"","Output":"\nYou see a spear.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"h21ldxstdpfmboo8ezr","Name":"","ParentKey":"qhaooubzbmmboo8ezr","Syntax":"","Logic":"?[self]parent = [room]","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"qhaooubzbmmboo8ezr","Name":"","ParentKey":"spear_01","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"jrpcupewvybmboo8ezr","Name":"","ParentKey":"cmdts9fzndnmboo8ezr","Syntax":"","Logic":"[player]","Output":"\nYou take the spear.","Tags":"[self]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"f1575m22ln6mboo8ezr","Name":"","ParentKey":"cmdts9fzndnmboo8ezr","Syntax":"","Logic":"[self]tags","Output":"+inventory","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"cmdts9fzndnmboo8ezr","Name":"","ParentKey":"spear_01","Syntax":"[tplt_syntax]((spear_take))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"jfcv64bab6hmboo8ezr","Name":"","ParentKey":"mfokwp02emboo8ezr","Syntax":"","Logic":"[room]","Output":"\nYou drop the spear.","Tags":"[self]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"x8ybm67jnsmboo8ezs","Name":"","ParentKey":"mfokwp02emboo8ezr","Syntax":"","Logic":"[self]tags","Output":"-inventory","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"r3xyw7dft8smboo8ezs","Name":"","ParentKey":"mfokwp02emboo8ezr","Syntax":"","Logic":"?[self]parent = [player]","Output":"\nYou aren't carrying that item.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"mfokwp02emboo8ezr","Name":"","ParentKey":"spear_01","Syntax":"[tplt_syntax]((spear_drop))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"object","ElementKey":"spear_01","Name":"Spear","ParentKey":"arming_room","Syntax":"[tplt_syntax]((spear_id))","Logic":"","Output":"","Tags":"!_weapon","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"vl3bcagfi99mboo8ezs","Name":"player_armed_spear","ParentKey":"fvvqkyu3sn9mboo8ezs","Syntax":"","Logic":"?[player]((!_armed)) = 'spear_01'","Output":"","Tags":"!_test","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"fvvqkyu3sn9mboo8ezs","Name":"","ParentKey":"test_room","Syntax":"","Logic":"","Output":"\nTo use this room, enter admin mode, create a macro.\nStore the macro in this game, then run it in test mode.\nEnsure that your macro passes through this room and the tests below will run\nwhen they are encountered.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"hvt29meeaeomboo8ezs","Name":"","ParentKey":"e7dd9zyzry6mboo8ezs","Syntax":"","Logic":"","Output":"\nTo use this room, enter admin mode, create a macro.\nStore the macro in this game, then run it in test mode.\nEnsure that your macro passes through this room and the tests below will run\nwhen they are encountered.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"e7dd9zyzry6mboo8ezs","Name":"","ParentKey":"test_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"wz9m62tc8tnmboo8ezs","Name":"","ParentKey":"43eigvsy66nmboo8ezs","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"43eigvsy66nmboo8ezs","Name":"","ParentKey":"test_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"4qjj14r330tmboo8ezs","Name":"","ParentKey":"g1lvlyfwo5emboo8ezs","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"input","ElementKey":"g1lvlyfwo5emboo8ezs","Name":"","ParentKey":"test_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"yf7ikqoqlxmboo8ezs","Name":"","ParentKey":"5m3xiph3y9umboo8ezs","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"5m3xiph3y9umboo8ezs","Name":"","ParentKey":"test_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"test_room","Name":"Test Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"aoepf7zc7jdmboo8ezs","Name":"","ParentKey":"fight_room","Syntax":"","Logic":"","Output":"\nYou step into the fighting arena!\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"z0xl9o0p8kmboo8ezs","Name":"","ParentKey":"2c7crzztq1xmboo8ezs","Syntax":"","Logic":"","Output":"\nYou look around.\nYou are in the fight test room.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"2c7crzztq1xmboo8ezs","Name":"","ParentKey":"fight_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"8al5dtp6bubmboo8ezs","Name":"","ParentKey":"e8ozj2dy3elmboo8ezs","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"e8ozj2dy3elmboo8ezs","Name":"","ParentKey":"fight_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"d1tu58owfibmboo8ezs","Name":"","ParentKey":"jtf6sl8bp7jmboo8ezs","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"jtf6sl8bp7jmboo8ezs","Name":"","ParentKey":"fight_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"xiv3i39lveimboo8ezs","Name":"","ParentKey":"a7995djl9vmboo8ezs","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"a7995djl9vmboo8ezs","Name":"","ParentKey":"fight_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"fight_room","Name":"Fight Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"e15z7451egmboo8ezs","Name":"","ParentKey":"e5zm0mpovojmboo8ezs","Syntax":"","Logic":"","Output":"\n\nYou see a red button in the center of the room.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"eqvngg3z73cmboo8ezs","Name":"","ParentKey":"ow8t51clarmboo8ezs","Syntax":"","Logic":"","Output":"\n\nYou see a red button in the middle of the room.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"ow8t51clarmboo8ezs","Name":"","ParentKey":"e5zm0mpovojmboo8ezs","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"7sq6q04lpmrmboo8ezs","Name":"","ParentKey":"pj6gc8womhamboo8ezs","Syntax":"","Logic":"","Output":"\n\nA rat appears!","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"pj6gc8womhamboo8ezs","Name":"","ParentKey":"dx3x14g1omboo8ezs","Syntax":"","Logic":"npc_rat","Output":"[room]","Tags":"!_spawn","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"dx3x14g1omboo8ezs","Name":"","ParentKey":"e5zm0mpovojmboo8ezs","Syntax":"[tplt_syntax]((redbutton_push))","Logic":"","Output":"\n\nYou've pressed the button.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"message","ElementKey":"hq5z1seey28mboo8ezs","Name":"","ParentKey":"c4m3dkjw6jtmboo8ezs","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\nArming\nCoin\nDiscover\nFight\nFollows\nHealing\nInjection\nMessages\nPath\nPutting\nTests\nValues  (Special message values test)\nHtml\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"c4m3dkjw6jtmboo8ezs","Name":"","ParentKey":"e5zm0mpovojmboo8ezs","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"cn6yyl42r8fmboo8ezs","Name":"","ParentKey":"tp90y7jrwtmboo8ezs","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"tp90y7jrwtmboo8ezs","Name":"","ParentKey":"e5zm0mpovojmboo8ezs","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"cebx3ppqrmimboo8ezs","Name":"","ParentKey":"fv5hny44e34mboo8ezs","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"fv5hny44e34mboo8ezs","Name":"","ParentKey":"e5zm0mpovojmboo8ezs","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"object","ElementKey":"e5zm0mpovojmboo8ezs","Name":"","ParentKey":"fight_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"y8o35ewjl0lmboo8ezs","Name":"","ParentKey":"messages_room","Syntax":"","Logic":"","Output":"1","Tags":"oth_idx","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"i89mjdxo2ermboo8ezs","Name":"","ParentKey":"messages_room","Syntax":"","Logic":"","Output":"\nWelcome to the message testing room.\nTo test the various message repeat options simply enter:\n\nlook\nor\nl\n\nrepeatedly.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"nxar8u3cnu8mboo8ezs","Name":"","ParentKey":"ehbrur5noabmboo8ezs","Syntax":"","Logic":"","Output":"\nYou look around...","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"ehbrur5noabmboo8ezs","Name":"","ParentKey":"messages_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"7egnbvsxefdmboo8ezs","Name":"","ParentKey":"pitbjvp9xbmboo8ezs","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"pitbjvp9xbmboo8ezs","Name":"","ParentKey":"messages_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"t8bcvag8j8mboo8ezs","Name":"","ParentKey":"mt8yvd39wlmboo8ezs","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"mt8yvd39wlmboo8ezs","Name":"","ParentKey":"messages_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"z1th8pwycudmboo8ezt","Name":"","ParentKey":"6yn5n7bi0lgmboo8ezt","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"6yn5n7bi0lgmboo8ezt","Name":"","ParentKey":"messages_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"dev_note","ElementKey":"5mxstexm8uamboo8ezt","Name":"","ParentKey":"messages_room","Syntax":"","Logic":"","Output":"\nThis is a Dev Note. It should only show if you are in admin mode.\nIf you want to leave it in your messages.nrmn file, but don't want it to show,\nadd an active=false attribute.\n\nInactive Dev Notes WILL show if you use the _devnotes command however.","Tags":"Testing","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"dev_note","ElementKey":"bmmd0h5j8u5mboo8ezt","Name":"","ParentKey":"messages_room","Syntax":"","Logic":"","Output":"\nThis is an inactive Dev Note. It will only show when you are listing your Dev Notes using: _devnotes [Search Criteria]","Tags":"Testing","Repeat":"","RepeatIndex":"0","Active":"false","Sort":1},{"ElementType":"room","ElementKey":"messages_room","Name":"Messages Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"enter_message","ElementKey":"ilv37rzj8cmboo8ezt","Name":"","ParentKey":"mg0m2wdqdmfmboo8ezt","Syntax":"","Logic":"","Output":"\nYou see a non-repeating message parchment.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"4z2t9mixpbkmboo8ezt","Name":"","ParentKey":"q3glgqfdrcmboo8ezt","Syntax":"","Logic":"","Output":"\nThis is non-repeating message number 01\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"mbqlg8ft7s9mboo8ezt","Name":"","ParentKey":"q3glgqfdrcmboo8ezt","Syntax":"","Logic":"","Output":"\nThis is non-repeating message number 02\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"4mmfhaxzmoimboo8ezt","Name":"","ParentKey":"q3glgqfdrcmboo8ezt","Syntax":"","Logic":"","Output":"\nThis is non-repeating message number 03\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"q3glgqfdrcmboo8ezt","Name":"Non Repeating Look Group","ParentKey":"48e7riqwmb3mboo8ezt","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"none","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"48e7riqwmb3mboo8ezt","Name":"","ParentKey":"mg0m2wdqdmfmboo8ezt","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"object","ElementKey":"mg0m2wdqdmfmboo8ezt","Name":"Non Repeating Parchment","ParentKey":"messages_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"y8ie3j8qwnmboo8ezt","Name":"","ParentKey":"be73l0k13e8mboo8ezt","Syntax":"","Logic":"","Output":"\nYou see an 'other' repeating message parchment.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"message","ElementKey":"0txyq33jnl5hmboo8ezt","Name":"","ParentKey":"xq3lisse89imboo8ezt","Syntax":"","Logic":"","Output":"\nThis is 'other' message 01.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"message","ElementKey":"7kj95abikmboo8ezt","Name":"","ParentKey":"xq3lisse89imboo8ezt","Syntax":"","Logic":"","Output":"\nThis is 'other' message 02.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"message","ElementKey":"1xjcaj9wemzmboo8ezt","Name":"","ParentKey":"xq3lisse89imboo8ezt","Syntax":"","Logic":"","Output":"\nThis is 'other' message 03.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"message","ElementKey":"xq3lisse89imboo8ezt","Name":"Non Repeating Look Group","ParentKey":"6axktps7snmboo8ezt","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"[room]((oth_idx))","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"look","ElementKey":"6axktps7snmboo8ezt","Name":"","ParentKey":"be73l0k13e8mboo8ezt","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"object","ElementKey":"be73l0k13e8mboo8ezt","Name":"OTHER Repeating Parchment","ParentKey":"messages_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"enter_message","ElementKey":"n5r85u76zvfmboo8ezt","Name":"","ParentKey":"ivuip8x3dcmboo8ezt","Syntax":"","Logic":"","Output":"\nYou see a random message parchment.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"message","ElementKey":"qqgc2ejbugtmboo8ezt","Name":"","ParentKey":"kau9agfrj98mboo8ezt","Syntax":"","Logic":"","Output":"\nOh! This message is so random.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"message","ElementKey":"pkc3lpf5zofmboo8ezt","Name":"","ParentKey":"kau9agfrj98mboo8ezt","Syntax":"","Logic":"","Output":"\nYet another random message!\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"message","ElementKey":"nyfpz2vgci9mboo8ezt","Name":"","ParentKey":"kau9agfrj98mboo8ezt","Syntax":"","Logic":"","Output":"\nOh man, another random message!\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"message","ElementKey":"kau9agfrj98mboo8ezt","Name":"Non Repeating Look Group","ParentKey":"7fltdug6tz3mboo8ezt","Syntax":"","Logic":"","Output":"\nThis is the message group.\nIt's random messages should show below:\n","Tags":"","Repeat":"random","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"look","ElementKey":"7fltdug6tz3mboo8ezt","Name":"","ParentKey":"ivuip8x3dcmboo8ezt","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},
  {"ElementType":"object","ElementKey":"ivuip8x3dcmboo8ezt","Name":"Random Repeating Parchment","ParentKey":"messages_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":3},{"ElementType":"enter_message","ElementKey":"b03ml7n466mboo8ezt","Name":"","ParentKey":"3gxtmss0gjimboo8ezt","Syntax":"","Logic":"","Output":"\nYou see a repeating message parchment.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":4},{"ElementType":"message","ElementKey":"qb2wlwmb85gmboo8ezt","Name":"","ParentKey":"j4uja61susmboo8ezt","Syntax":"","Logic":"","Output":"\nThis is repeating message number 01\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":4},{"ElementType":"message","ElementKey":"t5jkjm4s658mboo8ezt","Name":"","ParentKey":"j4uja61susmboo8ezt","Syntax":"","Logic":"","Output":"\nThis is repeating message number 02\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":4},{"ElementType":"message","ElementKey":"5apu1hmi6smboo8ezt","Name":"","ParentKey":"j4uja61susmboo8ezt","Syntax":"","Logic":"","Output":"\nThis is repeating message number 03\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":4},{"ElementType":"message","ElementKey":"j4uja61susmboo8ezt","Name":"Non Repeating Look Group","ParentKey":"3ebuvghekx8mboo8ezt","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"repeat","RepeatIndex":"0","Active":"true","Sort":4},{"ElementType":"look","ElementKey":"3ebuvghekx8mboo8ezt","Name":"","ParentKey":"3gxtmss0gjimboo8ezt","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":4},{"ElementType":"object","ElementKey":"3gxtmss0gjimboo8ezt","Name":"Repeating Parchment","ParentKey":"messages_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":4},{"ElementType":"enter_message","ElementKey":"0f1mepoel7umboo8ezt","Name":"","ParentKey":"healing_room","Syntax":"","Logic":"","Output":"\nYou are in the healing test room.\nYou see a red button. If you press it, you will lose 2 life points.\nIf you look around enough times you will see your life increase.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"12jicmumlojbmboo8ezu","Name":"","ParentKey":"31s2wbrg2umboo8ezu","Syntax":"","Logic":"","Output":"\nYou look around...\nYou are in the healing test room.\nYou see a red button. If you press it, you will lose 2 life points.\nIf you look around enough times you will see your life increase.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"31s2wbrg2umboo8ezu","Name":"","ParentKey":"healing_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"gulzrqrnoofmboo8ezu","Name":"","ParentKey":"5uyo7tp0i2smboo8ezu","Syntax":"","Logic":"[player]((life))","Output":"-=2","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"tsx3fdpdqqmboo8ezu","Name":"","ParentKey":"5uyo7tp0i2smboo8ezu","Syntax":"","Logic":"","Output":"\nYou just lost 2 life points.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"5uyo7tp0i2smboo8ezu","Name":"","ParentKey":"healing_room","Syntax":"[tplt_syntax]((redbutton_push))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"rhhpx60vehmboo8ezu","Name":"","ParentKey":"tqu0ymw8d4fmboo8ezu","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"tqu0ymw8d4fmboo8ezu","Name":"","ParentKey":"healing_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"lm9jyyfwtakmboo8ezu","Name":"","ParentKey":"kbe1ldzgwngmboo8ezu","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"kbe1ldzgwngmboo8ezu","Name":"","ParentKey":"healing_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"uzbn3zrgczhmboo8ezu","Name":"","ParentKey":"xdd1n6pak5mboo8ezu","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"xdd1n6pak5mboo8ezu","Name":"","ParentKey":"healing_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"room","ElementKey":"healing_room","Name":"Healing Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"95xecbhzj2mboo8ezu","Name":"","ParentKey":"specval_room","Syntax":"","Logic":"","Output":"false","Tags":"showthis","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"vdaa6ms6gsgmboo8ezu","Name":"","ParentKey":"specval_room","Syntax":"","Logic":"","Output":"\nIn this room you will see a message when you look around.\nIt will contain special values (Your player's name for example).","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"ozdlbnyrrnmboo8ezu","Name":"","ParentKey":"1ji3n9l85h7mboo8ezu","Syntax":"","Logic":"","Output":"\nGreetings <<[player]name>>.\n\nIn this room:\n<?[room]((showthis)) = 'true'?>\nThis text should show - because 'showthis' is true.\n<else>\nORRR this text should show - because 'showthis' is false.\n</?>\n\n<?[room]((showthis)) = 'true'?>\nAnd this should show only when showthis is true.\n</?>\n\nThe following text will only show if the random value that is 'rolled'\nevery time you 'look around' is > 2.\n<?rdm_[roll:1d6] > '2'?>\nYou succeeded the roll!\n</?>\n\nAnd here is a random value: <<rdm_[roll:4d8]>>.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"1ji3n9l85h7mboo8ezu","Name":"","ParentKey":"specval_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"ukruyczjxrkmboo8ezu","Name":"","ParentKey":"yg5wg0skflmboo8ezu","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"yg5wg0skflmboo8ezu","Name":"","ParentKey":"specval_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"9vbvsgw53qfmboo8ezu","Name":"","ParentKey":"ecxu31sota5mboo8ezu","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"ecxu31sota5mboo8ezu","Name":"","ParentKey":"specval_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"8ic76qd3f0bmboo8ezu","Name":"","ParentKey":"h1suhak7x2qmboo8ezu","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"h1suhak7x2qmboo8ezu","Name":"","ParentKey":"specval_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"specval_room","Name":"Special Values Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"m00dsnh6bdmboo8ezu","Name":"","ParentKey":"home","Syntax":"","Logic":"","Output":"\nWelcome to the WorldWeaver Testing Game.\n\nTo enter a test room simply enter its name.\n(No need to say \"go to\").\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"uh3p81im4vmboo8ezu","Name":"","ParentKey":"jy13ioktmnimboo8ezu","Syntax":"","Logic":"","Output":"\nYou are in the testing room.\n\nTo enter a test room simply enter its name.\n(No need to say \"go to\").\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"jy13ioktmnimboo8ezu","Name":"","ParentKey":"home","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"2kyh1sd598mmboo8ezu","Name":"","ParentKey":"29u1h269tlcmboo8ezu","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\nArming\nCoin\nDiscover\nFight\nFollows\nHealing\nInjection\nMessages\nPath\nPutting\nTests\nValues  (Special message values test)\nHtml\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"29u1h269tlcmboo8ezu","Name":"","ParentKey":"home","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"vyrh4vfik8kmboo8ezu","Name":"","ParentKey":"udizlzni6tmboo8ezu","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"udizlzni6tmboo8ezu","Name":"","ParentKey":"home","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"8y40brg5l3rmboo8ezu","Name":"","ParentKey":"p6gjpcq1638mboo8ezu","Syntax":"","Logic":"arming_room","Output":"\nYou have decided to test arming weapons.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"input","ElementKey":"p6gjpcq1638mboo8ezu","Name":"","ParentKey":"home","Syntax":"(arming)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"4q08wlgvm5amboo8ezu","Name":"","ParentKey":"3yqr5xim791mboo8ezu","Syntax":"","Logic":"coin_room","Output":"\nYou have decided to test receiving money.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"3yqr5xim791mboo8ezu","Name":"","ParentKey":"home","Syntax":"(coin)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"hk6gqsec5ltmboo8ezv","Name":"","ParentKey":"0tui2m1u9b0mmboo8ezv","Syntax":"","Logic":"discover_room","Output":"\nYou have decided to test discovering objects.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"0tui2m1u9b0mmboo8ezv","Name":"","ParentKey":"home","Syntax":"(discover)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"2zrlcdjavrcmboo8ezv","Name":"","ParentKey":"hqv8uuk1ttbmboo8ezv","Syntax":"","Logic":"fight_room","Output":"\nYou have decided to test the fight room.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"hqv8uuk1ttbmboo8ezv","Name":"","ParentKey":"home","Syntax":"(fight)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"tq23icmj498mboo8ezv","Name":"","ParentKey":"5d6b8afyy6mboo8ezv","Syntax":"","Logic":"healing_room","Output":"\nYou have decided to test healing.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"5d6b8afyy6mboo8ezv","Name":"","ParentKey":"home","Syntax":"(healing)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"6gg4m5qplnxmboo8ezv","Name":"","ParentKey":"sr6k770ryojmboo8ezv","Syntax":"","Logic":"inject_room","Output":"\nYou have decided to test injection.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"sr6k770ryojmboo8ezv","Name":"","ParentKey":"home","Syntax":"(injection)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"zx2fudphs79mboo8ezv","Name":"","ParentKey":"gfy2dqe95p4mboo8ezv","Syntax":"","Logic":"follows_room","Output":"\nYou have decided to test the NPC follows the player room.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"gfy2dqe95p4mboo8ezv","Name":"","ParentKey":"home","Syntax":"(follows)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"miludcx8gomboo8ezv","Name":"","ParentKey":"7f3brkq3ic8mboo8ezv","Syntax":"","Logic":"messages_room","Output":"\nYou have decided to test messages.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"7f3brkq3ic8mboo8ezv","Name":"","ParentKey":"home","Syntax":"(messages)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"cmr1lw8hsbgmboo8ezv","Name":"","ParentKey":"kwcqc4m9phimboo8ezv","Syntax":"","Logic":"path_room","Output":"\nYou have decided to test the NPC follows a path room.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"kwcqc4m9phimboo8ezv","Name":"","ParentKey":"home","Syntax":"(path)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"a9eznms4do5mboo8ezv","Name":"","ParentKey":"a78jazu7waqmboo8ezv","Syntax":"","Logic":"taking_room","Output":"\nYou have decided to test the putting room.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"a78jazu7waqmboo8ezv","Name":"","ParentKey":"home","Syntax":"(putting)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"7ga5f2zgxodmboo8ezv","Name":"","ParentKey":"6dwwb1lf9vwmboo8ezv","Syntax":"","Logic":"test_room","Output":"\nYou have decided to test the tests room.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"input","ElementKey":"6dwwb1lf9vwmboo8ezv","Name":"","ParentKey":"home","Syntax":"(tests)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"jjo9balg1bmboo8ezv","Name":"","ParentKey":"2yucl2ktgpomboo8ezv","Syntax":"","Logic":"specval_room","Output":"\nYou have decided to test special message values.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"2yucl2ktgpomboo8ezv","Name":"","ParentKey":"home","Syntax":"(values)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"x8orvem1jbcmboo8ezv","Name":"","ParentKey":"bxfs2wxje8mboo8ezv","Syntax":"","Logic":"html_room","Output":"\nYou have decided to view the html demo.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"bxfs2wxje8mboo8ezv","Name":"","ParentKey":"home","Syntax":"(html)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"home","Name":"Testing Home Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"a8xakhx9z8mboo8ezv","Name":"","ParentKey":"path_room","Syntax":"","Logic":"","Output":"\nYou have chosen to test the NPC Along a Path feature.\nIf you push the green button, the thief will begin moving.\n\nYou see a green button and a red button.\n\nIf you push the red button, it will stop traveling.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"2ef5v0awdv2mboo8ezv","Name":"","ParentKey":"yomyw2lw57mboo8ezv","Syntax":"","Logic":"","Output":"\nYou look around.\nThere is a green button and a red button.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"yomyw2lw57mboo8ezv","Name":"","ParentKey":"path_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"67lt939xqggmboo8ezv","Name":"","ParentKey":"8ke3ctbpsmrmboo8ezv","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"8ke3ctbpsmrmboo8ezv","Name":"","ParentKey":"path_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"sbw1gm42vxemboo8ezv","Name":"","ParentKey":"okfnyascaqmboo8ezv","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"okfnyascaqmboo8ezv","Name":"","ParentKey":"path_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"kmzxallbjtcmboo8ezw","Name":"","ParentKey":"fwx69uia5jbmboo8ezv","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"fwx69uia5jbmboo8ezv","Name":"","ParentKey":"path_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"w3gopbt4lrmboo8ezw","Name":"","ParentKey":"tdqu6cr4bycmboo8ezw","Syntax":"","Logic":"[trv_path_ranger]active","Output":"true","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"utew1rbgo3bmboo8ezw","Name":"","ParentKey":"tdqu6cr4bycmboo8ezw","Syntax":"","Logic":"","Output":"\nYou activate the ranger's travel.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"tdqu6cr4bycmboo8ezw","Name":"","ParentKey":"path_room","Syntax":"[tplt_syntax]((greenbutton_push))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"wlhbfxo5n5mboo8ezw","Name":"","ParentKey":"l2ug5revajmboo8ezw","Syntax":"","Logic":"[trv_path_ranger]active","Output":"false","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"cavy7komz4bmboo8ezw","Name":"","ParentKey":"l2ug5revajmboo8ezw","Syntax":"","Logic":"","Output":"\nYou deactivate the ranger's travel.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"input","ElementKey":"l2ug5revajmboo8ezw","Name":"","ParentKey":"path_room","Syntax":"[tplt_syntax]((redbutton_push))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"path_room","Name":"NPC on a Path Test","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"mci3wpvfff7mboo8ezw","Name":"","ParentKey":"g06lkoowsjcmboo8ezw","Syntax":"","Logic":"","Output":"\nThe ranger is there.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"747d81zg24imboo8ezw","Name":"","ParentKey":"w14e93qgg3smboo8ezw","Syntax":"","Logic":"","Output":"\nYou see a ranger.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"w14e93qgg3smboo8ezw","Name":"","ParentKey":"g06lkoowsjcmboo8ezw","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"5dvm1lcm7cmboo8ezw","Name":"","ParentKey":"jeefwkacztmboo8ezw","Syntax":"","Logic":"[self]((nav))active = 'true'","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"jeefwkacztmboo8ezw","Name":"","ParentKey":"trv_path_ranger","Syntax":"","Logic":"","Output":"\nThe Ranger enters the room.\n","Tags":"!_enter","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"travel","ElementKey":"trv_path_ranger","Name":"","ParentKey":"g06lkoowsjcmboo8ezw","Syntax":"","Logic":"[path|home|gold_room|home|path_room]","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"false","Sort":1},{"ElementType":"npc","ElementKey":"g06lkoowsjcmboo8ezw","Name":"Traveling Ranger","ParentKey":"path_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"epb1uy4mlasmboo8ezw","Name":"","ParentKey":"html_room","Syntax":"","Logic":"","Output":"\nThis room demonstrates that you can use basic HTML to add some formatting to your games.\nType: <strong>look</strong> or <strong>l</strong>","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"ibl3id8fmemboo8ezw","Name":"","ParentKey":"7jwlmg7m59mboo8ezw","Syntax":"","Logic":"","Output":"<h2>Heading</h2><ul><li>list</li><li>one</li></ul><ol><li>and</li><li>list</li><li>two</li></ol>","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"7jwlmg7m59mboo8ezw","Name":"","ParentKey":"html_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"0pfzlstvcp4mboo8ezw","Name":"","ParentKey":"lbg7mni5ggmboo8ezw","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"lbg7mni5ggmboo8ezw","Name":"","ParentKey":"html_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"5yzgur987h5mboo8ezw","Name":"","ParentKey":"614epustlbbmboo8ezw","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"614epustlbbmboo8ezw","Name":"","ParentKey":"html_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"o7h472ktxuimboo8ezw","Name":"","ParentKey":"5nuz7xvjgwkmboo8ezw","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"5nuz7xvjgwkmboo8ezw","Name":"","ParentKey":"html_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"html_room","Name":"Html Demo","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"vd4u2e2ej7rmboo8ezw","Name":"","ParentKey":"inject_room","Syntax":"","Logic":"","Output":"\nYou are in a room that demonstrates both full path injection,\nas well as relative path injection.\n\nTo see how this works - look at the 'injection' folder in the 'rooms'\nfolder of the sample game.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"message","ElementKey":"li7j2e7rcemboo8ezw","Name":"","ParentKey":"of2rjtnikqsmboo8ezw","Syntax":"","Logic":"","Output":"\nYou look around. You are in the injection room.\nThis demonstrates the power of building your games in script versus using the graphical builder tool.\n\nTo see how this works - look at the 'injection' folder in the 'rooms'\nfolder of the sample game.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"of2rjtnikqsmboo8ezw","Name":"","ParentKey":"inject_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"je1bgy0jmnemboo8ezw","Name":"","ParentKey":"pn58hnfl65mboo8ezw","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"pn58hnfl65mboo8ezw","Name":"","ParentKey":"inject_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"8cdhv56wq9rmboo8ezw","Name":"","ParentKey":"arayto70ge4mboo8ezw","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"arayto70ge4mboo8ezw","Name":"","ParentKey":"inject_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"3eo9c427owdmboo8ezw","Name":"","ParentKey":"81o3ogzkaeomboo8ezw","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"81o3ogzkaeomboo8ezw","Name":"","ParentKey":"inject_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"inject_room","Name":"Injection Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"c974fj08jrmboo8ezw","Name":"","ParentKey":"coin_room","Syntax":"","Logic":"","Output":"\nYou are in an empty room.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"oxliseiyjqdmboo8ezw","Name":"","ParentKey":"ddt9uqf0knmmboo8ezw","Syntax":"","Logic":"","Output":"\nYou look around.\nYou are in a small room.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"ddt9uqf0knmmboo8ezw","Name":"","ParentKey":"coin_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"kmqwrhs3pwimboo8ezw","Name":"","ParentKey":"gc3djxwg5dbmboo8ezw","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"gc3djxwg5dbmboo8ezw","Name":"","ParentKey":"coin_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"m1b3emdwl78mboo8ezw","Name":"","ParentKey":"17102xt71cjmboo8ezw","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"17102xt71cjmboo8ezw","Name":"","ParentKey":"coin_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"lk9fwyfbd9cmboo8ezw","Name":"","ParentKey":"4v055fdifehmboo8ezw","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"4v055fdifehmboo8ezw","Name":"","ParentKey":"coin_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"coin_room","Name":"Coin Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"sqqstbx82bsmboo8ezw","Name":"","ParentKey":"5wvyhxboxgcmboo8ezw","Syntax":"","Logic":"","Output":"false","Tags":"moved","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"enter_message","ElementKey":"m1rcygpknbmmboo8ezw","Name":"","ParentKey":"5wvyhxboxgcmboo8ezw","Syntax":"","Logic":"","Output":"\nYou see a gold coin.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"lib3b6scc7mboo8ezw","Name":"","ParentKey":"fgudeh4xwlwmboo8ezw","Syntax":"","Logic":"","Output":"\nYou see a gold coin.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"ij4213c37lnmboo8ezw","Name":"","ParentKey":"fgudeh4xwlwmboo8ezw","Syntax":"","Logic":"?[self]((moved)) = 'false'","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"fgudeh4xwlwmboo8ezw","Name":"","ParentKey":"5wvyhxboxgcmboo8ezw","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"vtt48l2bcfomboo8ezw","Name":"","ParentKey":"igyawdtcjlmboo8ezw","Syntax":"","Logic":"!_limbo","Output":"\nYou take the gold coin.\n","Tags":"[self]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"0zk59anaihosmboo8ezw","Name":"","ParentKey":"igyawdtcjlmboo8ezw","Syntax":"","Logic":"[player]((gold))","Output":"+=1","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"igyawdtcjlmboo8ezw","Name":"","ParentKey":"5wvyhxboxgcmboo8ezw","Syntax":"[tplt_syntax]((coin_take))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"object","ElementKey":"5wvyhxboxgcmboo8ezw","Name":"Gold Coin","ParentKey":"coin_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"wwfhdljow9mboo8ezx","Name":"","ParentKey":"follows_room","Syntax":"","Logic":"","Output":"\nYou have chosen to test the NPC Follows feature.\nIf you push the green button, the thief will follow you as you travel\nfrom room to room.\n\nYou see a green button and a red button.\n\nIf you push the red button, it will stop following you.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"k8w4dww0c3imboo8ezx","Name":"","ParentKey":"v9gg7wv8btqmboo8ezx","Syntax":"","Logic":"","Output":"\nYou look around.\nThere is a green button and a red button.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"v9gg7wv8btqmboo8ezx","Name":"","ParentKey":"follows_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"1h4vgcwb9ypmboo8ezx","Name":"","ParentKey":"escu068xzcrmboo8ezx","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"escu068xzcrmboo8ezx","Name":"","ParentKey":"follows_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"5d5i3898eudmboo8ezx","Name":"","ParentKey":"xmtdldqzp1mboo8ezx","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"xmtdldqzp1mboo8ezx","Name":"","ParentKey":"follows_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"sa5zr09gu1mmboo8ezx","Name":"","ParentKey":"q0u83bx0ezmboo8ezx","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"q0u83bx0ezmboo8ezx","Name":"","ParentKey":"follows_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"itiwl2mflynmboo8ezx","Name":"","ParentKey":"fou022nlizomboo8ezx","Syntax":"","Logic":"[trv_following_thief]active","Output":"true","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"qbzys3g8c1mboo8ezx","Name":"","ParentKey":"fou022nlizomboo8ezx","Syntax":"","Logic":"","Output":"\nYou activate the thief's travel.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"fou022nlizomboo8ezx","Name":"","ParentKey":"follows_room","Syntax":"[tplt_syntax]((greenbutton_push))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"set","ElementKey":"m3agvjzh4z8mboo8ezx","Name":"","ParentKey":"rqz510u62cnmboo8ezx","Syntax":"","Logic":"[trv_following_thief]active","Output":"false","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"adzfvl6k3spmboo8ezx","Name":"","ParentKey":"rqz510u62cnmboo8ezx","Syntax":"","Logic":"","Output":"\nYou deactivate the thief's travel.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"rqz510u62cnmboo8ezx","Name":"","ParentKey":"follows_room","Syntax":"[tplt_syntax]((redbutton_push))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"follows_room","Name":"NPC Follows the Player","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"c5iho6l7rqqmboo8ezx","Name":"","ParentKey":"h43oaxc348tmboo8ezx","Syntax":"","Logic":"[self]((nav))active = 'true'","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"h43oaxc348tmboo8ezx","Name":"","ParentKey":"l1v9nd9j42mboo8ezx","Syntax":"","Logic":"","Output":"\nThe thief follows you.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"zl6mr6dzz4mboo8ezx","Name":"","ParentKey":"ikgwnl9sgamboo8ezx","Syntax":"","Logic":"","Output":"\nYou see a thief.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"ikgwnl9sgamboo8ezx","Name":"","ParentKey":"l1v9nd9j42mboo8ezx","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"61wuxl1e2eqmboo8ezx","Name":"","ParentKey":"ogjf9vj1q5mboo8ezx","Syntax":"","Logic":"[self]((nav))active = 'true'","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"ogjf9vj1q5mboo8ezx","Name":"","ParentKey":"trv_following_thief","Syntax":"","Logic":"","Output":"\nThe thief follows you.\n","Tags":"!_enter","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"travel","ElementKey":"trv_following_thief","Name":"","ParentKey":"l1v9nd9j42mboo8ezx","Syntax":"","Logic":"[follow|player]","Output":"","Tags":"nav","Repeat":"","RepeatIndex":"0","Active":"false","Sort":1},{"ElementType":"npc","ElementKey":"l1v9nd9j42mboo8ezx","Name":"Following Thief","ParentKey":"follows_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"p3wbdfcz7srmboo8ezx","Name":"","ParentKey":"taking_room","Syntax":"","Logic":"","Output":"\nYou are in the taking and putting room.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"6kkpa6ixfl8mboo8ezx","Name":"","ParentKey":"rfm5ppxgvlsmboo8ezx","Syntax":"","Logic":"","Output":"\nYou look around...\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"rfm5ppxgvlsmboo8ezx","Name":"","ParentKey":"taking_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"vx3q9j4jzmboo8ezx","Name":"","ParentKey":"50bfjb4ddq8mboo8ezx","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"50bfjb4ddq8mboo8ezx","Name":"","ParentKey":"taking_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"p56g7g3sx0omboo8ezx","Name":"","ParentKey":"7s4lnvf6nxnmboo8ezx","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"7s4lnvf6nxnmboo8ezx","Name":"","ParentKey":"taking_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"jgxaas6601mboo8ezx","Name":"","ParentKey":"j6yqm3q37nmboo8ezx","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"input","ElementKey":"j6yqm3q37nmboo8ezx","Name":"","ParentKey":"taking_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"taking_room","Name":"The Taking and Putting Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"sc5v6jt0xarmboo8ezx","Name":"","ParentKey":"n5bfm3xey3nmboo8ezx","Syntax":"","Logic":"","Output":"\nYou see a box.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"2wy48siuif2mboo8ezx","Name":"","ParentKey":"xmgrvgqie7mboo8ezx","Syntax":"","Logic":"","Output":"\n\nYou see a box.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"q2tz6543b8mboo8ezx","Name":"","ParentKey":"xmgrvgqie7mboo8ezx","Syntax":"","Logic":"?[self]parent = [room]","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"xmgrvgqie7mboo8ezx","Name":"","ParentKey":"n5bfm3xey3nmboo8ezx","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"x61jhwlri5nmboo8ezy","Name":"","ParentKey":"yibz804am0kmboo8ezy","Syntax":"","Logic":"look","Output":"\nYou examine the box.\n","Tags":"!_type|children","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"examine_box","ElementKey":"yibz804am0kmboo8ezy","Name":"","ParentKey":"n5bfm3xey3nmboo8ezx","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"pc93vraw6yfmboo8ezy","Name":"","ParentKey":"am5l9vgggdlmboo8ezy","Syntax":"","Logic":"[self]","Output":"\nYou put the [target] in the box.\n","Tags":"[syntax]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"am5l9vgggdlmboo8ezy","Name":"","ParentKey":"n5bfm3xey3nmboo8ezx","Syntax":"[tplt_syntax]((box_put))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"4nt90y4x6lsmboo8ezy","Name":"","ParentKey":"78n3ch5framboo8ezy","Syntax":"","Logic":"examine_box","Output":"","Tags":"!_type|self","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"78n3ch5framboo8ezy","Name":"","ParentKey":"n5bfm3xey3nmboo8ezx","Syntax":"[tplt_syntax]((box_examine))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"object","ElementKey":"n5bfm3xey3nmboo8ezx","Name":"Box","ParentKey":"taking_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"enter_message","ElementKey":"j5g4h5v7088mboo8ezy","Name":"","ParentKey":"v6lcadj1wfomboo8ezy","Syntax":"","Logic":"","Output":"\nYou see a key.\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"message","ElementKey":"kmawmfcrcdmboo8ezy","Name":"","ParentKey":"z55knb4bioqmboo8ezy","Syntax":"","Logic":"","Output":"\n\nYou see a key.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"logic","ElementKey":"7mbf90i8lxfmboo8ezy","Name":"","ParentKey":"z55knb4bioqmboo8ezy","Syntax":"","Logic":"?[self]parent = [room]","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"look","ElementKey":"z55knb4bioqmboo8ezy","Name":"","ParentKey":"v6lcadj1wfomboo8ezy","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"move","ElementKey":"9i1wgsi1ofpmboo8ezy","Name":"","ParentKey":"34skevhaxoemboo8ezy","Syntax":"","Logic":"[player]","Output":"\nYou take the key.","Tags":"[self]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"set","ElementKey":"6p4b5as4fnrmboo8ezy","Name":"","ParentKey":"34skevhaxoemboo8ezy","Syntax":"","Logic":"[self]tags","Output":"\n+inventory","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"input","ElementKey":"34skevhaxoemboo8ezy","Name":"","ParentKey":"v6lcadj1wfomboo8ezy","Syntax":"[tplt_syntax]((key_take))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},
  {"ElementType":"object","ElementKey":"v6lcadj1wfomboo8ezy","Name":"Key","ParentKey":"taking_room","Syntax":"[tplt_syntax]((key_id))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":2},{"ElementType":"enter_message","ElementKey":"t9httb814pfmboo8ezy","Name":"","ParentKey":"discover_room","Syntax":"","Logic":"","Output":"\nYou are in the discover test room.\nYou see round tables arrayed throughout.\n\nBefore you do anything, try taking the parchment that you haven't discovered yet.\nThen examine the tables - with x tables.\nNow try taking the parchment.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"ulnl4y2xo6mboo8ezy","Name":"","ParentKey":"428heo3h4dimboo8ezy","Syntax":"","Logic":"","Output":"\nYou look around. You are in the discovery testing room.\nBefore you do anything, try taking the parchment that you haven't discovered yet.\nThen examine the tables - with x tables.\nNow try taking the parchment.\n\nYou see round tables arrayed throughout the large open floor.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"428heo3h4dimboo8ezy","Name":"","ParentKey":"discover_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"kmysvl5li38mboo8ezy","Name":"","ParentKey":"0mec39vbvg2mboo8ezy","Syntax":"","Logic":"","Output":"\nYou examine the tables.\nSome of them have crystal glasses sitting on them, still full of alcohol.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"x_tables","ElementKey":"0mec39vbvg2mboo8ezy","Name":"","ParentKey":"discover_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"zizm6tsjp5gmboo8ezy","Name":"","ParentKey":"64c8mhzw3admboo8ezy","Syntax":"","Logic":"","Output":"\n\nNavigation:\nHome\n","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"navigation","ElementKey":"64c8mhzw3admboo8ezy","Name":"","ParentKey":"discover_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"b58g5f6xo0emboo8ezy","Name":"","ParentKey":"yn8gy18y99mboo8ezy","Syntax":"","Logic":"home","Output":"You return to the testing home room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"yn8gy18y99mboo8ezy","Name":"","ParentKey":"discover_room","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"4ir7d52gi7imboo8ezy","Name":"","ParentKey":"4t4ds0jp17jmboo8ezy","Syntax":"","Logic":"look","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"4t4ds0jp17jmboo8ezy","Name":"","ParentKey":"discover_room","Syntax":"[tplt_syntax]((look))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"iyhrgrm7wrimboo8ezy","Name":"","ParentKey":"m05gmu8dpb8mboo8ezy","Syntax":"","Logic":"x_tables","Output":"","Tags":"!_type|room","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"m05gmu8dpb8mboo8ezy","Name":"","ParentKey":"discover_room","Syntax":"[tplt_syntax]((x_tables))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"room","ElementKey":"discover_room","Name":"Discover Room","ParentKey":"root","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"1fi8b0d2zlbhmboo8ezy","Name":"","ParentKey":"lr08n5fxqskmboo8ezy","Syntax":"","Logic":"","Output":"'false'","Tags":"parchment_found","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"attribute","ElementKey":"iaxgsgsn4smboo8ezy","Name":"","ParentKey":"lr08n5fxqskmboo8ezy","Syntax":"","Logic":"","Output":"'false'","Tags":"parchment_moved","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"px8doup03kmboo8ezy","Name":"","ParentKey":"yatwvtzrujmboo8ezy","Syntax":"","Logic":"","Output":"\nYou see a rolled up parchement.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"tt3w40kwdfmboo8ezy","Name":"","ParentKey":"yatwvtzrujmboo8ezy","Syntax":"","Logic":"?[self]parent = [room]\nand\n?[self]((parchment_moved)) = 'true'","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"look","ElementKey":"yatwvtzrujmboo8ezy","Name":"","ParentKey":"lr08n5fxqskmboo8ezy","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},
  {"ElementType":"message","ElementKey":"vuhwfak6aj7mboo8ezy","Name":"","ParentKey":"yzhucszkvgrmboo8ezy","Syntax":"","Logic":"","Output":"\n\nYou see a partially rolled up piece of parchment sitting on one of the tables.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"ss5ycy2u3yamboo8ezy","Name":"","ParentKey":"yzhucszkvgrmboo8ezy","Syntax":"","Logic":"[self]((parchment_found))","Output":"'true'","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"xq05p1fffmomboo8ezy","Name":"","ParentKey":"yzhucszkvgrmboo8ezy","Syntax":"","Logic":"?[self]parent = 'discover_room'\nand\n?[self]((parchment_moved)) = 'false'","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"x_tables","ElementKey":"yzhucszkvgrmboo8ezy","Name":"","ParentKey":"lr08n5fxqskmboo8ezy","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"message","ElementKey":"kfquofdm1dimboo8ezy","Name":"","ParentKey":"envyoqvuub9mboo8ezy","Syntax":"","Logic":"","Output":"\nYou examine the parchment.\nThe words on the parchment appear to be written in ancient elven tongue.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"um37dow43bbmboo8ezy","Name":"","ParentKey":"envyoqvuub9mboo8ezy","Syntax":"","Logic":"?[self]((parchment_found)) = 'true'","Output":"\nI'm not sure what you're trying to examine.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"x_parchment","ElementKey":"envyoqvuub9mboo8ezy","Name":"","ParentKey":"lr08n5fxqskmboo8ezy","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"action","ElementKey":"fdjcaay5ef8mboo8ezy","Name":"","ParentKey":"el1kpi00ayemboo8ezy","Syntax":"","Logic":"x_parchment","Output":"","Tags":"!_type|self","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"el1kpi00ayemboo8ezy","Name":"","ParentKey":"lr08n5fxqskmboo8ezy","Syntax":"[tplt_syntax]((x_parchment))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"atwzypp77hqmboo8ezy","Name":"","ParentKey":"6n6s2335mafmboo8ezy","Syntax":"","Logic":"[player]","Output":"\nYou pick up the parchment.","Tags":"[self]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"gsdaj3tlutdmboo8ezy","Name":"","ParentKey":"6n6s2335mafmboo8ezy","Syntax":"","Logic":"[self]tags","Output":"+inventory","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"0llfeocspt7mboo8ezy","Name":"","ParentKey":"6n6s2335mafmboo8ezy","Syntax":"","Logic":"[self]((parchment_moved))","Output":"true","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"ufknyrbhunmboo8ezy","Name":"","ParentKey":"6n6s2335mafmboo8ezy","Syntax":"","Logic":"?[self]((parchment_found)) = 'true'","Output":"\nI'm not sure what you're trying to take.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"6n6s2335mafmboo8ezy","Name":"","ParentKey":"lr08n5fxqskmboo8ezy","Syntax":"[tplt_syntax]((parchment_take))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"move","ElementKey":"9rzfedq1yf9mboo8ezy","Name":"","ParentKey":"w90gj35lkcjmboo8ezy","Syntax":"","Logic":"[room]","Output":"\nYou drop the parchment.","Tags":"[self]","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"set","ElementKey":"5y6x767lv6hmboo8ezy","Name":"","ParentKey":"w90gj35lkcjmboo8ezy","Syntax":"","Logic":"[self]tags","Output":"-inventory","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"logic","ElementKey":"eptw9v35eamboo8ezy","Name":"","ParentKey":"w90gj35lkcjmboo8ezy","Syntax":"","Logic":"?[self]parent = [player]","Output":"\nYou aren't carrying a parchment.","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"input","ElementKey":"w90gj35lkcjmboo8ezy","Name":"","ParentKey":"lr08n5fxqskmboo8ezy","Syntax":"[tplt_syntax]((parchment_drop))","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1},{"ElementType":"object","ElementKey":"lr08n5fxqskmboo8ezy","Name":"parchment","ParentKey":"discover_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Active":"true","Sort":1}
];

        // Parsers
            const actionParsers = ["attribute", "logic", "input", "action", "set", "move", "message"];
            const attackParsers = ["attribute", "logic", "action"];
            const fleeParsers = ["attribute", "logic", "action"]; 
            const attributeParsers = ["attribute"];
            const enterMessageParsers = ["logic", "message", "action", "attack", "set"];
            const gameParsers = ["message", "action", "room", "input"];
            const globalParsers = ["logic", "input", "action", "message"];
            const inputParsers = ["logic", "preset", "set", "action", "attack", "flee", "message", "move"];
            const logicParsers = ["logic", "action", "set", "message"];
            const messageParsers = ["logic", "action", "message", "set"];
            const navigationParsers = ["message"];
            const generalParsers = ["logic", "enter_message", "message", "action", "set", "npc"];
            const moveParsers = ["logic", "set", "message"];
            const npcParsers = ["travel", "enter_message", "logic", "input", "action", "attack", "set", "message", "dev_note"];
            const objectParsers = ["travel", "enter_message", "object", "logic", "action", "set", "move", "message", "input", "dev_note"];
            const playerParsers = ["message", "attack", "flee", "input", "dev_note"];
            const roomParsers = ["logic", "action", "enter_message", "set", "object", "message", "input", "npc", "move", "navigation", "dev_note"];
            const roundParsers = ["logic", "action", "set"];
            const rulesetParsers = ["rule"];
            const ruleParsers = ["rule"];
            const setParsers = ["logic", "set"];
            const travelParsers = ["enter_message", "logic", "move", "message"];
            const weaponParsers = ["dev_note"];

        // Config Items
            const selfTypes = ["object", "room", "player", "npc", "game", "global"];
            const canContainCustomElems = ["npc", "object", "room"];
            const operands = [" != ", " >= ", "<= ", " !~~ ", " ~~ ", " >< ", " <> ", " = ", " > ", " < "];
            // Special Tags
                const adminPassTag = "!_adminpass";
                const defActTag = "!_defact";
                const errorTag = "!_error";
                const dieTag = "!_die";
                const startTag = "!_start";
                const armTag = "!_arm";
                const armedTag = "!_armed";
                const lifeTag = "!_life";
                const hitScoreTag = "!_hitscore";
                const damageTag = "!_damage";
                const damageAdjustTag = "!_damageadj";
                const weaponTag = "!_weapon";
                const hitMsgTag = "!_hitmsg";
                const hitPlayerMsgTag = "!_hitplayermsg";
                const missMsgTag = "!_missmsg";
                const missPlayerMsgTag = "!_missplayermsg";
                const killMsgTag = "!_killmsg";
                const limboValue = "!_limbo";
                const enterTag = "!_enter";
                const leaveTag = "!_leave";
                const listTag = "!_list";
                const bulletTag = "!_bullet";
                const spawnTag = "!_spawn";
                const testTag = "!_test";
                const typeTag = "!_type";
                const titleTag = "!_title";
                const typeEasing = "!_easingrounds";

        // Classes
            const gameOutput = {
                "MatchMade": "false",
                "InputMatchMade": "false",
                "ContinueParsing": "true",
                "EnterMsgDone": "false",
                "Output": ""
            };
            const userInput = {
                "Input": ""
            };

        // Global Vars
            let gameStarted = false;
            let adminMode = false;
            let macroRecording = false;
            let macroPlaying = false;
            let currentMacro = "";
            const br = "\n";
            const output = document.getElementById("output");
            const input = document.getElementById("input");
            const gameInterface = document.getElementById("game-interface");
            const elementTypes = [
                "action", "attack", "attribute", "dev_note", "enter_message", "global", "injection",
                "input", "logic", "message", "move", "navigation", "nothing", "npc", "object",
                "room", "set", "travel"
            ];
            let macroRunning = false;
            let macroTesting = false;
            let currentEnemy = "";
            let playerDead = false;

            const maxHistorySize = 50;
            const inputHistory = [];
            let historyIndex = -1; // -1 means we're not currently in the history

            const testResults = [];
            const failString = ' <span style="color: red;">Failed</span>';
            const passString = ' <span style="color: green;">Passed</span>';

            let fightRoundsMax = 3;
            let currentFightRound = 0;
            let enemyArmorAdjust = 0;


        function logMessage(message) {
            output.innerHTML = message + "<br>";
            output.scrollTop = output.scrollHeight;
        }

        function saveFile() {
            const elemLimit = 20; // Number of elements per line
            const htmlDoc = document.documentElement.cloneNode(true);
            htmlDoc.querySelector("#output").innerHTML = ""; // Clear output before saving
            let fileName = "worldweaver";

            let fileNameElem = database.find(item => item.Tags === "!_filename") ?? null;
            if (fileNameElem)
            {
                fileName = toSafeFilename(fileNameElem.Output);
            }

            // Make sure the latest database is stored
            const latestDatabase = JSON.parse(JSON.stringify(database)); // Deep clone to ensure correctness

            // Build compact JSON with newlines every elemLimit items
            const lines = [];
            for (let i = 0; i < latestDatabase.length; i += elemLimit) {
                let chunk = latestDatabase.slice(i, i + elemLimit);
                lines.push(JSON.stringify(chunk).slice(1, -1)); // Strip [ and ]
            }
            let formattedDatabase = `[\n  ${lines.join(",\n  ")}\n]`;

            // Ensure correct replacement of the old database
            let htmlContent = "<!DOCTYPE html>" + htmlDoc.outerHTML;
            htmlContent = htmlContent.replace(/let database = \[([\s\S]*?)\];/, `let database = ${formattedDatabase};`);

            let blob = new Blob([htmlContent], { type: "text/html" });
            let a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `${fileName}.html`;
            a.click();
        }

        // Events
        input.addEventListener("keypress", (event) => {
            if (event.key === "Enter") {
                const command = input.value.trim();
                if (command) {
                    processInput(command);
                    showOutput();
                }
                input.value = "";
            }
        });
        input.addEventListener("keydown", (event) => {
            if (event.key === 'ArrowUp') {
                if (inputHistory.length === 0) return;
                event.preventDefault();
                if (historyIndex === -1) {
                    historyIndex = inputHistory.length - 1;
                } else if (historyIndex > 0) {
                    historyIndex--;
                }
                input.value = inputHistory[historyIndex];
            }

            // Handle Down Arrow
            else if (event.key === 'ArrowDown') {
                if (inputHistory.length === 0) return;
                event.preventDefault();
                if (historyIndex !== -1) {
                    historyIndex++;
                    if (historyIndex >= inputHistory.length) {
                        historyIndex = -1;
                        input.value = '';
                    } else {
                        input.value = inputHistory[historyIndex];
                    }
                }
            }
        });

        function showOutput()
        {
            if (gameOutput.MatchMade && gameOutput.Output)
            {
                if (testResults.length > 0)
                {
                    showTestResults();
                }
                else
                {
                    setOutputHtml();
                }
            }
        }
        function setOutputHtml()
        {
            const roomName = getCurrentRoom().Name;
            if (roomName !== "")
            {
                output.innerHTML = roomName + "<br /><br />";
            }

            output.innerHTML += gameOutput.Output + "<br />";
            output.scrollTop = output.scrollHeight;
        }


        function showGameStartScreen()
        {
            const playerElem = getPlayer();

            if (playerElem.Name === "")
            {
                output.innerHTML = "Set player name:";
                return;
            }

            if (!gameStarted)
            {
                const easing = getChildByTag(getGame(), typeEasing);
                if (easing !== null && easing.Output && easing.Output !== "")
                {
                    fightRoundsMax = Number(easing.Output);
                }


                const startMsg = database.find(item => item.ParentKey === getGameKey() && tagsContain(item.Tags, startTag)) ?? null;
                if (startMsg !== null)
                {
                    gameOutput.Output = startMsg.Output;
                }
                gameStarted = true;
            }
            else
            {
                output.innerHTML = "";
            }
        }


        window.onload = function() {
            gameInterface.style.display = "flex";

            

            fixFolders();
            doOnStartInjection();
            doOnStartRandomFixes();

            showGameStartScreen();

            // Ensure the database is not overwritten if it was injected from a saved file
            if (!Array.isArray(database) || database.length === 0) {
                database = [];
            }

            input.focus();
        };



        function fixFolders() {
            const folders = database.filter(item => item.ElementType === "folder");

            for (const folder of folders)
            {
                const children = getChildren(folder, true);
                for (let child of children)
                {
                    let parent = getElementByKey(child.ParentKey);
                    while (parent.ElementType === "folder" && parent.ParentKey !== null)
                    {
                        parent = getElementByKey(parent.ParentKey);
                    }
                    if (parent)
                    {
                        child.ParentKey = parent.ElementKey;
                    }
                    else
                    {
                        child.ParentKey = null;
                    }
                }
            }
        }

        function doOnStartInjection()
        {
            const injElems = database.filter(item => item.ElementType === "injection");

            for (const inj of injElems)
            {
                const parentElem = getParent(inj);
                const injElem = getElementByKey(inj.Logic);
                if (injElem === null)
                {
                    continue;
                }

                spawnElement(injElem, parentElem);
            }

            // Remove injection elements
            for (const inj of injElems)
            {
                deleteSingleElement(inj.ElementKey);
            }
        }

        function doOnStartRandomFixes()
        {
            const randElems = database
                .filter(item =>
                    typeof item.Output === 'string' &&
                    (item.Output.startsWith("[rand:") || item.Output.startsWith("[roll:"))
                )
                .sort((a, b) => {
                    const getSortRank = (item) => {
                        const output = item.Output;
                        const hasTags = output.includes("<<") && output.includes(">>");
                        if (!hasTags) return 0;
                        if (output.startsWith("[rand:")) return 1;
                        if (output.startsWith("[roll:")) return 2;
                        return 3; // fallback rank (optional)
                    };

                    return getSortRank(a) - getSortRank(b);
                });

            for (const rnd of randElems)
            {
                fixElementRandom(rnd);
            }

            updateInitOutputs();
        }
        function fixElementRandom(currentElement)
        {
            if (currentElement.Output.startsWith("[rand:"))
            {
                currentElement.Output = getRandValue(currentElement, currentElement.Output);
            }
            else
            {
                currentElement.Output = getRollDiceValue(currentElement, currentElement.Output);
            }
        }
        function updateInitOutputs()
        {
            const inits = database.filter(item => typeof item.Output === "string" && item.Output.startsWith("init_"));

            for (const init of inits)
            {
                const tgts = getTargets(init, init.Output.replace("init_", ""));
                if (tgts.length === 1)
                {
                    init.Output = tgts[0].Output;
                }
            }
        }

        function doRandomRoll(rndElement, rndString) {
            if (rndString.startsWith("rdm_")) {
                rndString = rndString.replace("rdm_", "");
            }
            if (rndString.startsWith("[rand:")) {
                return getRandValue(rndElement, rndString);
            } else {
                return getRollDiceValue(rndElement, rndString);
            }
        }

        function getRandValue(rndElement, rndString) {
            const range = rndString.replace("[rand:", "").replace(/](?!.*])/ , "").split("|");
            let rndVal = 0;
            let selElems = null;
            if (range.length === 2)
            {
                if (range[0].startsWith("<<"))
                {
                    selElems = getTargets(rndElement, range[0])?.[0] ?? null;
                    if (selElems === null)
                    {
                        range[0] = 0;
                    }
                    else
                    {
                        range[0] = selElems.Output;
                    }
                }
                if (range[1].startsWith("<<"))
                {
                    selElems = getTargets(rndElement, range[1])?.[0] ?? null;
                    if (selElems === null)
                    {
                        range[1] = 0;
                    }
                    else
                    {
                        range[1] = selElems.Output;
                    }
                }

                rndVal = getRandomByRange(range[0], range[1]);
                return rndVal;
            }
        }

        function getRandomByRange(min, max)
        {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getRollDiceValue(rndElement, rndString)
        {
            let roll = rndString.replace("[roll:", "").replace(/](?!.*])/ , "");
            let rndVal = -1;
            let rollVals = [];
            let totalDice = 0;
            let modValue = 0;
            let totalNumOfDice = 0;

            roll = roll.replace(/<<([^<>]+)>>/g, (match, rndString) => {
                return getTargets(rndElement, rndString)?.[0]?.Output ?? "";
            });

            if (roll.includes("+") || roll.includes("-"))
            {
                const delimiter = "+";
                if (roll.includes("-"))
                {
                    delimiter = "-";
                }
                modValue = processModifier(rndElement, delimiter, roll);
                const arr = roll.split(delimiter);
                if (arr.Length === 2)
                {
                    roll = arr[0].trim();
                }
            }

            if (roll.includes("(") && roll.includes(")"))
            {
                let arr = roll.split(")");
                if (arr.length == 2)
                {
                    roll = arr[1].trim();
                    arr[0] = arr[0].replace("(", "");
                    try
                    {
                        totalNumOfDice = Number(arr[0]);
                    }
                    catch (Exception)
                    {
                        totalNumOfDice = 0;
                    }
                }
            }

            let diceSpec = roll.split('d');
            try
            {
                if (diceSpec.length == 2)
                {
                    const numOfDice = Number(diceSpec[0].trim());
                    if (diceSpec[1].includes("+") || diceSpec[1].includes("-"))
                    {
                        let sidesArr = diceSpec[1].split("+");
                        if (sidesArr.length !== 2)
                        {
                            sidesArr = diceSpec[1].split("-");
                            diceSpec[1] = sidesArr[0];
                        }
                        else
                        {
                            diceSpec[1] = sidesArr[0];
                        }
                    }
                    const sides = Number(diceSpec[1].trim());
                    let total = 0;
                    let rollNum = numOfDice;
                    if (totalNumOfDice > numOfDice)
                    {
                        rollNum = totalNumOfDice;
                    }

                    for (let rolls = 0; rolls <= rollNum - 1; rolls++)
                    {
                        const rollVal = getRandomByRange(1, sides + 1);
                        rollVals.push(rollVal);
                    }

                    if (totalNumOfDice > numOfDice)
                    {
                        const sorted = rollVals.sort((a, b) => b - a);
                        const taken = sorted.slice(0, numOfDice);
                        total = taken.reduce((acc, curr) => acc + curr, 0);
                    }
                    else {
                        total = rollVals.reduce((acc, curr) => acc + curr, 0);
                    }

                    rndVal = total;

                    total = total + modValue;

                    return total;
                }
            }
            catch (Exception)
            {
                return rndVal;
            }
        }


        // Fighting
        function showFightInterface(initMsg = "") {
            currentFightRound = 0;
            enemyArmorAdjust = 0;

            // Fighting is not allowed while macro processes are running
            if (macroRecording || macroRunning)
            {
                return;
            }

            let initMsgElem = document.getElementById("fight-intro");
            let msg = document.getElementById("fight-message");
            if (initMsg !== "") {
                initMsgElem.innerHTML = initMsg;
            }
            const player = getPlayer();
            const enemy = currentEnemy;
            const lifeStat = getChildrenByTag(player, lifeTag)?.[0]?.Output || "0";
            let enemyLifeStat = getChildrenByTag(enemy, lifeTag)?.[0]?.Output || "-1";
            document.getElementById("player-life").textContent = lifeStat;
            if (enemyLifeStat < 0)
            {
                enemyLifeStat = 1;
            }
            document.getElementById("enemy-life").textContent = enemyLifeStat;

            msg.innerHTML = "";
            gameInterface.style.display = "none";
            document.getElementById("fight-interface").style.display = "flex";
        }

        function exitFight() {
            document.getElementById("fight-interface").style.display = "none";
            gameInterface.style.display = "flex";
            doDefaultRoomAction();
            input.focus();
        }

        function attackEnemy() {
            // Ensure the player can actually hit the enemy
            // But this resets any time the player hits the enemy,
            // so it doesn't alleviate the difficulty
            if (currentFightRound > fightRoundsMax)
            {
                enemyArmorAdjust--;
                currentFightRound = 0;
            }

            let msg = document.getElementById("fight-message");
            let enemyLifeEl = document.getElementById("enemy-life");
            let currentLife = parseInt(enemyLifeEl.textContent);
            const playerWeapon = getArmedWeapon(getPlayer());
            const attackRoll = getRollDiceValue(getPlayer(), "[roll:1d20]");
            const enemyHitScore = getHitScore(currentEnemy) + enemyArmorAdjust;

            const missMsg = getChildMessageByTag(currentEnemy, missMsgTag, "You have missed.");
            const hitMsg = getChildMessageByTag(currentEnemy, hitMsgTag, "You hit your enemy.");
            const killMsg = getChildMessageByTag(currentEnemy, killMsgTag, "You have killed your enemy.");

            if (attackRoll <= enemyHitScore)
            {
                currentFightRound++;

                msg.innerHTML = missMsg;
                setTimeout(() => {
                    attackPlayer();
                }, 2000); // 1 second delay
                return;
            }

            // Reset the easing of the enemy's armor
            enemyArmorAdjust = 0;

            const damage = getDamageValue(playerWeapon);
            const damageAttribAdj = getChildrenByTag(getPlayer(), damageAdjustTag)?.[0] ?? null;
            if (damageAttribAdj !== null && Number(damageAttribAdj.Output)) {
                damage = damage + Number(damageAttribAdj.Output);
            }

            currentLife -= damage;

            if (isNaN(currentLife)) { // !@! TODO: why is this NaN??
                currentLife = 0;
            }

            if (currentLife <= 0) {
                enemyLifeEl.textContent = "0";
                alert(killMsg);

                let enemy = getElementByKey(currentEnemy.ElementKey);
                enemy.ParentKey = "limbo";
                deleteElement(currentEnemy.ElementKey);

                currentEnemy = "";

                exitFight();
            } else {
                enemyLifeEl.textContent = currentLife.toString();

                msg.innerHTML = hitMsg;
                setTimeout(() => {
                    attackPlayer();
                }, 2000); // 1 second delay
            }
        }

        function attackPlayer() {
            let msg = document.getElementById("fight-message");
            let playerLifeEl = document.getElementById("player-life");
            let currentLife = parseInt(playerLifeEl.textContent);
            const enemyWeapon = getArmedWeapon(currentEnemy);
            const attackRoll = getRollDiceValue(getPlayer(), "[roll:1d20]");
            const playerHitScore = getHitScore(getPlayer());
            const player = getPlayer();

            const hitMsg = getChildMessageByTag(player, hitPlayerMsgTag, "You have been hit.");
            const missMsg = getChildMessageByTag(currentEnemy, missPlayerMsgTag, "The attack on you has failed.");
            const dieMsg = getChildMessageByTag(player, dieTag, "x_x");

            if (attackRoll <= playerHitScore)
            {
                msg.innerHTML = missMsg;
                return;
            }

            msg.innerHTML = hitMsg;

            const damage = getDamageValue(enemyWeapon);
            const damageAttribAdj = getChildrenByTag(currentEnemy, damageAdjustTag)?.[0] ?? null;
            if (damageAttribAdj !== null && Number(damageAttribAdj.Output)) {
                damage = damage + Number(damageAttribAdj.Output);
            }

            currentLife -= damage;
            let lifeStat = getChildByTag(player, lifeTag);
            lifeStat.Output = currentLife;

            if (isNaN(currentLife)) { // !@! TODO: why is this NaN??
                currentLife = 0;
            }

            if (currentLife <= 0) {
                playerLifeEl.textContent = "0";
                playerDead = true;
                alert(dieMsg);

                exitFight();
            } else {
                playerLifeEl.textContent = currentLife.toString();
            }
        }


        // Helper Methods
            function getGame()
            {
                return database.find(item => item.ElementType === "game");
            }
            function getGameKey()
            {
                return getGame().ElementKey;
            }
            function getElement(referenceString, currentElement)
            {
                if (referenceString === "[room]")
                {
                    return getCurrentRoom();
                }
                if (referenceString === "[player]")
                {
                    return getPlayer();
                }
                if (referenceString === "[self]")
                {
                    return getSelf(currentElement);
                }
                if (referenceString === "[syntax]")
                {
                    let elem = null;
                    elem = getChildrenBySyntax(getPlayer(), userInput.Input);
                    if (elem !== null)
                    {
                        return elem;
                    }
                    elem = getChildrenBySyntax(getCurrentRoom(), userInput.Input);
                    if (elem !== null)
                    {
                        return elem;
                    }
                    elem = getChildrenBySyntax(getSelf(currentElement), userInput.Input);
                    if (elem !== null)
                    {
                        return elem;
                    }
                }

                return getElementByKey(referenceString);
            }
            function getChildrenBySyntax(parentElement, syntax)
            {
                const children = getChildren(parentElement, false);
                for (const child of children)
                {
                    const sntxTgt = getTargets(child, child.Syntax);
                    let sntx = child.Syntax;
                    if (sntxTgt.length > 0 && sntxTgt[0])
                    {
                        sntx = sntxTgt[0].Output;    
                    }

                    if (regexCheck(sntx, syntax))
                    {
                        return child;
                    }
                }

                return null;
            }
            function getElementByKey(elementKey)
            {
                let foundElem = database.find(item => item.ElementKey === elementKey) ?? null;
                return foundElem;
            }
            function getElementsByType(elementType)
            {
                return database.filter(item => item.ElementType === elementType).orderBy(e => parseInt(e.Sort));
            }
            function getElementsByTag(tag)
            {
                return database.filter(item => tagsContain(item.Tags, tag) === true);
            }
            function getParent(currentElement)
            {
                if (currentElement.ParentKey === null)
                {
                    return null;
                }
                let parentElem = database.find(item => item.ElementKey === currentElement.ParentKey) ?? null;
                return parentElem;
            }
            function getChildrenByTag(parentElement, tag)
            {
                const children = getChildren(parentElement, true);
                let foundChildren = [];
                for (const child of children)
                {
                    if (tagsContain(child.Tags, tag))
                    {
                        foundChildren.push(child);
                    }
                }
                return foundChildren;
            }
            function getChildrenByType(parentElement, type)
            {
                const children = database.filter(item => item.ParentKey === parentElement.ElementKey && item.ElementType == type);
                return children;
            }
            function getChildByTag(parentElement, tag)
            {
                let children = getChildren(parentElement, true);
                return children.filter(item => tagsContain(item.Tags, tag)).orderBy(e => parseInt(e.Sort))?.[0] ?? null;
            }
            function getChildMessageByTag(parentElement, tag, defaultMessage)
            {
                let children = getChildren(parentElement, true);
                return children.filter(item => tagsContain(item.Tags, tag)).orderBy(e => parseInt(e.Sort))?.[0]?.Output ?? defaultMessage;
            }
            function getChildren(parentElement, includeAttributes)
            {
                if (includeAttributes)
                {
                    return database.filter(item => item.ParentKey === parentElement.ElementKey).orderBy(e => parseInt(e.Sort));
                }
                else
                {
                    return database.filter(item => item.ParentKey === parentElement.ElementKey && item.ElementType !== "attribute").orderBy(e => parseInt(e.Sort));
                }
            }
            function getChildObjects(parentElement)
            {
                return database.filter(item => item.ParentKey === parentElement.ElementKey && item.ElementType === "object").orderBy(e => parseInt(e.Sort));
            }
            function getSelf(currentElement)
            {
                if (selfTypes.includes(currentElement.ElementType)) {
                    return currentElement;
                }
                let parentElem = getParent(currentElement);
                if (parentElem === null)
                {
                    return currentElement;
                }
                if (selfTypes.includes(parentElem.ElementType))
                {
                    return parentElem;
                }
                else
                {
                    return getSelf(parentElem);
                }
            }
            function getCurrentRoom()
            {
                const playerElem = getPlayer();
                let roomElem = getElementByKey(playerElem.ParentKey);
                return roomElem;
            }
            function getPlayer()
            {
                return getElementsByType("player")[0];
            }
            function setPlayerArmed(elementKey)
            {
                let armedAttrib = database.find(item => item.ParentKey === getPlayer().ElementKey && tagsContain(item.Tags, armedTag)) ?? null;
                if (armedAttrib === null)
                {
                    return;
                }
                armedAttrib.Output = elementKey;
            }
            function setDefaultWeapon(droppingElement)
            {
                const weapons = database.find(item => item.ParentKey === getPlayer().ElementKey &&
                                            tagsContain(item.Tags, weaponTag) &&
                                            item.ElementKey !== droppingElement.ElementKey) ?? null;
                if (weapons === null)
                {
                    setPlayerArmed("");
                    return;
                }

                setPlayerArmed(weapons.ElementKey);
            }
            function getPlayerInventory()
            {
                return database.filter(item => item.ParentKey === getPlayer().ElementKey && tagsContain(item.Tags, "inventory"));
            }

            function getArmedWeapon(parentElement)
            {
                const armedAttrib = getChildrenByTag(parentElement, armedTag)?.[0] ?? null;
                if (armedAttrib === null)
                {
                    return;
                }

                if (armedAttrib !== null)
                {
                    weaponKey = armedAttrib.Output;
                }
                if (weaponKey === "")
                {
                    return null;
                }

                return getElementByKey(weaponKey);
            }

            function getHitScore(parentElement)
            {
                const armorAttrib = getChildrenByTag(parentElement, hitScoreTag);
                if (armorAttrib === null ||
                    armorAttrib.length !== 1)
                {
                    return 7;
                }

                return processSpecialOutputRelElems(parentElement, armorAttrib[0].Output);
            }

            function getDamageValue(armedWeapon)
            {
                if (armedWeapon === null)
                {
                    return 1;
                }
                const damageAttrib = getChildrenByTag(armedWeapon, damageTag)?.[0] ?? null;
                if (damageAttrib === null)
                {
                    return 1;
                }
                const rndString = damageAttrib.Logic;
                return doRandomRoll(armedWeapon, rndString);
            }

            function horizLine(title)
            {
                let hr = "";

                for (let i = 0; i < title.length; i++)
                {
                    hr += "-";
                }

                return hr;
            }

            function outputMatch(message, doAppend)
            {
                if (message === "")
                {
                    return;
                }

                gameOutput.MatchMade = true;
                if (doAppend)
                {
                    gameOutput.Output += message;
                }
                else
                {
                    gameOutput.Output = message;
                }
            }
            function splitWithLimit(str, delimiter, limit)
            {
                if (limit <= 0) return [];
                if (limit === 1) return [str];
                
                const result = [];
                let remaining = str;
                let index;
                
                for (let i = 0; i < limit - 1; i++)
                {
                    index = remaining.indexOf(delimiter);
                    if (index === -1)
                    {
                        break;
                    }
                    result.push(remaining.slice(0, index));
                    remaining = remaining.slice(index + delimiter.length);
                }
                
                result.push(remaining);
                return result;
            }
            function tagsContain(tags, tagString)
            {
                const taglist = tags.split("|");
                return taglist.includes(tagString);
            }
            function addTag(currentElement, tagString)
            {
                if (currentElement.Tags === undefined)
                {
                    return;
                }
                if (currentElement.Tags === "")
                {
                    currentElement.Tags = tagString;
                    return;
                }
                let taglist = currentElement.Tags.split("|");
                if (!taglist.includes(tagString))
                {
                    taglist.push(tagString);
                }
                currentElement.Tags = taglist.join("|");
            }
            function removeTag(currentElement, tagString)
            {
                let taglist = currentElement.Tags.split("|").filter(item => item !== tagString);
                currentElement.Tags = taglist.join("|");
            }
            function toSafeFilename(input) {
                if (typeof input !== 'string') return 'worldweaver';

                // Normalize string: lowercase, remove accents
                let safe = input.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

                // Replace non-alphanumeric characters with hyphens
                safe = safe.replace(/[^a-z0-9]+/g, '-');

                // Collapse multiple hyphens and trim
                safe = safe.replace(/-+/g, '-').replace(/^-+|-+$/g, '');

                return safe || 'worldweaver';
            }
            function processModifier(currentElement, modifier, roll)
            {
                const arr = roll.split(modifier);
                var modifierVal = 0;

                if (arr.length != 2)
                {
                    return 0;
                }

                try{
                    modifierVal = Number(getTargets(currentElement, arr[1].trim())?.[0] ?? "");
                    if (modifier === "-")
                    {
                        modifierVal = -(modifierVal);
                    }
                }
                catch (Exception)
                {
                    return 0;
                }

                return modifierVal;
            }
            function getGuid()
            {
                return Math.random().toString(36).substring(2) + (new Date()).getTime().toString(36);
            }
            Array.prototype.orderBy = function(selector, desc = false) {
              return [...this].sort((a, b) => {
                a = selector(a);
                b = selector(b);
            
                if (a == b) return 0;
                return (desc ? a > b : a < b) ? -1 : 1;
              });
            };
            function deleteElement(elementKey)
            {
                // Find all children of the element
                const children = database.filter(el => el.ParentKey === elementKey);

                // Recursively delete each child first
                for (let child of children) {
                    deleteElement(child.ElementKey);
                }

                // Now remove the element itself
                const index = database.findIndex(el => el.ElementKey === elementKey);
                if (index !== -1) {
                    database.splice(index, 1);
                }
            }
            function deleteSingleElement(elementKey)
            {
                const index = database.findIndex(el => el.ElementKey === elementKey);
                if (index !== -1) {
                    database.splice(index, 1);
                }
            }
            function regexCheck(regexString, inputString)
            {
                if (regexString === "" || inputString === "")
                {
                    return false;
                }
                const pattern = new RegExp(regexString, 'i');
                if (pattern.test(inputString))
                {
                    return true;
                }
                return false;
            }
            function doDefaultRoomAction()
            {
                let defaultCmd = getElementsByTag(defActTag)?.[0] ?? null;
                if (defaultCmd === null)
                {
                    parseRoom(roomParsers, false);
                    return;
                }
                defaultCmd = defaultCmd.Output;
                userInput.Input = defaultCmd;
                processInput(defaultCmd);
                showOutput();
            }

            function processSpecialOutput(currentElement, output)
            {
                const match = output.match(/^(\r?\n)*/);
                const leading = match ? match[0] : "";
                output = output.slice(leading.length);

                output = processSpecialOutputRelElems(currentElement, output);
                output = processInlineLogic(currentElement, output);

                output = leading + output;

                return output;
            }
            function processSpecialOutputRelElems(currentElement, output)
            {
                let startPos = 0;
                let endPos = 0;
                let specialString = "";
                let newValue = "";
                let tgts = null;
                let field = "";

                startPos = output.indexOf("<<");

                while (startPos >= 0)
                {
                    newValue = "";
                    endPos = output.indexOf(">>", startPos) + 2;
                    specialString = output.substring(startPos, endPos);

                    if (specialString.startsWith("<<rdm_"))
                    {
                        newValue = doRandomRoll(currentElement, specialString.replace("<<", "").replace(">>", "").replace("rdm_", ""));
                    }
                    else
                    {
                        tgts = getTargets(currentElement, specialString);
                        if (tgts !== null)
                        {
                            field = getField(specialString.replace("<<", "").replace(">>", ""));
                            newValue = getFieldValue(tgts[0], field);
                        }
                    }
                    output = output.replace(specialString, newValue);
                    startPos = output.indexOf("<<");
                }

                return output;
            }
            function processInlineLogic(currentElement, output)
            {
                let startPos = 0;
                let endPos = 0;

                startPos = output.indexOf("<?");

                while (startPos >= 0)
                {
                    // endPos = output.LastIndexOf("</?>") + 3;
                    endPos = getEndPos(output, startPos) + 4;
                    let replaceBlock = output.substring(startPos, endPos);
                    let lgcBlock = replaceBlock.substring(2, replaceBlock.length - 5);
                    let newValue = "";
                    const arr = splitWithLimit(lgcBlock, "?>", 2);
                    if (arr.length != 2)
                    {
                        output = output.replace(
                            lgcBlock,
                            "!! SOMETHING WENT WRONG IN THE COMPARISON LOGIC !!"
                        );
                    }
                    const compareBlock = arr[0].trim();
                    let contentBlock = arr[1];
                    let elseBlock = "";

                    if (contentBlock.includes("<else>"))
                    {
                        var arr2 = contentBlock.split("<else>");
                        contentBlock = arr2[0].trim();
                        elseBlock = arr2[1].trim();
                    }

                    if (parseLogic(getElementByKey(currentElement.ParentKey), currentElement, "?" + compareBlock))
                    {
                        newValue = contentBlock;
                    }
                    else
                    {
                        newValue = elseBlock;
                    }

                    output = output.replace(replaceBlock, newValue);

                    startPos = output.indexOf("<?");
                }

                return output;
            }

            function getEndPos(output, startPos)
            {
                let endPosOut = 0;
                let snippet = "";
                let childCount = 0;
                let startTmp = startPos + 2;

                endPosOut = output.indexOf("</?>");

                while (startTmp < endPosOut)
                {
                    snippet = output.substring(startTmp, endPosOut + 3);
                    if (snippet.includes("<?"))
                    {
                        childCount++;
                        startTmp = output.indexOf("<?", startTmp) + 2;
                    }
                    else
                    {
                        break;
                    }
                }

                endPosOut = output.indexOf("</?>");

                if (childCount == 0)
                {
                    return endPosOut;
                }

                for (let c = 0; c <= childCount; c++)
                {
                    endPosOut = output.indexOf("</?>", endPosOut) + 3;
                }

                return endPosOut;
            }

            function parseConditional(currentElement, lines)
            {
                let passed = true;
                let curCheck = true;
                let operand = "";

                for (const line of lines)
                {
                    let curline = line.trim();

                    switch (curline.toLowerCase())
                    {
                        case "and":
                            if (!curCheck)
                            {
                                return curCheck;
                            }
                            break;

                        case "or":
                            if (curCheck)
                            {
                                return curCheck;
                            }
                            break;
                    }

                    if (curline.startsWith("?"))
                    {
                        curline = curline.splice(1);
                        curCheck = processLogicRow(getElementByKey(currentElement.ParentKey), currentElement, curline);
                    }
                }

                passed = curCheck;

                return passed;
            }

            function getOperand(line)
            {
                for (const op of operands)
                {
                    var arr = line.split(op);
                    if (arr.length > 1)
                    {
                        return op;
                    }
                }

                return "";
            }


            function createNewMacroElement(
                elementType,
                elementKey
            )
            {
                return createNewFullElement(
                    elementType,
                    elementKey,
                    "",
                    "",
                    "",
                    "",
                    [],
                    "",
                    "",
                    0
                );
            }
            function createNewFullElement(
                elementType,
                elementKey,
                name,
                parentKey,
                syntax,
                logic,
                output,
                tags,
                repeat,
                sort
            ) {
                if (elementKey == "") {
                    elementKey = getGuid();
                }

                let entry = {
                    ElementType: elementType,
                    ElementKey: elementKey,
                    Name: name,
                    ParentKey: parentKey,
                    Syntax: syntax,
                    Logic: logic,
                    Output: output,
                    Tags: tags,
                    Repeat: repeat,
                    RepeatIndex: "0",
                    Active: "true",
                    Sort: sort
                };

                return entry;
            }


            // End Helper Methods



        // Process the Player's input.
        // This will call all the other parsers.
        function processInput(command) {
            if (playerDead === true) {
                output.innerHTML = "You are dead.";
                return;
            }

            if (macroRecording && !command.startsWith("_macro")) {
                currentMacro.Output.push(command);
            }

            if (!macroRunning) {
                if (command) {
                    inputHistory.push(command);
                    if (inputHistory.length > maxHistorySize) {
                        inputHistory.shift(); // Remove oldest
                    }
                }
                historyIndex = -1; // Reset history index
            }

            userInput.Input = command;
            gameOutput.InputMatchMade = false;
            gameOutput.MatchMade = false;
            gameOutput.Output = "";
            gameOutput.ContinueParsing = true;
            gameOutput.EnterMsgDone = false;
            output.scrollTop = output.scrollHeight;
            let playerElem = getPlayer();

            processAdminInput(command);
            if (gameOutput.MatchMade) {
                return;
            }

            if (playerElem.Name === "" &&
                userInput.Input != "save" &&
                userInput.Input != "help") {
                output.innerHTML = "";
                playerElem.Name = userInput.Input;
                showGameStartScreen();
                parseGame(gameParsers);
                parseRoom(roomParsers, true);
                parsePlayer(playerParsers);
                gameOutput.EnterMsgDone = true;

                processNavigation();
                return;
            }

            if (userInput.Input === "save") {
                saveFile();
                input.value = "";
                input.focus();
                return;
            }

            output.innerHTML = "";

            if (command === "help") {
                outputMatch("I am here to help you!", false);
                gameOutput.MatchMade = true;
                return;
            }

            if (gameStarted) {
                handleTravel();
                parseGame(gameParsers);
                parseGlobal(globalParsers);
                parseRoom(roomParsers, false);
                parsePlayer(playerParsers);

                processNavigation();

                if (!gameOutput.Output || gameOutput.Output === "") {
                    const errMsg = getChildByTag(getElementByKey(getGameKey()), errorTag);
                    if (errMsg !== null) {
                        gameOutput.Output = errMsg.Output;
                        setOutputHtml();
                        return;
                    }
                }

                if (adminMode) {
                    parseDevNotes();
                }

                gameOutput.EnterMsgDone = true;
            }
        }

        function processNavigation() {
            if (roomParsers.includes("navigation")) {
                for (const nav of getChildrenByType(getCurrentRoom(), "navigation")) {
                    const doContinue = gameOutput.ContinueParsing;
                    gameOutput.ContinueParsing = true;
                    parseElement(nav, navigationParsers); 
                    gameOutput.ContinueParsing = doContinue;
                }
            }
        }

        function processAdminInput(command) {
            switch (true) {
                case (command === "_admin"):
                    showAdminHelp();
                    gameOutput.MatchMade = true;
                    break;

                case command.startsWith("_admin "):
                    if (doAdminLogin(command)) {
                        gameOutput.MatchMade = true;
                        return;
                    }
                    break;

                case command.startsWith("_devnotes") && adminMode:
                    if (doAdminDevNotes(command.replace("_devnotes", ""))) {
                        gameOutput.MatchMade = true;
                        return;
                    }

                case command.startsWith("_macror") && adminMode:
                    doAdminMacroRecord(command.replace("_macror", ""))
                    gameOutput.MatchMade = true;
                    return;

                case command.startsWith("_macrols") && adminMode:
                    doAdminMacroList(command.replace("_macrols", ""))
                    gameOutput.MatchMade = true;
                    return;

                case command.startsWith("_macrots ") && adminMode:
                    macroTesting = true;
                    doAdminMacroRun(command.replace("_macrots ", ""));
                    return;

                case command.startsWith("_macro ") && adminMode:
                    macroTesting = false;
                    doAdminMacroRun(command.replace("_macro ", ""));
                    return;

                case command === "_macros" && adminMode:
                    doAdminMacroStop()
                    gameOutput.MatchMade = true;
                    return;
            }
        }
        function showAdminHelp() {
            let helpText = "";

            helpText += "Admin Commands:<br /><br />";
            helpText += "<li><strong>_admin</strong> : Shows this help document</li>";
            helpText += "<li><strong>_admin (admin password)</strong> : Toggles admin mode</li>";
            helpText += "<li><strong>_devnotes (optional filter text)</strong> : Shows dev notes - regardless of the room you are in</li>";
            helpText += "<li><strong>_macror (unique macro name)</strong> : Begins recording a macro</li>";
            helpText += "<li><strong>_macros</strong> : Stops recording the current macro and gives you the code/steps to add it to your game</li>";
            helpText += "<li><strong>_macrols</strong> : Lists all the macros that are in your game</li>";
            helpText += "<li><strong>_macro (macro name)</strong> : Runs the specific macro</li>";
            helpText += "<li><strong>_macrots (macro name)</strong> : Runs the specific macro and processes any tests it encounters</li>";

            output.innerHTML = helpText;
        }
        function doAdminLogin(command) {
            const passAttrib = getElementsByTag(adminPassTag)?.[0] ?? null;
            if (passAttrib === null) {
                return false;
            }
            if (passAttrib.Output !== command.replace("_admin ", "")) {
                return false;
            }

            adminMode = !adminMode;

            if (adminMode) {
                output.innerHTML = "Admin mode enabled.<br />Use <strong>_admin</strong> without a password, to display admin help.";
                output.style.color = "yellow";
            } else {
                macroRunning = false;
                macroRecording = false;
                output.innerHTML = "Admin mode disabled.";
                output.style.color = "white";
            }

            return true;
        }
        function doAdminDevNotes(command) {
            let devOutput = `${br}${br}${br}Dev Notes:`;
            let dNotes = null;
            
            if (command.trim() === "") {
                dNotes = database.filter(item => item.ElementType === "dev_note");
            } else {
                dNotes = database.filter(item => item.ElementType === "dev_note" && item.Output.includes(command.trim()));
            }
            if (dNotes.length < 1) {
                dNotes = database.filter(item => item.ElementType === "dev_note" && tagsContain(item.Tags, command.trim()));
            }
            if (dNotes.length < 1) {
                return false;
            }

            for (const dNote of dNotes) {
                devOutput += `${br}Parent: ${dNote.ParentKey}${br}Tags: ${dNote.Tags}${br}${dNote.Output}${br}${br}`;
            }

            output.innerHTML = "";
            gameOutput.Output = devOutput;
            return true;
        }

        // Macros
        function doAdminMacroRecord(command) {
            macroRunning = false;
            if (command.trim() === "") {
                output.innerHTML = "Be sure to specify a unique macro name.";
                return;
            }
            const macroName = command.trim();
            const uniqueCheck = database.filter(item => item.ElementKey === macroName);
            if (uniqueCheck.length > 0) {
                output.innerHTML = `There is already a macro in your game called ${macroName}.`;
                return;
            }

            currentMacro = createNewMacroElement("macro", macroName);
            macroRecording = true;
            output.innerHTML = `Macro ${macroName} is now recording...`;
        }
        function doAdminMacroStop() {
            const delString = currentMacro.Output.join("|~|");
            output.innerHTML = `Paste the below macro definition somewhere in your game sources${br}Usually in one central .nrmn file.${br}Then re-import the game source and paste the updated database into your game .html.`;
            output.innerHTML += `${br}${br}`;
            output.innerHTML += `{macro, key=${currentMacro.ElementKey}, output=${delString} }`;
            output.innerHTML += `${br}${br}`;
            output.innerHTML += `If you are using the builder.html to define your game, create an Element and set its Type to 'macro', and its Element Key to: <strong>${currentMacro.ElementKey}</strong> then paste the following into its Output:${br}`;
            output.innerHTML += delString;
            macroRecording = false;
        }
        function doAdminMacroRun(command) {
            testResults.length = 0;
            macroRecording = false;
            currentMacro = database.find(item => item.ElementKey === command.trim()) ?? null;
            if (currentMacro === null) {
                output.innerHTML = `The specified macro: ${command.trim()} could not be found.`;
                return;
            }

            macroRunning = true;

            for (const step of currentMacro.Output.split("|~|")) {
                processInput(step);
            }

            macroRunning = false;
        }
        function doAdminMacroList(command) {
            let selMacros = null;
            let lsOutput = ""

            if (command.trim() === "") {
                selMacros = database.filter(item => item.ElementType === "macro") ?? null;
                if (selMacros === null) {
                    output.innerHTML = "No macros found.";
                    return;
                }

                lsOutput = `Macros:${br}`;
                for (const macro of selMacros) {
                    lsOutput += `${macro.ElementKey}${br}`;
                }
            } else {
                selMacros = database.find(item => item.ElementKey === command.trim()) ?? null;
                if (selMacros === null) {
                    output.innerHTML = "Unable to find that macro.";
                    return;
                }

                lsOutput = `Macro ${selMacros.ElementKey} Details:${br}`;
                for (const macroStep of selMacros.Output.split("|~|")) {
                    lsOutput += `${macroStep}${br}`;
                }
            }

            output.innerHTML = lsOutput;
        }
        function showTestResults() {
            const brt = "<br />";
            output.innerHTML = `<strong>Test Results:</strong>${brt}${brt}`;
            for (const res of testResults) {
                output.innerHTML += `Room: ${res.Room}, Test: ${res.Name}, Result: ${res.Result}${brt}${brt}${brt}${brt}`;
            }
            testResults.length = 0;
        }



        // Travel
        function getActiveTraveling() {
            return database.filter(item => item.ElementType === "travel" && item.Active === "true");
        }
        function getOtherFollowingTraveling() {
            return database.filter(item => item.ElementType === "travel" && item.Logic.startsWith("[follow|") && item.Logic !== "[follow|player]" && item.Active === "true");
        }
        function getPlayerFollowingTraveling() {
            return database.filter(item => item.ElementType === "travel" && item.Logic === "[follow|player]" && item.Active === "true");
        }
        function getAllTraveling() {
            return database.filter(item => item.ElementType === "travel");
        }
        function handleTravel() {
            const trvls = getActiveTraveling();

            for (const trv of trvls) {
                if (trv.Logic.startsWith("[path|")) {
                    handlePath(trv);
                }
            }
        }

        function handlePath(travelElement) {
            const path = travelElement.Logic.replace("[", "").replace("]", "").split("|").slice(1);
            const npc = getSelf(travelElement);
            let nextIx = 0;

            for (let ix = 0; ix < path.length; ix++) {
                if (npc.ParentKey === path[ix]) {
                    nextIx = ix + 1;
                    break;
                }
            }

            if (npc.RepeatIndex == 0) {
                npc.RepeatIndex++;
                return;
            }

            if (nextIx >= path.length) {
                nextIx = 0;
            }

            npc.ParentKey = path[nextIx];
            npc.RepeatIndex = 0;
            return;
        }

        function followPlayer() {
            const trvls = getPlayerFollowingTraveling();

            for (const trv of trvls) {
                let selfElement = getSelf(trv);
                if (selfElement === null) {
                    return;
                }
                const enterMessage = getChildrenByTag(trv, enterTag)?.[0] ?? null;
                if (enterMessage === null) {
                    return;
                }
                selfElement.ParentKey = getCurrentRoom().ElementKey;
                // parseMessage(trv, enterMessage);
            }
        }


        // Run the parsers
        function parseGame(parsers) {
            const gameElem = getElementsByType("game")[0];

            for (let prsr of parsers) {
                for (let child of getChildren(gameElem, false)) {
                    callParser(prsr, gameElem, child);
                }
            }
        }

        function parseAction(currentElement, parsers) {
            if (actionParsers.includes("logic") && !processLogic(currentElement)) {
                return;
            }

            parseElement(currentElement, parsers);

            if (tagsContain(currentElement.Tags, typeTag) &&
                currentElement.Logic !== "") {
                if (tagsContain(currentElement.Tags, "room")) {
                    parseCustomElement(getCurrentRoom(), getCurrentRoom(), currentElement.Logic, false);
                }
                if (tagsContain(currentElement.Tags, "player")) {
                    parseCustomElement(getPlayer(), getPlayer(), currentElement.Logic, false);
                }
                if (tagsContain(currentElement.Tags, "self")) {
                    parseCustomElement(getSelf(currentElement), getSelf(currentElement), currentElement.Logic, false);
                }
                if (tagsContain(currentElement.Tags, "children")) {
                    gameOutput.Output = currentElement.Output;
                    const children = getChildObjects(getSelf(currentElement));

                    for (let child of children) {
                        parseCustomElement(getSelf(currentElement), child, currentElement.Logic, false);
                    }
                }
                if (tagsContain(currentElement.Tags, "all")) {
                    parseCustomElement(getCurrentRoom(), getCurrentRoom(), currentElement.Logic, true);
                }
            }

            if (tagsContain(currentElement.Tags, listTag) &&
                currentElement.Logic !== "") {
                parseListAction(currentElement);
            }

            if (tagsContain(currentElement.Tags, spawnTag) &&
                currentElement.Logic !== "") {
                parseSpawnAction(currentElement);
            }
        }

        function parseAttack(currentElement, parsers) {
            currentEnemy = getTargets(currentElement, currentElement.Logic)?.[0] ?? null;
            showFightInterface(currentElement.Output);
        }

        function parseCustomElement(rootElement, parentElement, customType, isRecursive) {
            // Parent Level
            const custElems = database.filter(item => item.ElementType === customType &&
                item.ParentKey === parentElement.ElementKey);

            for (let elem of custElems) {
                if (generalParsers.includes("logic") && !processLogic(elem)) {
                    continue;
                }

                parseElement(elem, generalParsers);
            }
           
            // Child Level
            const childElems = database.filter(item => canContainCustomElems.includes(item.ElementType) &&
                item.ParentKey === parentElement.ElementKey);

            for (let elem of childElems) {
                if (isRecursive || elem.ParentKey === rootElement.ElementKey) {
                    parseCustomElement(rootElement, elem, customType, isRecursive);
                }
            }
        }

        function parseInput(currentElement, parsers) {
            if (currentElement.Syntax === "") {
                return;
            }

            const sntxTgt = getTargets(currentElement, currentElement.Syntax);
            let sntx = currentElement.Syntax;
            if (sntxTgt.length > 0 && sntxTgt[0]) {
                sntx = sntxTgt[0].Output;    
            }

            if (regexCheck(sntx, userInput.Input)) {
                if (inputParsers.includes("logic") && !processLogic(currentElement)) {
                    return;
                }

                gameOutput.InputMatchMade = true;
                parseElement(currentElement, inputParsers);
            }
        }

        function parseListAction(currentElement) {
            const caption = currentElement.Output;
            const items = getTargets(currentElement, currentElement.Logic);
            let pfx = "";

            if (tagsContain(currentElement.Tags, bulletTag)) {
                pfx = "  * ";
            }

            gameOutput.Output = caption + "\n" + horizLine(caption) + "\n";
            for (const item of items) {
                if (tagsContain(item.Tags, armedTag)) {
                    let wName = "";
                    const weapon = getArmedWeapon(getPlayer());
                    if (weapon === null) {
                        wName = "Empty hand";
                    } else {
                        wName = weapon.Name;
                    }
                    gameOutput.Output += `${pfx}${item.Name}: ${wName}`;
                    gameOutput.Output += "\n";
                    continue;
                }

                if (item.Output !== "") {
                    gameOutput.Output += `${pfx}${item.Name}: ${item.Output}`;
                } else {
                    gameOutput.Output += `${pfx}${item.Name}`;
                }
                gameOutput.Output += "\n";
            }
            gameOutput.ContinueParsing = false;
            gameOutput.MatchMade = true;
        }

        function processLogic(currentElement) {
            const children = getChildrenByType(currentElement, "logic");
            if (children === null || children.length < 1) {
                return true;
            }


            for (const child of children) {
                let tRes = "";
                const passed = parseLogic(currentElement, child, child.Logic);
                if (!passed) {
                    if (macroRunning && macroTesting && tagsContain(child.Tags, testTag)) {
                        tRes = {
                            Room: getCurrentRoom().ElementKey,
                            Name: child.Name,
                            Result: failString
                        };
                        testResults.push(tRes);
                    }

                    gameOutput.Output += child.Output;

                    return passed;
                } else {
                    if (macroRunning && macroTesting && tagsContain(child.Tags, testTag)) {
                        tRes = {
                            Room: getCurrentRoom().ElementKey,
                            Name: child.Name,
                            Result: passString
                        };
                        testResults.push(tRes);
                    }
                }
            }

            return true;
        }
        function parseLogic(parentElement, childElement, logicString) {
            if (logicString === undefined || logicString.trim() === "") {
                return true;
            }
            if (!macroRunning && !macroTesting && tagsContain(childElement.Tags, testTag)) {
                return true;
            }
            let logicPassed = [];
            const logicRows = logicString.split(/\r?\n/);
            let curOperator = "and";
           
            for (let row of logicRows) {
                if (row.startsWith('?')) {
                    logicPassed.push(processLogicRow(parentElement, childElement, row.substring(1)));
                } else if (row.trim() === "and") {
                    curOperator = "and";
                } else if (row.trim() === "or") {
                    curOperator = "or";
                }

                if (logicPassed.length > 1) {
                    if (curOperator === "and" && logicPassed.includes(false)) {
                        return false;
                    }
                    if (curOperator === "or" && !logicPassed.includes(true)) {
                        return false;
                    }
                }
            }

            if (logicPassed.includes(false)) {
                return false;
            }

            return true;
        }

        function parseSpawnAction(currentElement) {
            const spawnElem = database.find(item => item.ElementKey === currentElement.Logic) ?? null;
            if (spawnElem === null) {
                return;
            }
            const newParent = getTargets(currentElement, currentElement.Output)?.[0] ?? null;

            if (newParent === null) {
                return;
            }

            // !@! Testing
            let newElem = spawnElement(spawnElem, newParent);
            let inputs = getChildrenByType(newElem, "input");
        }


        // Run the Admin Parsers
        function parseDevNotes() {
            const dNotes = database.filter(item => item.ElementType === "dev_note" && item.ParentKey === getCurrentRoom().ElementKey && item.Active === "true");
            let devOutput = `${br}${br}${br}Dev Notes:`;

            for (const dNote of dNotes) {
                devOutput += `${br}${dNote.Output}${br}`;
            }

            if (dNotes.length > 0) {
                gameOutput.Output += devOutput;
            }
        }



        function spawnElement(spawnElem, newParent) {
            let newKey = "";
            newParent = cloneElement(spawnElem, newParent.ElementKey);

            if (newParent.Output.startsWith("spn_")) {
                newParent.Output = newParent.Output.slice(4);
                fixElementRandom(newParent);
            }

            for (const spawnChild of getChildren(spawnElem, true)) {
                spawnElement(spawnChild, newParent);
            }

            return newParent;
        }

        function cloneElement(originalElement, newParentKey) {
            let entry = JSON.parse(JSON.stringify(originalElement));
            entry.ElementKey = getGuid();
            entry.ParentKey = newParentKey;

            database.push(entry);

            return entry;
        }

            /*

                LOGIC SYNTAX:

                -- getting relative values --
                getTargets
                getTargetsByRelCode

                -- operands --
                !=  Not equals to
                >=  Greater than or equal to
                <=  Less than or equal to
                !~~ Is not in
                ~~  Is in
                ><  Is outside the bounds
                <>  Is inside the bounds
                =   Is equal to
                >   Is greater than
                <   Is less than

                -- relative codes --
                [room]      The current room
                [player]    The player element
                [self]      This walks up to the first 'self' configured element - (See the SelfTypes.json file)
                [enemy]     While fighting
                [output]    The CURRENT gamOutput value - To get the FULL output, make sure this is one of the last elements to process

                -- special values --
                [children]                  Returns the child count of the [self] element
                [isday]                     Returns true if it is 'day time'
                [missiondays]               Displays how many days the player has been on the current mission (If any)
                [totaldays]                 Total in-game days that have passed
                rdm_<random expression>     Generates a random value every time it is called
                spn_<random expression>     Generates a random value when the Element is spawned


                -- examples --
                ?(travel01)active = 'true'
                ?(player)((life)) > 0
                ?[self]active = 'true'
                ?[self]((is_discovered)) = 'true'
                ?[self]key ~~ ls(player)((inventory))key
                ?[self]key ~~ ls[room]((discoverable))key
                ?[self]key ~~ ls[room]((discoverable))children
                ?[self]children > 0
                ?(elem_by_key)children < 10
                ?[self]active = 'true'

                -- inline logic examples --
                <?[room]((someAttrib)) = 'true'?>
                ...
                </?>

                <?[room]((someAttrib)) = 'true'?>
                ...
                <else>
                ...
                </?>

                <?rdm_[roll:1d6] > '2'?>
                ...
                </?>

            */
        function processLogicRow(parentElement, childElement, row) {
            let tag = "";
            let target1 = "";
            let field1 = "";
            let specCode1 = "";
            let value1 = "";
            let target2 = "";
            let field2 = "";
            let specCode2 = "";
            let value2 = "";
            const comparisons = splitLogicByOperand(row);
            const operand = getOperand(row);

            if (!Array.isArray(comparisons) || comparisons.length !== 2) {
                alert("Malformed logic statement!");
                return false;
            }

            if (operand === "") {
                return false;
            }

            value1 = getExplicitValue(comparisons[0]);
            value2 = getExplicitValue(comparisons[1]);

            if (value1 === "" && comparisons[0].startsWith("rdm_")) {
                value1 = doRandomRoll(childElement, comparisons[0].replace("rdm_", ""));
            }
            if (value2 === "" && comparisons[1].startsWith("rdm_")) {
                value2 = doRandomRoll(childElement, comparisons[1].replace("rdm_", ""));
            }

            if (value1 === "") {
                value1 = getRelElementId(childElement, comparisons[0]);
            }
            if (value2 === "") {
                value2 = getRelElementId(childElement, comparisons[1]);
            }

            if (value1 === "") {
                target1 = getTargets(childElement, comparisons[0])?.[0] ?? null;
                if (target1 === null) {
                    return;
                }
                field1 = getField(comparisons[0]);
                value1 = getFieldValue(target1, field1);
            }
            if (value2 === "") {
                target2 = getTargets(childElement, comparisons[1])?.[0] ?? null;
                if (target2 === null) {
                    return;
                }
                field2 = getField(comparisons[1]);
                value2 = getFieldValue(target2, field2);
            }

            return valueComparison(operand, value1, value2);
        }
        function splitLogicByOperand(row) {
            let splt = "";
            for (const oper of operands) {
                splt = row.split(oper);
                if (splt.length === 2) {
                    return splt;
                }
            }
        }
        function getOperand(row) {
            for (const op of operands) {
                if (row.includes(op)) {
                    return op.trim();
                }
            }

            return "";
        }
        function getExplicitValue(row) {
            // Special 'explicit' values
            if (row.trim() === "[output]") {
                return gameOutput.Output;
            }

            if (row.startsWith("'") && row.endsWith("'")) {
                return row.replaceAll("'", "");
            }
            return "";
        }
        function getFieldValue(curElem, field) {
            curElem = curElem;

            switch(field.toLowerCase()) {
                case "elementtype":
                    return curElem.ElementType;
                case "elementkey":
                    return curElem.ElementKey;
                case "name":
                    return curElem.Name;
                case "parentkey":
                    return curElem.ParentKey;
                case "syntax":
                    return curElem.Syntax;
                case "logic":
                    return curElem.Logic;
                case "output":
                    return curElem.Output;
                case "parent":
                    return curElem.ParentKey;
                case "tags":
                    return curElem.Tags;
                default:
                    return "";
            }
        }
        function setFieldValue(curElem, field, value) {
            if (Array.isArray(curElem)) {
                curElem = curElem[0];
            }

            switch(field.toLowerCase()) {
                case "elementtype":
                    return curElem.ElementType = value;
                case "elementkey":
                    return curElem.ElementKey = value;
                case "name":
                    return curElem.Name = value;
                case "parentkey":
                    return curElem.ParentKey = value;
                case "syntax":
                    return curElem.Syntax = value;
                case "logic":
                    return curElem.Logic = value;
                case "output":
                    return curElem.Output = value;
                case "tags":
                    return curElem.Tags;
                default:
                    return "";
            }
        }
        function getRelElementId(currentElement, row) {
            switch(row) {
                case "[player]":
                    return getPlayer().ElementKey;
                case "[room]":
                    return getCurrentRoom().ElementKey;
                case "[self]":
                    return getSelf(currentElement).ElementKey;
            }

            return "";
        }
        function getTargets(childElement, row) {
            if (row.startsWith("<<")) {
                row = row.replace("<<", "").replace(">>", "");
            }
            let tgt = "";
            tgt = getTargetById(childElement, row);

            if (tgt === null) {
                tgt = getTargetsByRelCode(childElement, row);
            }

            if (row.endsWith("))")) {
                const arr = row.split("((");
                if (arr.length === 2) {
                    const tag = arr[1].replace("))", "");
                    tgt = getChildrenByTag(tgt, tag);
                }
            }

            return Array.isArray(tgt) ? tgt : [tgt];
        }
        function getTargetById(currentElement, row) {
            if (row.startsWith("[player]")) {
                return getPlayer();
            }
            if (row.startsWith("[room]")) {
                return getCurrentRoom();
            }
            if (row.startsWith("[self]")) {
                const self = getSelf(currentElement);
                if (self === null) {
                    return null;
                }
                return self;
            }
            if (row.startsWith("[")) {
                row = row.substring(1);
                const arr = row.split("]");
                return getElementByKey(arr[0]);
            }

            return null;
        }
        function getTargetsByRelCode(childElement, row) {
            let parent = null;
            let childTag = "";
            let relVal = "";

            if (Number.isInteger(Number(row))) {
                return row;
            }

            relVal = [...row.matchAll(/<<(.+?)>>/g)].map(match => match[1]);
            if (relVal === "undefined") {
                relVal = row;
            }
            if (relVal.length > 0) {
                relVal = relVal[0];
            } else {
                relVal = row;
            }

            if (relVal.startsWith("[self]")) {
                parent = getSelf(childElement);
            }
            if (relVal.startsWith("[room]")) {
                parent = getCurrentRoom();
            }
            if (relVal.startsWith("[player]")) {
                parent = getPlayer();
            }
            // TODO: Add GetEnemy

            let arr = relVal.split("))");
            if (arr.length === 2) {
                arr = arr[0].split("((");
                if (arr.length === 2) {
                    childTag = arr[1].trim();
                    return getChildrenByTag(parent, childTag);
                }
            }

            return parent;
        }
        function getTargetsBySyntax(input, parentElement) {
            const roomChildren = getChildren(parentElement, false);

            for (let child of roomChildren) {
                if (regexCheck(child.Syntax, input)) {
                    return child;
                }

                return getTargetsBySyntax(input, child);
            }

            return null;
        }
        function getField(row) {
            let arr = "";

            if (row.endsWith("]") || row.endsWith("))") || row.endsWith(")")) {
                return "Output";
            }

            arr = row.split("]");
            if (arr.length !== 2) {
                arr = row.split(")");
            }

            if (arr.length === 2) {
                return arr[1].trim();
            }

            return "Output";
        }
        function valueComparison(operand, val1, val2) {
            switch (operand.trim()) {
                case "!=":
                    if (val1.replaceAll("'", "") !== val2.replaceAll("'", "")) {
                        return true;
                    }
                    break;
                case ">=":
                    if (val1 >= val2) {
                        return true;
                    }
                    break;
                case "<=":
                    if (val1 <= val2) {
                        return true;
                    }
                    break;

                case "!~~":
                    return !val2.includes(val1);
                case "~~":
                    return val2.includes(val1);
                case "><":
                    return val1 < val2 || val1 > val2;
                case "<>":
                    return val1 > val2 && val1 < val2;
                case "=":
                    return val1.replaceAll("'", "") === val2.replaceAll("'", "");
                case ">":
                    return val1 > val2;
                case "<":
                    return val1 < val2
            }

            return false;
        }

        function parseEnterMessage(parentElement, childElement) {
            if (!processLogic(childElement)) {
                return;
            }

            outputMatch(processSpecialOutput(childElement, childElement.Output), true);

            parseElement(childElement, enterMessageParsers);
        }

        function parseGlobal(parsers) {
            const globalElems = getElementsByType("global");

            for (let glob of globalElems) {
                for (let prsr of parsers) {
                    for (let child of getChildren(glob, false)) {
                        callParser(prsr, glob, child, false);
                    }
                }
            }
        }

        function parseMessage(parentElement, childElement) {
            const msgs = database.filter(item => item.ParentKey === childElement.ElementKey);
            if (msgs === null || msgs.length < 1) {
                if (childElement.Output === "") {
                    return;
                }
                outputMatch(processSpecialOutput(childElement, childElement.Output), true);
                return;
            }

            if (childElement.Repeat === null || childElement.Repeat === "") {
                childElement.Repeat = "repeat";
            }

            switch (childElement.Repeat) {
                case "random":
                    if (msgs === null || msgs.length < 1) {
                        return;
                    }
                    const rndLen = msgs.length;
                    const rndIdx = getRandomByRange(0, rndLen - 1);
                    outputMatch(processSpecialOutput(childElement, msgs[rndIdx].Output), true);
                    break;
                case "repeat":
                    const rptLen = msgs.length;
                    let rptIdx = parentElement.RepeatIndex;
                    if (rptIdx === "") {
                        rptIdx = -1;
                    }
                    if (rptIdx > rptLen - 1) {
                        rptIdx = 0;
                    }
                    outputMatch(processSpecialOutput(childElement, msgs[rptIdx].Output), true);
                    rptIdx = parseInt(rptIdx) + 1;
                    parentElement.RepeatIndex = rptIdx;
                    break;
                case "none":
                    const nLen = msgs.length;
                    let nIdx = parentElement.RepeatIndex;
                    if (nIdx === "") {
                        nIdx = -1;
                    }
                    if (nIdx > nLen - 1) {
                        nIdx = (nLen - 1);
                    }
                    outputMatch(processSpecialOutput(childElement, msgs[nIdx].Output), true);
                    if (nIdx < (nLen -1)) {
                        nIdx = parseInt(nIdx) + 1;
                    }
                    parentElement.RepeatIndex = nIdx;
                    break;
                default:
                    const tgt = getTargets(childElement, childElement.Repeat)?.[0] ?? null;
                    if (tgt === null) {
                        return;
                    }
                    const otherIndex = getFieldValue(tgt, getField(childElement.Repeat));
                    try {
                        parentElement.RepeatIndex = parseInt(otherIndex);
                    }
                    catch (Exception) {
                        parentElement.RepeatIndex = -1;
                    }
                    outputMatch(processSpecialOutput(childElement, msgs[parentElement.RepeatIndex].Output), true);
                    break;
            }
        }

        function parseMove(currentElement, parsers) {
            let outputText = "";
            let targetKey = "";
            let targetElem = null;

            if (currentElement.Logic !== limboValue) {
                targetElem = getElement(currentElement.Logic, currentElement);
                if (targetElem === null) {
                    return;
                }
                targetKey = targetElem.ElementKey;
            } else {
                targetKey = limboValue;
            }

            let movingElem = getElement(currentElement.Tags, currentElement);

            if (movingElem != null && targetKey !== "") {
                const player = getPlayer();
                const currentParent = movingElem.ParentKey;
                movingElem.ParentKey = targetKey;
                if (currentParent === player.ElementKey && targetKey !== player.ElementKey) {
                    setDefaultWeapon(movingElem.ElementKey);
                }
                gameOutput.MatchMade = true;
                if (currentElement.Output !== "" && outputText === "") {
                    gameOutput.Output = currentElement.Output.replace("[target]", movingElem.Name);
                    gameOutput.MatchMade = true;
                    gameOutput.ContinueParsing = false;
                } else {
                    outputMatch(currentElement.Output, false);
                }
                if (movingElem.ElementType === "player") {
                    gameOutput.EnterMsgDone = false;
                    parseRoom(roomParsers, true);
                    return;
                }
            }
        }

        function parseNpc(parentElement, currentElement, parsers, isEntering) {
            if (npcParsers.includes("logic") && !processLogic(currentElement)) {
                return;
            }

            for (const prsr of parsers) {
                for (let child of getChildren(currentElement, false)) {
                    callParser(prsr, currentElement, child, isEntering);
                }
            }
        }

        function parseObject(parentElement, currentElement, parsers, isEntering) {
            if (objectParsers.includes("logic") && !processLogic(currentElement)) {
                return;
            }

            for (const prsr of parsers) {
                for (let child of getChildren(currentElement, false)) {
                    callParser(prsr, currentElement, child, isEntering);
                }
            }
        }

        function parseRoom(parsers, isEntering) {
            let roomElem = getCurrentRoom();

            for (const prsr of parsers) {
                for (let child of getChildren(roomElem, isEntering)) {
                    callParser(prsr, roomElem, child, isEntering);
                }
            }
        }

        function parsePlayer(parsers) {
            let playerElem = getPlayer();
            const isEntering = false;

            for (const prsr of parsers) {
                for (let child of getChildren(playerElem, isEntering)) {
                    callParser(prsr, playerElem, child, isEntering);

                    if (child.ElementType === "object") {
                        for (let objChild of getChildren(child, isEntering)) {
                            callParser(prsr, child, objChild, isEntering);
                        }
                    }
                }
            }
        }

        function parseSet(parentElement, currentElement, parsers) {
            if (setParsers.includes("logic") && !processLogic(currentElement)) {
                return;
            }

            if (tagsContain(currentElement.Tags, armTag)) {
                let target = getChildrenBySyntax(getPlayer(), userInput.Input);
                if (target === null || target.length < 1) {
                    gameOutput.Output = "You aren't carrying that weapon.";
                    gameOutput.MatchMade = true;
                    return;
                }
                if (!tagsContain(target.Tags, weaponTag)) {
                    gameOutput.Output = "That is not a weapon.";
                    gameOutput.MatchMade = true;
                    return;
                }
                if (Array.isArray(target)) {
                    target = target[0];
                }

                setPlayerArmed(target.ElementKey);
                const title = getChildByTag(target, titleTag);

                gameOutput.Output = `You are now armed with ${title.Output}.`;
                gameOutput.MatchMade = true;
                return;
            }

            let field = "";
            let tgt = getTargets(currentElement, currentElement.Logic)?.[0] ?? null;
            if (tgt === null) {
                return;
            }
            field = getField(currentElement.Logic);

            updateElementField(tgt, field, currentElement.Output.trim());
        }

        function updateElementField(currentElement, fieldName, newValue) {
            let curValue = getFieldValue(currentElement, fieldName);

            switch (true) {
                case (newValue.startsWith("+=")):
                    const inc = Number(newValue.replace("+=", ""));
                    curValue = Number(curValue) + inc;
                    break;
                case (newValue.startsWith("-=")):
                    const dec = Number(newValue.replace("-=", ""));
                    curValue = Number(curValue) - dec;
                    break;
                case (newValue === "++"):
                    curValue = Number(curValue) + 1;
                    break;
                case (newValue === "--"):
                    curValue = Number(curValue) - 1;
                    break;
                case (curValue === ""):
                    curValue = newValue;
                    break;
                default:
                    curValue = newValue;
            }

            switch(fieldName.toLowerCase()) {
                case "active":
                    currentElement.Active = curValue;
                    break;
                case "elementtype":
                    currentElement.ElementType = curValue;
                    break;
                case "elementkey":
                    currentElement.ElementKey = curValue;
                    break;
                case "name":
                    currentElement.Name = curValue;
                    break;
                case "parentkey":
                    currentElement.ParentKey = curValue;
                    break;
                case "syntax":
                    currentElement.Syntax = curValue;
                    break;
                case "logic":
                    currentElement.Logic = curValue;
                    break;
                case "output":
                    currentElement.Output = curValue;
                    break;
                case "tags":
                    if (newValue.startsWith("+")) {
                        addTag(currentElement, newValue.substring(1));
                    }
                    if (newValue.startsWith("-")) {
                        removeTag(currentElement, newValue.substring(1));
                    }
                    break;
            }
        }

        function parseElement(parentElement, parsers) {
            if (!gameOutput.ContinueParsing) {
                return;
            }

            for (const prsr of parsers) {
                for (let child of getChildren(parentElement, false)) {
                    callParser(prsr, parentElement, child, false);
                    if (!gameOutput.ContinueParsing) {
                        return;
                    }
                }
            }
        }

        // Parser managing function
        function callParser(curParser, parentElement, childElement, isEntering) {
            if (childElement.ElementType !== curParser) {
                return;
            }

            switch (curParser) {
                case "action":
                    parseAction(childElement, actionParsers);
                    break;

                case "attack":
                    parseAttack(childElement, attackParsers);
                    break;

                case "enter_message":
                    if (parentElement.ElementType !== "game" &&
                        isEntering &&
                        !gameOutput.EnterMsgDone
                    ) {
                        parseEnterMessage(parentElement, childElement);
                        followPlayer();
                    }
                    break;

                case "input":
                    if (!gameOutput.InputMatchMade) {
                        parseInput(childElement, inputParsers);
                    }
                    break;

                case "message":
                    if (messageParsers.includes("logic") && !processLogic(childElement)) {
                        return;
                    }

                    if (parentElement.ElementType !== "game") {
                        parseMessage(parentElement, childElement);
                    }
                    break;

                case "move":
                    if (moveParsers.includes("logic") && !processLogic(childElement)) {
                        return;
                    }

                    parseMove(childElement, moveParsers);
                    if (!gameOutput.ContinueParsing) {
                        return;
                    }
                    break;

                case "npc":
                    parseNpc(parentElement, childElement, objectParsers, isEntering);

                    for (let npcChild of getChildren(childElement)) {
                        callParser(curParser, childElement, npcChild, isEntering);
                    }
                    break;

                case "object":
                    parseObject(parentElement, childElement, objectParsers, isEntering);

                    for (let objChild of getChildren(childElement)) {
                        callParser(curParser, childElement, objChild, isEntering);
                    }
                    break;

                case "set":
                    parseSet(parentElement, childElement, setParsers);
                    break;
            }
        }
    </script>
</body></html>
