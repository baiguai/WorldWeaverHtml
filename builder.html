<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorldWeaver Builder</title>

    <!--
        Formatting notes:
        This code is formatted for indentation level folding.
        There are sections indented between comments, so that they
        remain collapsed at certain levels, to make code navigation
        and reading easier.
    -->

    <!-- Styles -->
        <style>
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }

            body {
                background-color: black;
                color: white;
                font-family: monospace;
                margin: 0;
                display: flex;
                flex-direction: column;
                height: 100dvh; /* better on mobile than 100vh */
            }

            /* Initially hide the admin interface */
            #admin-interface {
                flex: 1;
                display: flex;
                overflow: hidden; /* Prevent the outer from scrolling */
            }

            #treeview {
                display: flex;
                flex-direction: column;
                width: 400px;
                border-right: 1px solid white;
                padding: 10px;
                resize: horizontal;
                min-width: 100px;
                max-width: 50%;
                max-height: 100vh;
                overflow-y: auto;
                overflow-x: hidden;
            }

            #treeview ul {
                list-style: none;
                padding-left: 10px;
                overflow-y: auto;
                overflow-x: hidden;
            }

            #treeview li {
                cursor: pointer;
                padding: 5px;
            }

            .tree-toggle {
                width: 1em;
                text-align: center;
                font-weight: bold;
                color: #ccc;
            }

            #details {
                flex: 1;
                padding: 10px;
                overflow-y: auto; /* <-- Add this */
                max-height: 100vh;
            }

            #admin-input-container {
                display: none;
                padding: 10px;
                background: black;
                border-top: 1px solid white;
            }

            #admin-input {
                width: 100%;
                background: black;
                color: white;
                border: none;
                padding: 10px;
                font-size: 1rem;
                font-family: monospace;
            }

            #admin-input:focus {
                outline: none;
            }

            #editor-container {
                display: none;
                flex: 1;
                padding: 10px;
                flex-direction: column;
            }

            #editor {
                flex: 1;
                background: black;
                color: white;
                border: 1px solid white;
                padding: 10px;
                font-size: 1rem;
                font-family: monospace;
                white-space: pre;
                overflow-y: auto;
            }

            #editor-close {
                align-self: flex-end;
                cursor: pointer;
                padding: 5px;
                color: red;
            }

            .link {
                cursor: pointer;
                text-decoration: underline;
            }
        </style>
    <!-- End Styles -->
</head>
<body>
    <div id="admin-interface" style="display: flex;">
        <div id="treeview"></div>
        <div id="details" style="display: block;">
                <p><strong>Element Type:</strong><span id="element-type-parent"><span id="element-type" class="link">move</span></span></p>
                <p><strong>Element Key:</strong> <span id="element-key" class="link">k3gzbw6wmpqm95difm9</span></p>
                <p><strong>Name:</strong> <span id="element-name" class="link">GoldRoomDoor Action</span></p>
                <p><strong>Parent Key:</strong> <select id="parentSelect"><option value="null">No Parent</option><option value="game">Sample Game</option><option value="player"></option><option value="9wh0ai7glyhm8zq92fn">error</option><option value="nyoy47hnhtgm8zqaoi8">die message</option><option value="ym8tqvff76im91ooiy7">Attack Player</option><option value="tydkk947zvpm91op8ta">Attack</option><option value="long-sword_01">Long Sword</option><option value="3ielqbe2ltm91oyuf9">Global</option><option value="69lyn6u2u6nm91p0qv7">Title</option><option value="vl9tfy7wmkm91p1baj">show game title</option><option value="du2fxwfitpum91p248p">Stats</option><option value="6tqadr9itmpm91p2w5t">show stats</option><option value="0e9uq8d1xdim91p5y52">Inventory</option><option value="pohxz1iocgm91p6pom">show inventory</option><option value="w97g79kzvugm91p7k05">Arm</option><option value="51w1x5oxgt3m91p86i4">set armed weapon</option><option value="at73dh77pchm92hdikb">ROOMS</option><option value="home">Testing Home Room</option><option value="3yiz09d87evm92hgek0">Enter Message</option><option value="n1oy3odne3dm92hiusl">Look</option><option value="gos1iqg1rgqm92hjg25">Look Msg</option><option value="xhxecxcl42lm92iow8c">Navigation</option><option value="tr9whrpn83m92ipps2">Nav Msg</option><option value="zfofgknktfkm92iqoxe">INJECTIONS</option><option value="inj_look">Inj Look</option><option value="xs69bo34pndm92isgbk">Inj Look Action</option><option value="r7eqlu5a1om92itw47">Look Inj</option><option value="suli02fs0cm92js21q">Start Screen</option><option value="gold_room">Gold Room</option><option value="csgxp4xttqjm95dfyhv">enter message</option><option value="33qw3awzi5am95dh8zu" selected="">GoldRoom Door</option></select></p>
                <p><strong>Syntax:</strong> <span id="syntax-caption" class="link">Click to Edit</span></p>
                <p><strong>Logic:</strong> <span id="logic-field" class="link">gold_room</span></p>
                <p><strong>Output:</strong> <span id="output-field" class="link">You have decided to test receiving money.</span></p>
                <p><strong>Tags:</strong> <span id="tags-field" class="link">[player]</span></p>
                <p><strong>Repeat:</strong> <span id="repeat-field-parent"><span id="repeat-field" class="link">Click to Edit</span><span></span></span></p>
                <p><strong>Active:</strong> <span><input id="element-active" type="checkbox" checked=""></span></p>
                <p><strong>Sort:</strong> <span id="sort-field" class="link">Click to Edit</span></p>
                <br>
                <p><span id="delete-element" class="link">Delete</span></p>
            </div>
        <div id="editor-container" style="display: none;">
                <div id="editor-close">X</div>
                <textarea id="editor"></textarea>
            </div>
    </div>
    <div id="admin-input-container" style="display: flex;">
        <input type="text" id="admin-input">
    </div>

<div id="regexDlg" style="display:none; position:fixed; background:#000; color: #fff; border:1px solid #ccc; padding:1em; width: 70%; height: 70%; top: 50%; left: 50%; transform: translate(-50%, -50%);">
    <div id="modalContent" style="overflow: auto; max-height: calc(100% - 40px);">
        <h2>Regex Library</h2>
        <div id="regexTable"></div>
    </div>
    <button onclick="closeRegexLibrary()" style="margin-top: 8px;">Close</button>
</div>

    <div id="databaseModal" style="background: #000; color: #fff; display:none; position:fixed; top:10%; left:10%; width:80%; height:80%; border:2px solid #444; z-index:1000; padding:10px; overflow:auto; box-shadow:0 0 15px rgba(0,0,0,0.5);">
        <button onclick="copyDatabase()" style="float:right; margin-left:10px;">Copy</button>
        <button onclick="closeDatabaseModal()" style="float:right;">Close</button>
        <h3>Database JSON</h3>
        <textarea id="databaseText" style="background: #000; color: #fff; width:100%; height:85%; font-family:monospace;"></textarea>
    </div>




    <script>
        // !@! Database
        let database = [
  {"ElementType":"game","ElementKey":"game","Name":"Sample Game","ParentKey":null,"Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"player","ElementKey":"player","Name":"","ParentKey":"home","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"pf4wcjaqs9jm8zq6awm","Name":"admin pass","ParentKey":"game","Syntax":"","Logic":"","Output":"admin","Tags":"!_adminpass","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"","ElementKey":"9wh0ai7glyhm8zq92fn","Name":"error","ParentKey":"game","Syntax":"","Logic":"","Output":"I don't understand what you are trying to do.","Tags":"!_error","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"nyoy47hnhtgm8zqaoi8","Name":"die message","ParentKey":"game","Syntax":"","Logic":"","Output":"You have died.","Tags":"!_die","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"j0j70z5382m91nuded","Name":"stats dice","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:3|5]","Tags":"stats_dice","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"dra3hmv3nnem91nvmgq","Name":"money dice","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:4|6]","Tags":"money_dice","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"z9tqbp2st2m91nw9ep","Name":"life roll","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|6]","Tags":"life_roll","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"z2i2lbhfwxm91nwx9d","Name":"armor roll","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|6]","Tags":"armor_roll","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"2au1o4qznt5m91nxeao","Name":"strength roll","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|5]","Tags":"strength_roll","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"az85m9vwmcbm91nxw20","Name":"intelligence roll","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|5]","Tags":"intelligence_roll","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"6jdbqtsxpanm91nyncm","Name":"cunning roll","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|5]","Tags":"cunning_roll","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"pvzdehgcs28m91nz4ta","Name":"gold roll","ParentKey":"player","Syntax":"","Logic":"","Output":"[rand:<<[self]((money_dice))>>|9]","Tags":"gold_roll","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"3e573l95rtkm91o5dpu","Name":"Life","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:(8)<<[self]((life_roll))>>d6]","Tags":"stats|life","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"uonxrshx72rm91o71d3","Name":"max life","ParentKey":"player","Syntax":"","Logic":"","Output":"player((life))","Tags":"maxlife","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"kd8qk3jx4vhm91o7sji","Name":"Armor","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:(6)<<[self]((armor_roll))>>d6+3]","Tags":"stats|!_armor","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"kcchdhvqojam91o8zat","Name":"Strength","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:(6)<<[self]((strength_roll))>>d6]","Tags":"stats","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"ccowsmp5kc6m91oa4us","Name":"Intelligence","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:(6)<<[self]((intelligence_roll))>>d6]","Tags":"stats","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"xvpexadit7hm91oas1w","Name":"Cunning","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:(6)<<[self]((cunning_roll))>>d6]","Tags":"stats","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"yv26edvaibom91ocqjl","Name":"Gold","ParentKey":"player","Syntax":"","Logic":"","Output":"[roll:<<[self]((gold_roll))>>d8]","Tags":"stats|gold","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},
  {"ElementType":"attribute","ElementKey":"player_armed","Name":"Armed Weapon","ParentKey":"player","Syntax":"","Logic":"","Output":"long-sword_01","Tags":"!_armed|stats|name","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"experience","Name":"Experience","ParentKey":"player","Syntax":"","Logic":"","Output":"0","Tags":"experience|stats","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"cur_heal_round","Name":"Current Heal Round","ParentKey":"kb8bc6nyk1ima0toywq","Syntax":"","Logic":"","Output":"0","Tags":"cur_heal_round","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"4yru4bgbvolm91onmxr","Name":"Quest","ParentKey":"player","Syntax":"","Logic":"","Output":"","Tags":"stats|quest","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attackplayer","ElementKey":"ym8tqvff76im91ooiy7","Name":"Attack Player","ParentKey":"player","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attack","ElementKey":"tydkk947zvpm91op8ta","Name":"Attack","ParentKey":"ym8tqvff76im91ooiy7","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"82t6lun7um4m91opqwu","Name":"target","ParentKey":"tydkk947zvpm91op8ta","Syntax":"","Logic":"","Output":"[player]","Tags":"target","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"long-sword_01","Name":"Long Sword","ParentKey":"player","Syntax":"/(.*your .*sword|.*sword)/","Logic":"","Output":"","Tags":"inventory|!_weapon","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"74yr0t7hrm91ouzn5","Name":"Damage","ParentKey":"long-sword_01","Syntax":"","Logic":"[rand:4|12]","Output":"","Tags":"!_damage","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"79liampktaem91ow6sv","Name":"friendly name","ParentKey":"long-sword_01","Syntax":"","Logic":"","Output":"a Long Sword","Tags":"title","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"global","ElementKey":"3ielqbe2ltm91oyuf9","Name":"Global","ParentKey":null,"Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"69lyn6u2u6nm91p0qv7","Name":"Title","ParentKey":"3ielqbe2ltm91oyuf9","Syntax":"(title)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"","ElementKey":"vl9tfy7wmkm91p1baj","Name":"show game title","ParentKey":"69lyn6u2u6nm91p0qv7","Syntax":"","Logic":"game_title","Output":"","Tags":"key","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"du2fxwfitpum91p248p","Name":"Stats","ParentKey":"3ielqbe2ltm91oyuf9","Syntax":"(stats)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"action","ElementKey":"6tqadr9itmpm91p2w5t","Name":"show stats","ParentKey":"du2fxwfitpum91p248p","Syntax":"","Logic":"[player]((stats))","Output":"Stats:","Tags":"list","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"0e9uq8d1xdim91p5y52","Name":"Inventory","ParentKey":"3ielqbe2ltm91oyuf9","Syntax":"(inventory|inv)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"action","ElementKey":"pohxz1iocgm91p6pom","Name":"show inventory","ParentKey":"0e9uq8d1xdim91p5y52","Syntax":"","Logic":"[player]((inventory))","Output":"Inventory:","Tags":"list|bullet","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"w97g79kzvugm91p7k05","Name":"Arm","ParentKey":"3ielqbe2ltm91oyuf9","Syntax":"(arm .*)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"set","ElementKey":"51w1x5oxgt3m91p86i4","Name":"set armed weapon","ParentKey":"w97g79kzvugm91p7k05","Syntax":"","Logic":"player_armed","Output":"","Tags":"arm","Repeat":"","RepeatIndex":"","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"at73dh77pchm92hdikb","Name":"ROOMS","ParentKey":null,"Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},
  {"ElementType":"room","ElementKey":"home","Name":"Testing Home Room","ParentKey":"at73dh77pchm92hdikb","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"3yiz09d87evm92hgek0","Name":"Enter Message","ParentKey":"home","Syntax":"","Logic":"","Output":"You are in the WorldWeaver Testing room.\nTo enter a test room simply enter its name.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"n1oy3odne3dm92hiusl","Name":"Look","ParentKey":"invsnofrffma2afsym","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"gos1iqg1rgqm92hjg25","Name":"Look Msg","ParentKey":"n1oy3odne3dm92hiusl","Syntax":"","Logic":"","Output":"You are in the testing room.\nTo enter a test room simply enter its name.\n(No need to say \"go to\").\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"navigation","ElementKey":"xhxecxcl42lm92iow8c","Name":"Navigation","ParentKey":"home","Syntax":"","Logic":"","Output":"","Tags":"look|enter_message","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"tr9whrpn83m92ipps2","Name":"Nav Msg","ParentKey":"xhxecxcl42lm92iow8c","Syntax":"","Logic":"","Output":"\nNavigation:\n  Arming\n  Fight\n  Gold\n  Putting\n  Message","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"zfofgknktfkm92iqoxe","Name":"INJECTIONS","ParentKey":null,"Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"inj_look","Name":"Inj Look","ParentKey":"zfofgknktfkm92iqoxe","Syntax":"(look(?: around)?|l)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"suli02fs0cm92js21q","Name":"Start Screen","ParentKey":"game","Syntax":"","Logic":"","Output":"Welcome to\n\n\n▓█████▄  ▄▄▄       ██▀███   ██ ▄█▀         \n▒██▀ ██▌▒████▄    ▓██ ▒ ██▒ ██▄█▒          \n░██   █▌▒██  ▀█▄  ▓██ ░▄█ ▒▓███▄░          \n░▓█▄   ▌░██▄▄▄▄██ ▒██▀▀█▄  ▓██ █▄          \n░▒████▓  ▓█   ▓██▒░██▓ ▒██▒▒██▒ █▄         \n ▒▒▓  ▒  ▒▒   ▓▒█░░ ▒▓ ░▒▓░▒ ▒▒ ▓▒         \n ░ ▒  ▒   ▒   ▒▒ ░  ░▒ ░ ▒░░ ░▒ ▒░         \n ░ ░  ░   ░   ▒     ░░   ░ ░ ░░ ░          \n   ░          ░  ░   ░     ░  ░            \n ░                                         \n █     █░ ▒█████   ██▀███   ██▓    ▓█████▄ \n▓█░ █ ░█░▒██▒  ██▒▓██ ▒ ██▒▓██▒    ▒██▀ ██▌\n▒█░ █ ░█ ▒██░  ██▒▓██ ░▄█ ▒▒██░    ░██   █▌\n░█░ █ ░█ ▒██   ██░▒██▀▀█▄  ▒██░    ░▓█▄   ▌\n░░██▒██▓ ░ ████▓▒░░██▓ ▒██▒░██████▒░▒████▓ \n░ ▓░▒ ▒  ░ ▒░▒░▒░ ░ ▒▓ ░▒▓░░ ▒░▓  ░ ▒▒▓  ▒ \n  ▒ ░ ░    ░ ▒ ▒░   ░▒ ░ ▒░░ ░ ▒  ░ ░ ▒  ▒ \n  ░   ░  ░ ░ ░ ▒    ░░   ░   ░ ░    ░ ░  ░ \n    ░        ░ ░     ░         ░  ░   ░    \n                                    ░  \n\n","Tags":"!_start","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"n4n2fxgt2tm930w294","Name":"File Name","ParentKey":"game","Syntax":"","Logic":"","Output":"sample","Tags":"!_filename","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"room","ElementKey":"gold_room","Name":"Gold Room","ParentKey":"at73dh77pchm92hdikb","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"csgxp4xttqjm95dfyhv","Name":"enter message","ParentKey":"gold_room","Syntax":"","Logic":"","Output":"Welcome to the Gold Room.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"33qw3awzi5am95dh8zu","Name":"GoldRoom Door","ParentKey":"2kljng90mscma2adz4n","Syntax":"(gold)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"k3gzbw6wmpqm95difm9","Name":"GoldRoomDoor Action","ParentKey":"33qw3awzi5am95dh8zu","Syntax":"","Logic":"gold_room","Output":"You have decided to test receiving money.\n\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"byhgzjzj7qvm99nqh7r","Name":"Look","ParentKey":"mzjoz4oah2rma2avk9g","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"9o7qgeoftqfm99nqsum","Name":"Look Message","ParentKey":"byhgzjzj7qvm99nqh7r","Syntax":"","Logic":"","Output":"You look around.\nYou are in a small room.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"navigation","ElementKey":"obo9905ejlam99otgpl","Name":"Navigation","ParentKey":"gold_room","Syntax":"","Logic":"","Output":"","Tags":"look|enter_message","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"uri9nmp4ufam99ots0h","Name":"Nav Msg","ParentKey":"obo9905ejlam99otgpl","Syntax":"","Logic":"","Output":"\n\nYou can return home using:\nhome","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"zcfyy2e69fm9b4ht2r","Name":"Gold Coin","ParentKey":"up9bpa1o42kma2aw8ho","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"4fecftfhp3vm9b4jon6","Name":"moved","ParentKey":"zcfyy2e69fm9b4ht2r","Syntax":"","Logic":"","Output":"false","Tags":"moved","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},
  {"ElementType":"look","ElementKey":"awmyn3yxzydm9b4l1i0","Name":"Look","ParentKey":"zcfyy2e69fm9b4ht2r","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"j5qqe3os2om9b4lkog","Name":"Look Message","ParentKey":"awmyn3yxzydm9b4l1i0","Syntax":"","Logic":"","Output":"\nYou see a gold coin.","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"ntrf9qy5mgm9bt126v","Name":"enter message","ParentKey":"zcfyy2e69fm9b4ht2r","Syntax":"","Logic":"","Output":"You see a gold coin.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"logic","ElementKey":"r694vnch6sm9cin5d3","Name":"Moved Logic","ParentKey":"awmyn3yxzydm9b4l1i0","Syntax":"","Logic":"?[self]((moved)) = 'false'","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"xft1rox6b1rm9gt5pnn","Name":"Take Coin","ParentKey":"zcfyy2e69fm9b4ht2r","Syntax":"(take.*coin)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"j2oimcm7sydm9gt90pb","Name":"Take Move","ParentKey":"xft1rox6b1rm9gt5pnn","Syntax":"","Logic":"!_limbo","Output":"You take the gold coin.\n","Tags":"[self]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"set","ElementKey":"zg519drfg1km9gteyn6","Name":"Take Action","ParentKey":"xft1rox6b1rm9gt5pnn","Syntax":"","Logic":"[player]((gold))","Output":"+=1","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"room","ElementKey":"fight_room","Name":"Fight Room","ParentKey":"at73dh77pchm92hdikb","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"navigation","ElementKey":"0g0niphdneaem9o0s1lx","Name":"Navigation","ParentKey":"fight_room","Syntax":"","Logic":"","Output":"","Tags":"look|enter_message","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"lzjuj21s7rcm9o0sjss","Name":"Nav Msg","ParentKey":"0g0niphdneaem9o0s1lx","Syntax":"","Logic":"","Output":"\n\nYou can return home using:\nhome","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"2pkk0i39nzam9o0tnuk","Name":"FightRoom Door","ParentKey":"2kljng90mscma2adz4n","Syntax":"(fight)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"udw9767eszrm9o0ujnu","Name":"FightRoomDoor Action","ParentKey":"2pkk0i39nzam9o0tnuk","Syntax":"","Logic":"fight_room","Output":"You have decided to test the fight room.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"6sfry8c4c0nm9o13ntn","Name":"Look","ParentKey":"p03ksgoxlajma2axqmy","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"qm98k4dvvym9o14gky","Name":"Look Message","ParentKey":"6sfry8c4c0nm9o13ntn","Syntax":"","Logic":"","Output":"You look around.\nYou are in the fight test room.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"v1uynzyvm4qm9o1c6xn","Name":"Spawn Button","ParentKey":"32wwh27tvurma2ay9h6","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"slufsccds0rm9o1dvs9","Name":"enter message","ParentKey":"v1uynzyvm4qm9o1c6xn","Syntax":"","Logic":"","Output":"\nYou see a red button in the center of the room.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"804msoqw0vqm9o1f3r3","Name":"Click Input","ParentKey":"v1uynzyvm4qm9o1c6xn","Syntax":"(click.*button|press.*button|push.*button)","Logic":"","Output":"\nYou've pressed the button.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"a4rhlx63sxhm9o28c8k","Name":"Look","ParentKey":"v1uynzyvm4qm9o1c6xn","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"d0qgpuzynltm9o28q7g","Name":"Look Message","ParentKey":"a4rhlx63sxhm9o28c8k","Syntax":"","Logic":"","Output":"\nYou see a red button in the middle of the room.","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"npc","ElementKey":"npc_rat","Name":"rat","ParentKey":"m80q9u9n9cjm9pblryi","Syntax":"","Logic":"","Output":"","Tags":"enemy","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},
  {"ElementType":"folder","ElementKey":"m80q9u9n9cjm9pblryi","Name":"Npcs","ParentKey":null,"Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"qrd50b66eqlm9pbpp9a","Name":"stats dice","ParentKey":"npc_rat","Syntax":"","Logic":"[rand:3|4]","Output":"","Tags":"stats_dice","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"bv08g96f5gsm9pbr9ec","Name":"life_roll","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|4]","Tags":"life_roll","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"le0ql3m9nmbm9qnkj86","Name":"armor_roll","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"[rand:<<[self]((stats_dice))>>|5]","Tags":"armor_roll","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"hbepqljbd7qm9qnluyk","Name":"max life","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"[self]((life))","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"s8dcvlqqvbm9qnnwze","Name":"Life","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"[roll:(8)<<[self]((life_roll))>>d4]","Tags":"stats|life","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"v12y764bc9dm9qnre7b","Name":"Armor","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"[roll:(6)<<[self]((armor_roll))>>d4+3]","Tags":"stats|!_armor","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"action","ElementKey":"8xr09flmjeim9qntf6l","Name":"Spawn Action","ParentKey":"804msoqw0vqm9o1f3r3","Syntax":"","Logic":"npc_rat","Output":"[room]","Tags":"spawn","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":"0"},{"ElementType":"look","ElementKey":"lf27ucc1s3m9s965r3","Name":"Look","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"1h85xa1p6e5m9s96d4u","Name":"Look Message","ParentKey":"lf27ucc1s3m9s965r3","Syntax":"","Logic":"","Output":"\nYou see a rat.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"8r6x7rqvq0im9sahbmr","Name":"Spawn Message","ParentKey":"8xr09flmjeim9qntf6l","Syntax":"","Logic":"","Output":"\nA rat appears!","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"2zh03itrf3mm9sarrg9","Name":"Attack Input","ParentKey":"npc_rat","Syntax":"(attack.*rat|!.*rat)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attack","ElementKey":"nvjgijhlnnam9satjvb","Name":"Attack","ParentKey":"2zh03itrf3mm9sarrg9","Syntax":"","Logic":"[self]","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"rat_claws_01","Name":"Claws","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"","Tags":"!_weapon","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"b7pm1xhoj95m9trba49","Name":"Damage","ParentKey":"rat_claws_01","Syntax":"","Logic":"[rand:4|9]","Output":"","Tags":"!_damage","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"ky4n2hmjh9mm9trtiwg","Name":"friendly name","ParentKey":"rat_claws_01","Syntax":"","Logic":"","Output":"rat claws","Tags":"title","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"v5q2wbvpp88m9ts0fux","Name":"armed weapon","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"rat_claws_01","Tags":"!_armed|name","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"e4q3er1g48m9xzbvmi","Name":"Heal Rounds","ParentKey":"kb8bc6nyk1ima0toywq","Syntax":"","Logic":"","Output":"0","Tags":"heal_rounds","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"ob2wlg1g1mmm9y0et0t","Name":"Healing","ParentKey":"3ielqbe2ltm91oyuf9","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"rqo0ul43djkm9zc9p25","Name":"Hit Message","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"You have hit the rat.\n","Tags":"!_hitmsg","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},
  {"ElementType":"attribute","ElementKey":"dtaseove1bqm9zdsdhy","Name":"Miss Message","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"You have attacked the rat, but missed.\n","Tags":"!_missmsg","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"p60f8dfdeism9zdt6ou","Name":"Kill Message","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"You have killed the rat.\n","Tags":"!_killmsg","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"pyn93r2wuxhm9zdu8dg","Name":"Hit Message","ParentKey":"player","Syntax":"","Logic":"","Output":"You have been hit!\n","Tags":"!_hitmsg","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"mrkv13v13um9zdvbtn","Name":"Die Message","ParentKey":"player","Syntax":"","Logic":"","Output":"You have died.","Tags":"!_die","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"0is7bnvr7bg5m9zegavb","Name":"Miss Player Message","ParentKey":"npc_rat","Syntax":"","Logic":"","Output":"The rat has attacked you, but missed.\n","Tags":"!_missplayermsg","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"action","ElementKey":"wjfuof08bim9zg6fob","Name":"Cur Heal Round Act","ParentKey":"ob2wlg1g1mmm9y0et0t","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"set","ElementKey":"qrjn2a30rdmm9zg6v8r","Name":"Set Cur Heal Round","ParentKey":"wjfuof08bim9zg6fob","Syntax":"","Logic":"[player]((cur_heal_round))","Output":"++","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"kb8bc6nyk1ima0toywq","Name":"Healing","ParentKey":"player","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"action","ElementKey":"1kro3zat5rma0tue7a","Name":"Heal Player","ParentKey":"ob2wlg1g1mmm9y0et0t","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"logic","ElementKey":"ll709sywwmama0tuw0k","Name":"Heal Player Logic","ParentKey":"1kro3zat5rma0tue7a","Syntax":"","Logic":"?[player]((cur_heal_round)) >= [player]((heal_rounds))\nand\n?[player]((life)) < [player]((maxlife))","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"set","ElementKey":"egvjwipxaoima0twbjf","Name":"Set Player Health","ParentKey":"1kro3zat5rma0tue7a","Syntax":"","Logic":"[player]((life))","Output":"++","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"action","ElementKey":"rrrujx7enpma28fbw2","Name":"Reset Healing Rounds","ParentKey":"ob2wlg1g1mmm9y0et0t","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"logic","ElementKey":"rbneyp7zwyrma28fpy1","Name":"Reset Healing Logic","ParentKey":"rrrujx7enpma28fbw2","Syntax":"","Logic":"?[player]((cur_heal_round)) > [player]((heal_rounds))","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"set","ElementKey":"p1iaa4vh7cma28hrm8","Name":"Set Healing Rounds Reset","ParentKey":"rrrujx7enpma28fbw2","Syntax":"","Logic":"[player]((cur_heal_round))","Output":"0","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"2kljng90mscma2adz4n","Name":"Doors","ParentKey":"home","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"invsnofrffma2afsym","Name":"Custom Actions","ParentKey":"home","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"room","ElementKey":"taking_room","Name":"Putting Room","ParentKey":"at73dh77pchm92hdikb","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"wu8wzg05y3nma2asqs7","Name":"enter message","ParentKey":"taking_room","Syntax":"","Logic":"","Output":"\nYou are in the taking and putting room.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"mzjoz4oah2rma2avk9g","Name":"Custom Elements","ParentKey":"gold_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"up9bpa1o42kma2aw8ho","Name":"Objects","ParentKey":"gold_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},
  {"ElementType":"folder","ElementKey":"p03ksgoxlajma2axqmy","Name":"Custom Actions","ParentKey":"fight_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"32wwh27tvurma2ay9h6","Name":"Objects","ParentKey":"fight_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"rowbnl387pma2bbbj9","Name":"PuttingRoom Door","ParentKey":"2kljng90mscma2adz4n","Syntax":"(putting)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"6fpyvik4inma2bd1fn","Name":"TakingPuttingRoomDoor Action","ParentKey":"rowbnl387pma2bbbj9","Syntax":"","Logic":"taking_room","Output":"You have decided to test taking and putting.","Tags":"[player]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"navigation","ElementKey":"btn891n077ama2bgsix","Name":"Navigation","ParentKey":"taking_room","Syntax":"","Logic":"","Output":"","Tags":"look|enter_message","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"ueg6dglmnmhma2bhbhb","Name":"Nav Msg","ParentKey":"btn891n077ama2bgsix","Syntax":"","Logic":"","Output":"\n\nYou can return home using:\nhome","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"zk81c0w7zjnma2bqqdr","Name":"Objects","ParentKey":"taking_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"sbnygl5t5oma2brpwl","Name":"Key","ParentKey":"zk81c0w7zjnma2bqqdr","Syntax":".*key.*","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"3s8ylgbkku7ma2bsrs4","Name":"enter message","ParentKey":"sbnygl5t5oma2brpwl","Syntax":"","Logic":"","Output":"You see a key.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"2ptijbkghwtma2buip7","Name":"Look","ParentKey":"sbnygl5t5oma2brpwl","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"br50s9ysqbema2bv3vm","Name":"Look Message","ParentKey":"2ptijbkghwtma2buip7","Syntax":"","Logic":"","Output":"\nYou see a key.","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"action","ElementKey":"oa199n0skccma53fqyc","Name":"Inj Look Action","ParentKey":"inj_look","Syntax":"","Logic":"look","Output":"testlook","Tags":"type|room","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"p5z0o5ap1sma53jyev","Name":"Look Inject","ParentKey":"gold_room","Syntax":"","Logic":"inj_look","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"ui2br8tp1v8ma5mnlya","Name":"Look Inject","ParentKey":"home","Syntax":"","Logic":"inj_look","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"6g0pkq3o5d6ma5mpz9c","Name":"Look Inject","ParentKey":"fight_room","Syntax":"","Logic":"inj_look","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"jcvkltq37lma6ljrag","Name":"Take Key","ParentKey":"sbnygl5t5oma2brpwl","Syntax":"take.*key","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"z564fzl6lvma6ll8jz","Name":"Take Move","ParentKey":"jcvkltq37lma6ljrag","Syntax":"","Logic":"[player]","Output":"You take the key.","Tags":"[self]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"set","ElementKey":"q3xw38ihvqma6lpdrv","Name":"Set Tags","ParentKey":"jcvkltq37lma6ljrag","Syntax":"","Logic":"[self]tags","Output":"+inventory","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"4l7rizzl9yfma7wxoox","Name":"Box","ParentKey":"zk81c0w7zjnma2bqqdr","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"c7nt4i3bqn9ma7wy4jc","Name":"Look","ParentKey":"4l7rizzl9yfma7wxoox","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},
  {"ElementType":"message","ElementKey":"v5rzguq9pmma7wygpr","Name":"Look Message","ParentKey":"c7nt4i3bqn9ma7wy4jc","Syntax":"","Logic":"","Output":"\nYou see a box.","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"92f3p1agygema7wzndi","Name":"enter message","ParentKey":"4l7rizzl9yfma7wxoox","Syntax":"","Logic":"","Output":"You see a box.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"gp4no9g78eqma7x2nu4","Name":"Look Inject","ParentKey":"taking_room","Syntax":"","Logic":"inj_look","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"fdxyb4qcvj4ma7xbq0b","Name":"Inputs","ParentKey":"4l7rizzl9yfma7wxoox","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"6zjqsxo2jeema7xc2jv","Name":"Put In","ParentKey":"fdxyb4qcvj4ma7xbq0b","Syntax":"put.*in.*box","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"yp18hcqisxma7xgx6m","Name":"Put Move","ParentKey":"6zjqsxo2jeema7xc2jv","Syntax":"","Logic":"[self]","Output":"You put the [target] in the box.\n","Tags":"[syntax]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"logic","ElementKey":"mekgoot1fomaatg3zp","Name":"Look Logic","ParentKey":"c7nt4i3bqn9ma7wy4jc","Syntax":"","Logic":"[self]parent = [room]","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"logic","ElementKey":"zegs98vqzpmaatkvop","Name":"Look Logic","ParentKey":"2ptijbkghwtma2buip7","Syntax":"","Logic":"[self]parent = [room]","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"1h6byifr0s7macb7lso","Name":"Examine Box","ParentKey":"fdxyb4qcvj4ma7xbq0b","Syntax":"examine.*box|x.*box","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"action","ElementKey":"3fi0mi768yqmacb9ddx","Name":"Examine Action","ParentKey":"1h6byifr0s7macb7lso","Syntax":"","Logic":"examine_box","Output":"","Tags":"type|self","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"examine_box","ElementKey":"3dutj1qh8grmacbcevn","Name":"Examine_Box","ParentKey":"4l7rizzl9yfma7wxoox","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"action","ElementKey":"0p3y3uos28gnmacbf188","Name":"Examine Action","ParentKey":"3dutj1qh8grmacbcevn","Syntax":"","Logic":"look","Output":"You examine the box\n","Tags":"type|children","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"room","ElementKey":"arming_room","Name":"Arming Room","ParentKey":"at73dh77pchm92hdikb","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"yk3r6g47w5lmadomld4","Name":"Enter Message","ParentKey":"arming_room","Syntax":"","Logic":"","Output":"Welcome to the weapon arming room.\nThis is a place where you can pick up a weapon.\nOnce you have picked it up you can use:\n\narm [weapon]\n\nIf you drop that armed weapon, you should automatically be armed\nwith any other weapon you are carrying.\nIf you have no weapons, you will deal a very low, empty hand\namount of damage in fights.\n\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"euzof6ki3qkmadopstx","Name":"Objects","ParentKey":"arming_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"apwxvezo19qmadoqg38","Name":"Look Inject","ParentKey":"arming_room","Syntax":"","Logic":"inj_look","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"b8x2kb8hachmadorsxf","Name":"Custom Elements","ParentKey":"arming_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"5c07o05zfpjmadov02g","Name":"Look","ParentKey":"b8x2kb8hachmadorsxf","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"ihesbcdup1imadovci8","Name":"Look Message","ParentKey":"5c07o05zfpjmadov02g","Syntax":"","Logic":"","Output":"You look around...\nYou are in a room where you can pick up a weapon.\nOnce you have picked it up you can use:\n\narm [weapon]\n\nIf you drop that armed weapon, you should automatically be armed\nwith any other weapon you are carrying.\nIf you have no weapons, you will deal a very low, empty hand\namount of damage in fights.\n\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"spear_01","Name":"Spear","ParentKey":"euzof6ki3qkmadopstx","Syntax":"(spear).*","Logic":"","Output":"","Tags":"!_weapon","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},
  {"ElementType":"attribute","ElementKey":"bcdflvzg5bjmadp09yr","Name":"Damage","ParentKey":"spear_01","Syntax":"","Logic":"[roll:(4)2d8]","Output":"","Tags":"!_damage","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"e0i1p4b0j4nmadp1gfu","Name":"frendly name","ParentKey":"spear_01","Syntax":"","Logic":"","Output":"a spear","Tags":"title","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"oriw86rejormadp79cl","Name":"Take Input","ParentKey":"spear_01","Syntax":"(take.*spear)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"0daz9ql0dixhmadp8chp","Name":"Take Move","ParentKey":"oriw86rejormadp79cl","Syntax":"","Logic":"[player]","Output":"You take the spear.","Tags":"[self]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"set","ElementKey":"us7fs138wfmadp9yza","Name":"Set Tags","ParentKey":"oriw86rejormadp79cl","Syntax":"","Logic":"[self]tags","Output":"+inventory","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"610rxwvhquamadpctiv","Name":"ArmingRoom Door","ParentKey":"2kljng90mscma2adz4n","Syntax":"(arming)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"z7vl25pzxkmadpe9gz","Name":"ArmingRoomDoor Action","ParentKey":"610rxwvhquamadpctiv","Syntax":"","Logic":"arming_room","Output":"You have decided to test arming.\n\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"ns9lfd22omaf3fvjm","Name":"Enter Message","ParentKey":"spear_01","Syntax":"","Logic":"","Output":"You see a spear.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"t7559keba3mmafw9c4w","Name":"Default Room Action","ParentKey":"game","Syntax":"","Logic":"","Output":"look","Tags":"!_defact","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"yx8hfn8m24bmagk7epl","Name":"Drop Input","ParentKey":"spear_01","Syntax":"(drop.*spear)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"l8z9cd1m64magk95ox","Name":"Drop Move","ParentKey":"yx8hfn8m24bmagk7epl","Syntax":"","Logic":"[room]","Output":"You drop the spear.\n","Tags":"[self]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"set","ElementKey":"4p4t5z7kimumagkakt4","Name":"Set Tags","ParentKey":"yx8hfn8m24bmagk7epl","Syntax":"","Logic":"[self]tags","Output":"-inventory","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"as4fea9hj0nmaglc4lu","Name":"Look","ParentKey":"spear_01","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"9bxzohuw6ximaglcleh","Name":"Look Message","ParentKey":"as4fea9hj0nmaglc4lu","Syntax":"","Logic":"","Output":"You see a spear.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"logic","ElementKey":"4vrdlfl8pl4magld85s","Name":"Look Logic","ParentKey":"as4fea9hj0nmaglc4lu","Syntax":"","Logic":"[self]parent = [room]","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"u8qhfrww2vbmagmt1bj","Name":"Look","ParentKey":"long-sword_01","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"o74dtlozygmmagmtge6","Name":"Look Message","ParentKey":"u8qhfrww2vbmagmt1bj","Syntax":"","Logic":"","Output":"You see a long sword.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"tx9hyy7owj8magmuvqs","Name":"Drop Input","ParentKey":"long-sword_01","Syntax":"(drop.*sword)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"jz7s3i0aneimagmw8yj","Name":"Drop Move","ParentKey":"tx9hyy7owj8magmuvqs","Syntax":"","Logic":"[room]","Output":"You drop the long sword.\n","Tags":"[self]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"set","ElementKey":"ak0v6ohw9cmagmxy7l","Name":"Set Tags","ParentKey":"tx9hyy7owj8magmuvqs","Syntax":"","Logic":"[self]tags","Output":"-inventory","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},
  {"ElementType":"logic","ElementKey":"q5oak1m6becmagn0at3","Name":"Look Logic","ParentKey":"u8qhfrww2vbmagmt1bj","Syntax":"","Logic":"?[self]parent = [room]","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"logic","ElementKey":"yoqrt0b0foimagn1m66","Name":"Drop Logic","ParentKey":"tx9hyy7owj8magmuvqs","Syntax":"","Logic":"?[self]parent = [player]elementkey","Output":"You aren't carrying that item.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"logic","ElementKey":"v8b6hexgjgmagn2x1o","Name":"Drop Logic","ParentKey":"yx8hfn8m24bmagk7epl","Syntax":"","Logic":"?[self]parent = [player]elementkey","Output":"You aren't carrying that item.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"room","ElementKey":"msg_room","Name":"Message Room","ParentKey":"at73dh77pchm92hdikb","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"0tio4d6mcegdmahz242n","Name":"MsgRoom Door","ParentKey":"2kljng90mscma2adz4n","Syntax":"(message)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"uvrv8ck1ohmahz44oc","Name":"RandMsgRoomDoor Action","ParentKey":"0tio4d6mcegdmahz242n","Syntax":"","Logic":"msg_room","Output":"You have decided to test random messages.\n","Tags":"[player]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"sq71q6pnu2gmahz5xd1","Name":"Enter Message","ParentKey":"msg_room","Syntax":"","Logic":"","Output":"Welcome to the message testing room.\nTo test the various message repeat options simply enter:\n\nlook\nor\nl\n\nrepeatedly.\n\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"navigation","ElementKey":"inj_home_nav","Name":"Inj Home Nav","ParentKey":"zfofgknktfkm92iqoxe","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"wq3g6kja7dmahzfa43","Name":"Nav Msg","ParentKey":"inj_home_nav","Syntax":"","Logic":"","Output":"\n\nYou can return home using:\nhome","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"q0tb4evql4imahzgk9s","Name":"Nav Inject","ParentKey":"msg_room","Syntax":"","Logic":"inj_home_nav","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"myd742fflcmahzhb0n","Name":"Nav Inject","ParentKey":"arming_room","Syntax":"","Logic":"inj_home_nav","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"input","ElementKey":"inj_home_input","Name":"Inj Home Input","ParentKey":"zfofgknktfkm92iqoxe","Syntax":"(home)","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"move","ElementKey":"ubpn9gw5bypmahzopjf","Name":"Home Action","ParentKey":"inj_home_input","Syntax":"","Logic":"home","Output":"","Tags":"[player]","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"jxna7dt2fymahzpztk","Name":"Home Inject","ParentKey":"msg_room","Syntax":"","Logic":"inj_home_input","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"painp7o9efmahzss3b","Name":"Home Inject","ParentKey":"arming_room","Syntax":"","Logic":"inj_home_input","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"w13s5g40zhnmahzu22k","Name":"Home Inject","ParentKey":"taking_room","Syntax":"","Logic":"inj_home_input","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"a65n8o3fn9dmahzuqrm","Name":"Home Inject","ParentKey":"fight_room","Syntax":"","Logic":"inj_home_input","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"4ayz2fpoipvmahzvcz6","Name":"Home Inject","ParentKey":"gold_room","Syntax":"","Logic":"inj_home_input","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"hye597pydmahzzbpz","Name":"Objects","ParentKey":"msg_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"folder","ElementKey":"omlubg7l1kmai00n25","Name":"Custom Elements","ParentKey":"msg_room","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},
  {"ElementType":"look","ElementKey":"57ri1v22nbmai016ms","Name":"Look","ParentKey":"omlubg7l1kmai00n25","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"hplke1qmbmvmai01lad","Name":"Look Message","ParentKey":"57ri1v22nbmai016ms","Syntax":"","Logic":"","Output":"You look around...\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"injection","ElementKey":"o5ura3zurmmmai02lqb","Name":"Look Inject","ParentKey":"msg_room","Syntax":"","Logic":"inj_look","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"i3vwjqudrtgmai04zf0","Name":"Random Parchment","ParentKey":"hye597pydmahzzbpz","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"1dt7myspa4fmai05phc","Name":"Enter Message","ParentKey":"i3vwjqudrtgmai04zf0","Syntax":"","Logic":"","Output":"You see a random message parchment.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"j12t7j674hqmai08fou","Name":"Look","ParentKey":"i3vwjqudrtgmai04zf0","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"9fynak7n7bsmai08zn1","Name":"Look Message Group","ParentKey":"j12t7j674hqmai08fou","Syntax":"","Logic":"","Output":"This is the message group.\nIt's random messages should show below:\n","Tags":"","Repeat":"random","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"8rc9jd6o5fmai09toc","Name":"Message 1","ParentKey":"9fynak7n7bsmai08zn1","Syntax":"","Logic":"","Output":"Oh! This message is so random.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"fu3hxrszmnimai0aor7","Name":"Message 2","ParentKey":"9fynak7n7bsmai08zn1","Syntax":"","Logic":"","Output":"Yet another random message!\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"pbijdsq6hyhmai0bgfm","Name":"Message 3","ParentKey":"9fynak7n7bsmai08zn1","Syntax":"","Logic":"","Output":"Oh man, another random message!\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"sxhoalhq8fmajcqe36","Name":"Repeating Parchment","ParentKey":"hye597pydmahzzbpz","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"yqubdriqzhfmajcr3i8","Name":"Enter Message","ParentKey":"sxhoalhq8fmajcqe36","Syntax":"","Logic":"","Output":"You see a repeating message parchment.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"mqi0wyn2leimajcsbi7","Name":"Look","ParentKey":"sxhoalhq8fmajcqe36","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"fg9a4ww8ozmajcsqen","Name":"Look Message Group","ParentKey":"mqi0wyn2leimajcsbi7","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"repeat","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"gp8i755ch0emajctfgm","Name":"Message 1","ParentKey":"fg9a4ww8ozmajcsqen","Syntax":"","Logic":"","Output":"This is repeating message number 01\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"vzft2j1xcomajcu3x3","Name":"Message 2","ParentKey":"fg9a4ww8ozmajcsqen","Syntax":"","Logic":"","Output":"This is repeating message number 02\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"mycrqif5yaqmajcun1q","Name":"Message 3","ParentKey":"fg9a4ww8ozmajcsqen","Syntax":"","Logic":"","Output":"This is repeating message number 03\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"j02qx4ry8kmmaje5uag","Name":"Non Repeating Parchment","ParentKey":"hye597pydmahzzbpz","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"gzan1i6ygwlmaje7166","Name":"Enter Message","ParentKey":"j02qx4ry8kmmaje5uag","Syntax":"","Logic":"","Output":"You see a non-repeating message parchment.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"0dm7hwmghtopmaje90ws","Name":"Look","ParentKey":"j02qx4ry8kmmaje5uag","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},
  {"ElementType":"message","ElementKey":"2mikkxq7cx8majea6cj","Name":"Look Message Group","ParentKey":"0dm7hwmghtopmaje90ws","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"none","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"z512w1g0q8gmajeeuov","Name":"Message 1","ParentKey":"2mikkxq7cx8majea6cj","Syntax":"","Logic":"","Output":"This is non-repeating message number 01\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"sb818vdrrlmajeg2nh","Name":"Message 2","ParentKey":"2mikkxq7cx8majea6cj","Syntax":"","Logic":"","Output":"This is non-repeating message number 02\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"e8ohfdsze6majegv84","Name":"Message 3","ParentKey":"2mikkxq7cx8majea6cj","Syntax":"","Logic":"","Output":"This is non-repeating message number 03\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"object","ElementKey":"gda7q2igx4gmakrv8jp","Name":"Other Parchment","ParentKey":"hye597pydmahzzbpz","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"enter_message","ElementKey":"plwqjnn578qmakrx1g3","Name":"Enter Message","ParentKey":"gda7q2igx4gmakrv8jp","Syntax":"","Logic":"","Output":"You see an 'other' repeating message parchment.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"look","ElementKey":"0q4wk5i39ngpmaks0ivs","Name":"Look","ParentKey":"gda7q2igx4gmakrv8jp","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"g4dd3guacysmaks17l3","Name":"Look Message Group","ParentKey":"0q4wk5i39ngpmaks0ivs","Syntax":"","Logic":"","Output":"","Tags":"","Repeat":"[room]((oth_idx))","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"dfpfa0smmhimaks1xjj","Name":"Message 1","ParentKey":"g4dd3guacysmaks17l3","Syntax":"","Logic":"","Output":"This is 'other' message 01.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"dmxg9kp80wkmaks3cn9","Name":"Message 2","ParentKey":"g4dd3guacysmaks17l3","Syntax":"","Logic":"","Output":"This is 'other' message 02.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"message","ElementKey":"mso6iso25ibmaks3xgl","Name":"Message 3","ParentKey":"g4dd3guacysmaks17l3","Syntax":"","Logic":"","Output":"This is 'other' message 03.\n","Tags":"","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""},{"ElementType":"attribute","ElementKey":"7loqg3zb353maks58ab","Name":"Custom Message Index","ParentKey":"msg_room","Syntax":"","Logic":"","Output":"1","Tags":"oth_idx","Repeat":"","RepeatIndex":"0","Template":"","Active":"true","Sort":""}
];

        // Regex Library
        const regexLib = [
            { "Description": "Look", "Regex": "(look(?: around)?|l)" },
            { "Description": "Down Stairs", "Regex": "(?:descend(?: the)? stairs|go down(?: the)? stairs|go down|down stairs|down)" },
            { "Description": "Up Stairs", "Regex": "(?:ascend(?: the)? stairs|go up(?: the)? stairs|go up|up stairs|up)" },
            { "Description": "Leave", "Regex": "leave(?:\\s+(?:the|this)?\\s*(?:room|area|place))?" },
            { "Description": "Left", "Regex": "(?:go\\s+)?left" },
            { "Description": "Right", "Regex": "(?:go\\s+)?right" },
            { "Description": "Forward", "Regex": "(?:go\\s+)?forward" },
            { "Description": "Backward", "Regex": "(?:go\\s+)?backward" },
            { "Description": "North", "Regex": "(go\\s+)?north|^n$" },
            { "Description": "East", "Regex": "(go\\s+)?east|^e$" },
            { "Description": "South", "Regex": "(go\\s+)?south|^s$" },
            { "Description": "West", "Regex": "(go\\s+)?west|^w$" },
            { "Description": "Examine ITEM", "Regex": "(?:examine|x)\\s+(?:the\\s+)?ITEM" },
            { "Description": "Look Under ITEM", "Regex": "look\\s+under\\s+(the\\s+)?ITEM" },
            { "Description": "Look In ITEM", "Regex": "look\\s+in\\s+(the\\s+)?ITEM" },
            { "Description": "Open ITEM", "Regex": "open(?: the)? ITEM" },
            { "Description": "Close ITEM", "Regex": "close(?: the)? ITEM" },
            { "Description": "Pull ITEM", "Regex": "pull(?:\\s+the)?\\s+ITEM" },
            { "Description": "Take X ITEM", "Regex": "take\\s+(?:the\\s+)?(?:X\\s+)?ITEM" },
            { "Description": "Drop ITEM", "Regex": "(?:drop|put down)\\s+(?:the\\s+)?ITEM" },
            { "Description": "Put In ITEM", "Regex": "put.*in.*ITEM" },
            { "Description": "Attack FOE", "Regex": "(attack.*FOE|!.*FOE)" },
        ];


        let currentParent = null;
        let newElementParentKey = "";
        let expandedNodes = new Set();

        // !@! icons
        // Icons
            const icoGame = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g aria-label="G" id="text8654" style="font-weight:bold;font-size:3.8988px;font-family:'ITC Bauhaus';-inkscape-font-specification:'ITC Bauhaus Bold';fill:none;stroke:#8e8e8e;stroke-width:0.0142143;stroke-linejoin:bevel;paint-order:stroke fill markers"> <path d="m 2.2882142,3.5085379 c 0.4054751,0 0.7563671,-0.1208628 1.0448783,-0.3586896 V 1.9490179 H 2.1790478 v 0.428868 h 0.6666947 v 0.5770224 c -0.136458,0.070178 -0.3041063,0.1130652 -0.4912487,0.1130652 -0.565326,0 -0.9279144,-0.3781836 -0.9279144,-0.9824976 0,-0.58482 0.3391956,-0.9162179 0.9396108,-0.9162179 0.2378268,0 0.5146415,0.050684 0.7251767,0.1247616 L 3.2317237,0.90024076 C 2.9977957,0.78717557 2.7014869,0.72479477 2.3973806,0.72479477 c -0.9084204,0 -1.4971392,0.56922483 -1.4971392,1.41916313 0,0.818748 0.5536296,1.36458 1.3879728,1.36458 z" style="font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;stroke:none" id="path9293" /> </g> </svg>`;
            const icoPlayer = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g id="layer1" style="fill:#ffffff;fill-opacity:1;stroke:none" transform="matrix(0.74013018,0,0,0.74013018,0.55005776,0.55005778)"> <g aria-label="G" id="text147" style="font-weight:bold;font-size:5.4836px;font-family:'DejaVu Sans';-inkscape-font-specification:'DejaVu Sans Bold';fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.931837;stroke-linecap:round;stroke-linejoin:round"> <path id="path1202" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.245993;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="M 2.1154655,0.29958256 A 0.95769183,0.95769183 0 0 0 1.157917,1.2576116 0.95769183,0.95769183 0 0 0 1.5470861,2.0268214 C 1.0473631,2.1507604 0.63085688,2.4696209 0.63085688,3.1299481 V 3.9337508 H 3.6024763 V 3.1299481 c 0,-0.6590471 -0.4175177,-0.9788423 -0.9176706,-1.1031267 A 0.95769183,0.95769183 0 0 0 3.0734944,1.2576116 0.95769183,0.95769183 0 0 0 2.1154655,0.29958256 Z" /> </g> </g> </svg>`;
            const icoRoom = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path id="path3110" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.128568;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="M 2.1166666,0.6755942 1.3764382,1.2733867 0.63620985,1.8711792 H 1.094196 V 3.4357827 H 3.1391372 V 1.8711792 H 3.5971234 L 2.856895,1.2733867 Z" /> <rect style="fill:#9c9c9c;fill-opacity:1;stroke:none;stroke-width:0.150738;stroke-linejoin:bevel;paint-order:stroke fill markers" id="rect12310" width="0.49860835" height="0.72685415" x="2.2512157" y="2.7089283" /> <rect style="fill:#9c9c9c;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="rect13248" width="0.47124618" height="0.46280029" x="1.540359" y="1.9300244" /> </svg>`;
            const icoAttrib = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <text xml:space="preserve" style="font-weight:bold;font-size:3.45983px;font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;stroke-width:0.0126139;stroke-linejoin:bevel;paint-order:stroke fill markers" x="1.644399" y="3.3846965" id="text21025"><tspan id="tspan21023" style="stroke-width:0.0126139" x="1.644399" y="3.3846965">i</tspan></text> </svg>`;
            const icoOther = `<svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" xmlns="http://www.w3.org/2000/svg"><path style="fill:none;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;" d="M 0.69371456,2.1166666 H 3.5396187"/></svg>`;
            const icoObject = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" sodipodi:docname="object_ico.svg" inkscape:version="1.2.2 (b0a8486, 2022-12-01)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <sodipodi:namedview id="namedview38" pagecolor="#505050" bordercolor="#eeeeee" borderopacity="1" inkscape:showpageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#505050" showgrid="false" inkscape:zoom="42.382213" inkscape:cx="4.1408881" inkscape:cy="8.0104359" inkscape:window-width="1916" inkscape:window-height="1074" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg5" showguides="true"> <sodipodi:guide position="2.1166666,4.4412308" orientation="16.206024,0" id="guide328" inkscape:locked="false" /> <sodipodi:guide position="2.3785036,2.3187412" orientation="0,-1" id="guide334" inkscape:locked="false" /> <sodipodi:guide position="2.9715688,0.78298396" orientation="0,-1" id="guide336" inkscape:locked="false" /> <sodipodi:guide position="0.69898409,1.7050026" orientation="1,0" id="guide338" inkscape:locked="false" /> <sodipodi:guide position="3.5343492,2.7683155" orientation="1,0" id="guide340" inkscape:locked="false" /> <sodipodi:guide position="3.5343493,2.9508443" orientation="0,-1" id="guide352" inkscape:locked="false" /> <sodipodi:guide position="3.5343492,1.4150872" orientation="0,-1" id="guide354" inkscape:locked="false" /> <sodipodi:guide position="2.4534171,3.5829476" orientation="0,-1" id="guide1047" inkscape:locked="false" /> </sodipodi:namedview> <defs id="defs2" /> <path style="fill:#ffffff;stroke:none;stroke-width:0.185208;stroke-linecap:round;stroke-dasharray:none;paint-order:stroke fill markers;fill-opacity:1" d="M 2.1166666,0.65038564 3.5343491,1.282489 v 1.5357571 l -1.4176825,0.63832 -1.4176825,-0.63832 V 1.282489 Z" id="path1063" /> <path style="fill:#ffffff;stroke:none;stroke-width:0.185208;stroke-linecap:round;stroke-dasharray:none;paint-order:stroke fill markers;fill-opacity:1" d="M 2.1166666,0.65038564 3.5343491,1.282489 v 1.5357571 l -1.4176825,0.63832 -1.4176825,-0.63832 V 1.282489 Z" id="path2373" /> <path style="fill:none;fill-opacity:1;stroke:#8e8e8e;stroke-width:0.18520833;stroke-linecap:butt;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers;stroke-linejoin:bevel" d="M 0.6989841,1.282489 2.1166666,1.9145921 3.5343491,1.282489" id="path5018" /> <path style="fill:none;fill-opacity:1;stroke:#8e8e8e;stroke-width:0.185208;stroke-linecap:butt;stroke-linejoin:bevel;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="M 2.1166666,1.9145921 V 3.4503492" id="path6370" /> </svg>`;
            const icoMessage = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.165345;stroke-linejoin:bevel;paint-order:stroke fill markers" id="rect15482" width="1.9418752" height="2.6706309" x="1.1457291" y="0.78135115" /> <path style="fill:none;fill-opacity:1;stroke:#939393;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" d="M 1.5488185,1.5004032 H 2.6845148" id="path15542" /> <path style="fill:none;fill-opacity:1;stroke:#939393;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" d="M 1.5488185,2.1166666 H 2.6845148" id="path16407" /> </svg>`;
            const icoMove = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path16515" d="m 2.8393816,2.1992004 -1.0961629,0.6328699 -1.09616284,0.6328699 0,-1.2657398 0,-1.26573985 1.09616294,0.63286995 z" transform="translate(0.37344791,-0.08253377)" /> </svg>`;
            const icoAttack = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g id="g17152" transform="rotate(45,2.1018541,2.1105311)"> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.198799;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="rect17051" width="0.73135507" height="2.6537266" x="1.7509891" y="0.90471673" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path17125" d="m 2.1166666,0.3620086 0.1814879,0.31434643 0.181488,0.31434643 -0.3629759,-1e-8 -0.362976,-10e-9 0.181488,-0.31434641 z" transform="translate(7.521059e-8,-0.07733837)" /> <rect style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="rect17127" width="2.029305" height="0.49957958" x="1.1020142" y="2.3346605" /> </g> </svg>`;
            const icoGlobal = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <circle style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path17273" cx="2.1166666" cy="2.1166666" r="1.3248924" /> <path style="fill:none;fill-opacity:1;stroke:#8e8e8e;stroke-width:0.19686;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" d="M 1.1448412,2.1166666 H 3.0884921" id="path17275" /> </svg>`;
            const icoAction = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g aria-label="!" id="text18965" style="font-weight:bold;font-size:4.37606px;font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;stroke-width:0.0159544;stroke-linejoin:bevel;paint-order:stroke fill markers"> <path d="m 1.9000508,2.5849076 h 0.437606 L 2.3989217,0.57629608 H 1.838786 Z m 0.214427,1.0721347 c 0.223179,0 0.3763411,-0.1619142 0.3763411,-0.3719651 0,-0.223179 -0.1531621,-0.3850933 -0.3763411,-0.3850933 -0.2231791,0 -0.3719651,0.1619143 -0.3719651,0.3850933 0,0.2100509 0.148786,0.3719651 0.3719651,0.3719651 z" id="path19468" /> </g> </svg>`;
            const icoInput = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="path19523" d="m 1.275162,2.0133541 -0.7057629,0.4074724 -0.70576287,0.4074724 3e-8,-0.8149449 -3e-8,-0.8149447 0.70576291,0.4074724 z" transform="translate(0.61360234,0.10331256)" /> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers;stroke-opacity:1" d="M 1.952999,2.9316113 H 3.5563688" id="path19525" /> </svg>`;
            const icoLogic = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g aria-label="?" id="text20223" style="font-weight:bold;font-size:3.75627px;font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;stroke-width:0.0136947;stroke-linejoin:bevel;paint-order:stroke fill markers"> <path d="m 1.8931671,2.5486401 h 0.47329 V 2.3983893 c 0,-0.3042579 0.5446591,-0.4432398 0.5446591,-0.9766302 0,-0.4019209 -0.3080141,-0.6460784 -0.8151106,-0.6460784 -0.2629389,0 -0.5409028,0.0676129 -0.7737916,0.18405722 L 1.4349021,1.3240961 c 0.180301,-0.086394 0.3606019,-0.1277132 0.5371466,-0.1277132 0.277964,0 0.4394836,0.1089319 0.4394836,0.2892328 0,0.319283 -0.5183652,0.47329 -0.5183652,0.9127736 z m 0.236645,0.9090173 c 0.1878135,0 0.3192829,-0.1352257 0.3192829,-0.3192829 0,-0.1953261 -0.1277132,-0.3305518 -0.3192829,-0.3305518 -0.1915698,0 -0.3230392,0.1352257 -0.3230392,0.3305518 0,0.1840572 0.1352257,0.3192829 0.3230392,0.3192829 z" id="path20755" /> </g> </svg>`;
            const icoInject = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers;stroke-opacity:1" d="M 1.952999,2.9316113 H 3.5563688" id="path19525" /> <text xml:space="preserve" style="font-weight:bold;font-size:3.24209px;font-family:System-ui;-inkscape-font-specification:'System-ui Bold';fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.0118201;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" x="0.22496246" y="3.1849368" id="text20814"><tspan id="tspan20812" style="stroke-width:0.0118201" x="0.22496246" y="3.1849368">+</tspan></text> </svg>`;
            const icoSet = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="path19523" d="m 1.275162,2.0133541 -0.7057629,0.4074724 -0.70576287,0.4074724 3e-8,-0.8149449 -3e-8,-0.8149447 0.70576291,0.4074724 z" transform="translate(0.61360234,0.10331256)" /> <rect style="fill:#ffffff;stroke-width:0.185208;stroke-linejoin:bevel;paint-order:stroke fill markers" id="rect20904" width="1.4300268" height="1.9852276" x="2.4454238" y="1.1240529" /> </svg>`;
            const icoNav = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path1135" d="m 2.1166666,-0.50851178 0.3327753,0.5763839 0.3327754,0.57638386 -0.6655507,-7e-8 -0.6655508,4e-8 0.3327754,-0.57638383 z" transform="matrix(0.84700546,0,0,0.84700546,0.32383842,0.7832153)" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path1617" d="m 2.1166666,-0.50851178 0.3327753,0.5763839 0.3327754,0.57638386 -0.6655507,-7e-8 -0.6655508,4e-8 0.3327754,-0.57638383 z" transform="matrix(0,0.84700546,-0.84700546,0,3.464608,0.33165152)" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path1619" d="m 2.1166666,-0.50851178 0.3327753,0.5763839 0.3327754,0.57638386 -0.6655507,-7e-8 -0.6655508,4e-8 0.3327754,-0.57638383 z" transform="matrix(-0.84700546,0,0,-0.84700546,3.9016279,3.460076)" /> <path style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:0.185208;stroke-linejoin:bevel;stroke-opacity:1;paint-order:stroke fill markers" id="path1621" d="m 2.1166666,-0.50851178 0.3327753,0.5763839 0.3327754,0.57638386 -0.6655507,-7e-8 -0.6655508,4e-8 0.3327754,-0.57638383 z" transform="matrix(0,-0.84700546,0.84700546,0,0.76085834,3.9116397)" /> </svg>`;

            const icoTreeExp = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="24" height="16" viewBox="0 0 6.3500001 4.2333332" version="1.1" id="svg5" inkscape:version="1.2.2 (b0a8486, 2022-12-01)" sodipodi:docname="tree_exp.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <sodipodi:namedview id="namedview7" pagecolor="#505050" bordercolor="#eeeeee" borderopacity="1" inkscape:showpageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#505050" inkscape:document-units="px" showgrid="false" inkscape:zoom="42.117048" inkscape:cx="12.441518" inkscape:cy="8.0371255" inkscape:window-width="1916" inkscape:window-height="1068" inkscape:window-x="0" inkscape:window-y="4" inkscape:window-maximized="1" inkscape:current-layer="layer1" /> <defs id="defs2" /> <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1"> <g id="g120" transform="matrix(0.54946881,0,0,0.54946881,0.08585497,0.9533879)"> <rect style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.240763;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" id="rect2158" width="3.8522053" height="3.8522053" x="0.19056387" y="0.19056387" /> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="M 2.1166665,0.7394208 V 3.4939122" id="path3687" /> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="M 3.4939122,2.1166665 H 0.7394208" id="path3689" /> </g> </g> </svg>`;
            const icoTreeCol = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="24" height="16" viewBox="0 0 6.3500001 4.2333332" version="1.1" id="svg5" inkscape:version="1.2.2 (b0a8486, 2022-12-01)" sodipodi:docname="tree_col.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <sodipodi:namedview id="namedview7" pagecolor="#505050" bordercolor="#eeeeee" borderopacity="1" inkscape:showpageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#505050" inkscape:document-units="px" showgrid="false" inkscape:zoom="42.117048" inkscape:cx="12.417774" inkscape:cy="8.0371255" inkscape:window-width="1916" inkscape:window-height="1068" inkscape:window-x="0" inkscape:window-y="4" inkscape:window-maximized="1" inkscape:current-layer="layer1" /> <defs id="defs2" /> <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1"> <g id="g248" transform="matrix(0.54945826,0,0,0.54945826,0.08585698,0.95364662)"> <rect style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.240763;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" id="rect2158" width="3.8522053" height="3.8522053" x="0.19056387" y="0.19056387" /> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="M 3.4939122,2.1166665 H 0.7394208" id="path3689" /> </g> </g> </svg>`;
            const icoFolder = `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg138" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs135" /> <g id="layer1"> <path id="rect233" style="fill:#ffffff;stroke:none;stroke-width:0.264583;paint-order:stroke fill markers;fill-opacity:1" d="M 0.26458333 0.52916667 L 0.26458333 1.0583333 L 0.26458333 1.3229167 L 0.26458333 3.7041667 L 3.96875 3.7041667 L 3.96875 1.0583333 L 2.38125 1.0583333 L 2.38125 1.3229167 L 3.7041667 1.3229167 L 3.7041667 3.4395833 L 0.52916667 3.4395833 L 0.52916667 1.4226522 L 0.52916667 1.3229167 L 0.52916667 1.0583333 L 0.52916667 0.79375 L 2.1166667 0.79375 L 2.1166667 0.52916667 L 0.26458333 0.52916667 z M 2.1166667 0.79375 L 2.1166667 1.0583333 L 2.38125 1.0583333 L 2.38125 0.79375 L 2.1166667 0.79375 z " /> </g> </svg>`;

        // Global Vars
            const adminInput = document.getElementById("admin-input");
            const adminInterface = document.getElementById("admin-interface");
            const adminInputContainer = document.getElementById("admin-input-container");
            const treeview = document.getElementById("treeview");
            const details = document.getElementById("details");
            const editorContainer = document.getElementById("editor-container");
            const elemLimit = 20; // Number of elements per line in the db
            const elementTypes = [
                "action", "attack", "attribute", "custom", "dev_note", "enter_message", "flee", "global", "injection",
                "input", "link", "logic", "message", "move", "navigation", "nothing", "npc", "object",
                "room", "round", "rule", "ruleset", "set", "test", "travel", "folder"
            ];


        function createNewElement(elementKey, elementType, name, doLogging, doShowDetails)
        {
            if (elementKey == "")
            {
                elementKey = getGuid();
            }

            let entry = {
                ElementType: elementType,
                ElementKey: elementKey,
                Name: name,
                ParentKey: currentParent,
                Syntax: "",
                Logic: "",
                Output: "",
                Tags: "",
                Repeat: "",
                RepeatIndex: "0",
                Template: "",
                Active: "true",
                Sort: ""
            };

            database.push(entry);

            if (entry.ParentKey) {
                newElementParentKey = entry.ParentKey;
            }

            if (doShowDetails)
            {
                showDetails(entry);
            }

            buildTreeView(true);

            if (doLogging == true)
            {
                logAdminMessage("Added: " + entry.Name);
            }
        }

        function setParent(newParent)
        {
            let elem = database.filter(item => item.ElementKey === currentParent)[0];

            elem.ParentKey = newParent;

            showDetails(elem);

            buildTreeView(true);
        }

        function createNewFullElement(
            elementType,
            elementKey,
            name,
            parentKey,
            syntax,
            logic,
            output,
            tags,
            repeat,
            sort
        )
        {
            if (elementKey == "")
            {
                elementKey = getGuid();
            }

            let entry = {
                ElementType: elementType,
                ElementKey: elementKey,
                Name: name,
                ParentKey: parentKey,
                Syntax: syntax,
                Logic: logic,
                Output: output,
                Tags: tags,
                Repeat: repeat,
                RepeatIndex: "0",
                Template: "",
                Active: "true",
                Sort: sort
            };

            database.push(entry);
        }

        function updateElementType(item, newType)
        {
            item.ElementType = newType;
            showDetails(item);
        }


        function logAdminMessage(message)
        {
            details.innerHTML = message + "<br>";
            details.scrollTop = details.scrollHeight;
        }

        function getGuid()
        {
            return Math.random().toString(36).substring(2) + (new Date()).getTime().toString(36);
        }

        function processInput(command)
        {
            if (command === "!_admin") {
                enterAdminMode();
                return;
            }
        }

        function processAdminInput(command)
        {
            if (command.startsWith("add "))
            {
                createNewElement("", "", command.substring(4), true, true);
                return;
            }
            if (command.startsWith("parent "))
            {
                setParent(command.substring(7));
                return;
            }

            switch (command)
            {
                case "exit":
                    exitAdminMode();
                    break;
                case "database":
                case "db":
                    openDatabaseModal();
                    break;
                case "save":
                    saveFile();
                    break;
                default:
                    logMessage("Unknown command: " + command);
                    break;
            }
        }

        // !@! [saving save file savefile]
        function saveFile()
        {
            let htmlDoc = document.documentElement.cloneNode(true);

            // Make sure the latest database is stored
            let latestDatabase = JSON.parse(JSON.stringify(database)); // Deep clone to ensure correctness

            // Build compact JSON with newlines every elemLimit items
            let lines = [];
            for (let i = 0; i < latestDatabase.length; i += elemLimit) {
                let chunk = latestDatabase.slice(i, i + elemLimit);
                lines.push(JSON.stringify(chunk).slice(1, -1)); // Strip [ and ]
            }
            let formattedDatabase = `[\n  ${lines.join(",\n  ")}\n]`;

            // Ensure correct replacement of the old database
            let htmlContent = "<!DOCTYPE html>" + htmlDoc.outerHTML;
            htmlContent = htmlContent.replace(/let database = \[([\s\S]*?)\];/, `let database = ${formattedDatabase};`);

            let blob = new Blob([htmlContent], { type: "text/html" });
            let a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "worldweaver.html";
            a.click();
        }

        function enterAdminMode()
        {
            adminInterface.style.display = "flex";  // Show admin interface
            adminInputContainer.style.display = "flex";  // Show admin input field
            buildTreeView(true);
            adminInput.focus();  // Focus the admin input field
        }

        function buildTreeView(restoreExpansion)
        {
            // Save the currently expanded nodes
            expandedNodes.clear();

            if (restoreExpansion)
            {
                document.querySelectorAll("#treeview ul").forEach(ul => {
                    if (ul.style.display === "block") {
                        let parentLi = ul.closest("li");
                        if (parentLi && parentLi.dataset.key) {
                            expandedNodes.add(parentLi.dataset.key);
                        }
                    }
                });
            }

            if (newElementParentKey) {
                expandedNodes.add(newElementParentKey);
                newElementParentKey = "";
            }

            treeview.innerHTML = '<div style="padding: 5px; font-family: monospace;"><span id="close-all-tree" class="link" style="cursor: pointer; color: lightblue;">Close All</span></div>';
            let rootItems = database.filter(item => item.ParentKey === null);
            let ul = document.createElement("ul");
            rootItems.forEach(item => ul.appendChild(createTreeNode(item)));
            treeview.appendChild(ul);


            document.getElementById("close-all-tree").addEventListener("click", () => {
                buildTreeView(false);
            });
        }

        function createTreeNode(item)
        {
            let li = document.createElement("li");
            li.dataset.key = item.ElementKey; // Store the ElementKey as a dataset

            let container = document.createElement("div");
            container.style.display = "flex";
            container.style.alignItems = "center";
            container.style.gap = "0.4em";

            // Toggle marker
            let toggleSpan = document.createElement("span");
            toggleSpan.classList.add("tree-toggle");
            toggleSpan.textContent = ""; // placeholder — only populated if children exist

            // Main label (icon + name)
            let span = document.createElement("span");
            span.style.cursor = "pointer";

            // Determine which icon to use
            let iconHTML = "";
            switch (item.ElementType)
            {
                case "game": iconHTML = icoGame; break;
                case "player":
                case "npc": iconHTML = icoPlayer; break;
                case "room": iconHTML = icoRoom; break;
                case "object": iconHTML = icoObject; break;
                case "message":
                case "dev_note":
                case "enter_message": iconHTML = icoMessage; break;
                case "folder": iconHTML = icoFolder; break;
                case "action": iconHTML = icoAction; break;
                case "move":
                case "travel": iconHTML = icoMove; break;
                case "attack": iconHTML = icoAttack; break;
                case "global": iconHTML = icoGlobal; break;
                case "input": iconHTML = icoInput; break;
                case "logic": iconHTML = icoLogic; break;
                case "injection":
                case "link": iconHTML = icoInject; break;
                case "set": iconHTML = icoSet; break;
                case "navigation": iconHTML = icoNav; break;
                case "attribute": iconHTML = icoAttrib; break;
                default: iconHTML = icoOther; break;
            }

            // Set the inner HTML with the icon and text
            span.innerHTML = `${iconHTML} ${item.Name}`;

            // Label click handler
            span.addEventListener("click", (event) => {
                event.stopPropagation();
                showDetails(item);
                let childUl = li.querySelector("ul");
                if (childUl) {
                    let isExpanded = childUl.style.display === "block";
                    childUl.style.display = isExpanded ? "none" : "block";
                    toggleSpan.innerHTML = isExpanded ? icoTreeExp : icoTreeCol;
                    if (isExpanded) {
                        expandedNodes.delete(item.ElementKey);
                    } else {
                        expandedNodes.add(item.ElementKey);
                    }
                }
            });

            container.appendChild(toggleSpan);
            container.appendChild(span);
            li.appendChild(container);

            let children = database.filter(child => child.ParentKey === item.ElementKey);
            if (children.length > 0) {
                children.sort((a, b) => parseInt(a.Sort) - parseInt(b.Sort));

                let ul = document.createElement("ul");
                let isExpanded = expandedNodes.has(item.ElementKey);
                ul.style.display = isExpanded ? "block" : "none";

                // Set toggle visibility and label
                toggleSpan.innerHTML = isExpanded ? icoTreeCol : icoTreeExp;
                toggleSpan.style.cursor = "pointer";

                // Toggle click (same as span but just on the symbol)
                toggleSpan.addEventListener("click", (event) => {
                    event.stopPropagation();
                    let isNowExpanded = ul.style.display === "block";
                    ul.style.display = isNowExpanded ? "none" : "block";
                    toggleSpan.innerHTML = isNowExpanded ? icoTreeExp : icoTreeCol;
                    if (isNowExpanded) {
                        expandedNodes.delete(item.ElementKey);
                    } else {
                        expandedNodes.add(item.ElementKey);
                    }
                });

                children.forEach(child => ul.appendChild(createTreeNode(child)));
                li.appendChild(ul);
            }

            return li;
        }

        // Database Copying
        function openDatabaseModal() {
            const modal = document.getElementById('databaseModal');
            const textArea = document.getElementById('databaseText');

            // Make sure the latest database is stored
            let latestDatabase = JSON.parse(JSON.stringify(database)); // Deep clone to ensure correctness

            // Build compact JSON with newlines every elemLimit items
            let lines = [];
            for (let i = 0; i < latestDatabase.length; i += elemLimit) {
                let chunk = latestDatabase.slice(i, i + elemLimit);
                lines.push(JSON.stringify(chunk).slice(1, -1)); // Strip [ and ]
            }
            let formattedDatabase = `[\n  ${lines.join(",\n  ")}\n]`;

            textArea.value = "        let database = " + formattedDatabase + ";";
            modal.style.display = 'block';
        }

        function closeDatabaseModal() {
            document.getElementById('databaseModal').style.display = 'none';
        }

        function copyDatabase() {
            const textArea = document.getElementById('databaseText');
            textArea.select();
            document.execCommand("copy");
            alert("Database copied to clipboard!");
        }


        function isRegexString(str) {
            str = str.trim();

            // Shortcut: is it a valid /pattern/flags regex literal?
            const literalRegexPattern = /^\/(.|[\r\n])+\/[gimsuy]*$/;
            if (literalRegexPattern.test(str)) {
                try {
                    const lastSlash = str.lastIndexOf('/');
                    const pattern = str.slice(1, lastSlash);
                    const flags = str.slice(lastSlash + 1);
                    new RegExp(pattern, flags); // Confirm it's valid
                    return true;
                } catch (e) {
                    return false;
                }
            }

            // Fallback: does it *look like* a regex? Check for common regex features
            const likelyRegexFeatures = [
                /[\^\$\.\*\+\?\(\)\[\]\{\}\\]/,  // regex meta characters
                /\|/,                             // alternation
                /\(\?:/,                          // non-capturing group
                /\(\?=/,                          // positive lookahead
                /\(\?!/,                          // negative lookahead
            ];

            return likelyRegexFeatures.some((regex) => regex.test(str));
        }

        function isSpecialSyntax(str)
        {
            str = str.trim(); // Ensure no leading/trailing spaces
            const pattern = /^\[[a-zA-Z0-9_]+\]\(\([a-zA-Z0-9_]+\)\)/;
            const result = pattern.test(str);

            return result;
        }

        function escapeSpecialChars(str)
        {
            return str
                .replace(/[-\/\\^$+?.()|[\]{}]/g, "\\$&") // Escape special regex characters
                .replace(/\*/g, ".*"); // Convert * to .*
        }

        function showRegexLibrary() {
            const container = document.getElementById('regexTable');
            container.innerHTML = ''; // Clear previous content

            const table = document.createElement('table');
            table.style.borderCollapse = 'collapse';
            table.style.width = '100%';

            const header = document.createElement('tr');
            header.innerHTML = `
                <th style="border-bottom: 1px solid #ccc;"></th> <!-- + column -->
                <th style="border-bottom: 1px solid #ccc; text-align:left;">Description</th>
                <th style="border-bottom: 1px solid #ccc; text-align:left;">Regex</th>
            `;
            table.appendChild(header);

            regexLib.sort((a, b) => {
                // Compare the Description strings
                return a.Description.localeCompare(b.Description);
            });
            
            regexLib.forEach(entry => {
                const row = document.createElement('tr');
            
                // + Button Cell
                const buttonCell = document.createElement('td');
                buttonCell.style.padding = '4px';
            
                const addButton = document.createElement('button');
                addButton.textContent = '+';
                addButton.title = 'Insert into syntax field';
                addButton.onclick = () => {
                    const inputField = document.querySelector('input[type="text"]');
                    if (inputField) {
                        inputField.value = entry.Regex;
                        closeRegexLibrary();
                        inputField.focus();
                    }
                };
            
                buttonCell.appendChild(addButton);
            
                // Description and Regex Cells
                const descCell = document.createElement('td');
                descCell.style.padding = '4px';
                descCell.textContent = entry.Description;
            
                const regexCell = document.createElement('td');
                regexCell.style.padding = '4px';
                regexCell.style.fontFamily = 'monospace';
                regexCell.textContent = entry.Regex;
            
                // Append all cells in order
                row.appendChild(buttonCell);
                row.appendChild(descCell);
                row.appendChild(regexCell);
            
                table.appendChild(row);
            });

            container.appendChild(table);
            document.getElementById('regexDlg').style.display = 'block';
        }

        function closeRegexLibrary() {
            document.getElementById('regexDlg').style.display = 'none';
        }

        function showEditor(item, currentField)
        {
            editorContainer.innerHTML = `
                <div id="editor-close">X</div>
                <textarea id="editor"></textarea>
            `;

            let editor = document.getElementById("editor");
            let editorClose = document.getElementById("editor-close");
            document.getElementById("details").style.display = "none";
            document.getElementById("editor-container").style.display = "flex";
            const btn = document.getElementById("editor-close");

            switch (currentField)
            {
                case "logic":
                    if (item.Logic == null)
                    {
                        editor.value = "";
                    }
                    else
                    {
                        editor.value = item.Logic;
                    }
                    break;
                case "output":
                    if (item.Output == null)
                    {
                        editor.value = "";
                    }
                    else
                    {
                        editor.value = item.Output;
                    }
                    break;
            }
            editor.focus();

            editor.addEventListener("keydown", function(event) {
                if (event.key === "Escape") {
                    switch (currentField)
                    {
                        case "logic":
                            item.Logic = editor.value;
                            break;
                        case "output":
                            item.Output = editor.value;
                            break;
                    }
                    closeEditor(item);
                }
            });
            btn.addEventListener("click", function(event) {
                switch (currentField)
                {
                    case "logic":
                        item.Logic = editor.value;
                        break;
                    case "output":
                        item.Output = editor.value;
                        break;
                }
                closeEditor(item);
            });
        }

        function closeEditor(item)
        {
            document.getElementById("details").style.display = "block";
            document.getElementById("editor-container").style.display = "none";
            showDetails(item);
            adminInput.focus();  // Focus the admin input field
        }

        // !@! details
        function showDetails(item)
        {
            currentParent = item.ElementKey;
            
            let parentDropdown = `<select id="parentSelect">`;
            parentDropdown += `<option value="null" ${item.ParentKey === null ? "selected" : ""}>No Parent</option>`;
            database.forEach(otherItem => {
                if (otherItem.ElementKey !== item.ElementKey && otherItem.ElementType !== "attribute") {
                    parentDropdown += `<option value="${otherItem.ElementKey}" ${item.ParentKey === otherItem.ElementKey ? "selected" : ""}>${otherItem.Name}</option>`;
                }
            });
            parentDropdown += `</select>`;

            details.innerHTML = `
                <p><strong>Element Type:</strong><span id="element-type-parent"><span id="element-type" class="link">${item.ElementType || "Click to Edit"}</span></span></p>
                <p><strong>Element Key:</strong> <span id="element-key" class="link">${item.ElementKey}</span></p>
                <p><strong>Name:</strong> <span id="element-name" class="link">${item.Name || "Click to Edit"}</span></p>
                <!--p><strong>Parent Key:</strong> ${(item.ElementType != "game") ? parentDropdown : ""}</p -->
                <p><strong>Syntax:</strong> <span id="syntax-caption" class="link">${item.Syntax || "Click to Edit"}</span></p>
                <p><strong>Logic:</strong> <span id="logic-field" class="link">${item.Logic || "Click to View/Edit"}</span></p>
                <p><strong>Output:</strong> <span id="output-field" class="link">${(item.Output && item.Output.length > 100) ? item.Output.substring(0, 100)+"..." : item.Output || "Click to View/Edit"}</span></p>
                <p><strong>Tags:</strong> <span id="tags-field" class="link">${item.Tags || "Click to Edit"}</span></p>
                <p><strong>Repeat:</strong> <span id="repeat-field-parent"><span id="repeat-field" class="link">${item.Repeat || "Click to Edit"}</span><span></p>
                <p><strong>Active:</strong> <span><input id="element-active" type="checkbox" ${(item.Active === "true") ? "checked" : ""} /></span></p>
                <p><strong>Sort:</strong> <span id="sort-field" class="link">${item.Sort || "Click to Edit"}</span></p>
                <br />
                <p><span id="delete-element" class="link">Delete</span></p>
            `;

            document.getElementById("element-active").addEventListener("change", function() {
                if (document.getElementById("element-active").checked) {
                    item.Active = "true";
                } else {
                    item.Active = "false";
                }
            });

            // Handle inline editing for ElementKey
            document.getElementById("element-key").addEventListener("click", function() {
                let inputField = document.createElement("input");
                inputField.type = "text";
                inputField.value = item.ElementKey;
                inputField.style = "width: 200px";
                inputField.select();

                inputField.addEventListener("keypress", function(event) {
                    if (event.key === "Enter") {
                        let oldKey = item.ElementKey;
                        let newKey = inputField.value.trim();

                        if (newKey == "")
                        {
                            newKey = getGuid();
                        }

                        newKey = newKey.replace(" ", "_");
                        
                        if (newKey && !database.some(entry => entry.ElementKey === newKey))
                        {
                            let children = database.filter(item => item.ParentKey === oldKey);

                            for (child of children)
                            {
                                child.ParentKey = newKey;
                            }

                            // Update ElementKey in the database
                            item.ElementKey = newKey;
                            buildTreeView(true); // Rebuild tree view
                        }
                        
                        // Restore original ElementKey if not unique
                        showDetails(item);
                    }
                });

                inputField.addEventListener("keydown", function(event) {
                    if (event.key === "Escape") {
                        showDetails(item);
                    }
                });

                this.replaceWith(inputField);
                inputField.focus();
            });

            function showEditField(currItem, fieldName)
            {
                let parent = null;
                let textField = null;
                let inputField = document.createElement("input");
                inputField.type = "text";
                inputField.inputmode="text"

                switch(fieldName)
                {
                    case "name":
                        inputField.value = item.Name;
                        inputField.style = "width: 200px";
                        break;
                    case "sort":
                        inputField.type = "number";
                        inputField.value = item.Sort;
                        inputField.style = "width: 50px";
                        break;
                    case "tags":
                        inputField.value = item.Tags;
                        inputField.style = "width: 500px";
                        break;
                    case "repeat":
                        inputField = document.createElement("select");
                        const options = ["none", "random", "repeat", "other"];
                        options.forEach(option => {
                            let opt = document.createElement("option");
                            opt.value = option;
                            opt.textContent = option;
                            inputField.appendChild(opt);
                        });
                        inputField.value = item.Repeat;
                        parent = document.getElementById("repeat-field-parent");
                        
                        textField = document.createElement("input");
                        textField.type = "text";
                        textField.style.width = "100px";
                        
                        inputField.addEventListener("change", function() {
                            if (inputField.value === "other") {
                                if (parent) {
                                    parent.replaceChild(textField, inputField); // Replace dropdown with textbox
                                }
                                textField.value = item.Repeat;
                                textField.focus();
                                textField.select();

                                textField.addEventListener("keydown", function(event) {
                                    if (event.key === "Enter") {
                                        item.Repeat = textField.value.trim();
                                        buildTreeView(true);
                                        showDetails(item);
                                        return;
                                    }
                                    if (event.key === "Escape") {
                                        showDetails(item);
                                    }
                                });
                            } else {
                                item.Repeat = inputField.value;
                                buildTreeView(true);
                                showDetails(item);
                                return;
                            }
                        });
                        break;
                    case "type":
                        if (item.ElementType === "game" || item.ElementType === "player") {
                            showDetails(item);
                        }
                        inputField = document.createElement("select");
                        inputField.style.width = "200px";
                        elementTypes.forEach(option => {
                            let opt = document.createElement("option");
                            opt.value = option;
                            opt.textContent = option;
                            inputField.appendChild(opt);
                        });
                        inputField.value = item.ElementType;
                        parent = document.getElementById("element-type-parent");
                        
                        textField = document.createElement("input");
                        textField.type = "text";
                        textField.style.width = "200px";
                        
                        inputField.addEventListener("change", function() {
                            if (inputField.value === "custom") {
                                if (parent) {
                                    parent.replaceChild(textField, inputField); // Replace dropdown with textbox
                                }
                                textField.value = item.ElementType;
                                textField.focus();
                                textField.select();

                                textField.addEventListener("keydown", function(event) {
                                    if (event.key === "Enter") {
                                        item.ElementType = textField.value.trim();
                                        buildTreeView(true);
                                        showDetails(item);
                                        return;
                                    }
                                    if (event.key === "Escape") {
                                        showDetails(item);
                                    }
                                });
                            } else {
                                item.ElementType = inputField.value;
                                buildTreeView(true);
                                showDetails(item);
                                return;
                            }
                        });
                        break;
                }

                try {
                    inputField.select();
                }
                catch(err) {
                    // select not possible - likely due to it being a drop down
                }

                inputField.addEventListener("keypress", function(event) {
                    if (event.key === "Enter") {

                        switch(fieldName)
                        {
                            case "name":
                                item.Name = inputField.value.trim();
                                break;
                            case "sort":
                                item.Sort = inputField.value.trim();
                                break;
                            case "tags":
                                item.Tags = inputField.value.trim();
                                break;
                            case "repeat":
                                item.Repeat = inputField.value === "other" ? textField.value.trim() : inputField.value;
                                break;
                            case "type":
                                item.ElementType = inputField.value === "custom" ? textField.value.trim() : inputField.value;
                                break;
                        }

                        buildTreeView(true);
                        showDetails(item);
                    }
                });

                inputField.addEventListener("keydown", function(event) {
                    if (event.key === "Escape") {
                        showDetails(item);
                    }
                });

                currItem.replaceWith(inputField);
                inputField.focus();
            }

            // !@! delete
            function deleteElement(elementKey) {
                // Find all children of the element
                let children = database.filter(el => el.ParentKey === elementKey);

                // Recursively delete each child first
                for (let child of children) {
                    deleteElement(child.ElementKey);
                }

                // Now remove the element itself
                let index = database.findIndex(el => el.ElementKey === elementKey);
                if (index !== -1) {
                    database.splice(index, 1);
                }
            }

            // Handle inline editing for ElementType
            document.getElementById("element-type").addEventListener("click", function() {
                showEditField(this, "type");
            });

            // Handle inline editing for ElementName
            document.getElementById("element-name").addEventListener("click", function() {
                showEditField(this, "name");
            });

            // Handle inline editing for Tags
            document.getElementById("tags-field").addEventListener("click", function() {
                showEditField(this, "tags");
            });

            // Handle inline editing for Sort
            document.getElementById("sort-field").addEventListener("click", function() {
                showEditField(this, "sort");
            });

            // Handle inline editing for Repeat
            document.getElementById("repeat-field").addEventListener("click", function() {
                showEditField(this, "repeat");
            });

            // Add event listener for syntax caption click
            document.getElementById("syntax-caption").addEventListener("click", function() {
                let inputField = document.createElement("input");
                inputField.type = "text";
                inputField.value = item.Syntax || "";
                inputField.style = "width: 300px";

                const regexBtn = document.createElement('button');
                regexBtn.textContent = 'View All Regex';
                regexBtn.onclick = showRegexLibrary;

                inputField.select();
                inputField.addEventListener("keydown", function(event) {
                    if (event.key === "Enter") {
                        let inputText = inputField.value.trim();
                        if (inputText)
                        {
                            try {
                                if (isRegexString(inputText)) {
                                    item.Syntax = inputText;
                                    showDetails(item);
                                    return;
                                }

                                // If input is special syntax, store it as-is and exit
                                if (isSpecialSyntax(inputText)) {
                                    item.Syntax = inputText;
                                    showDetails(item);
                                    return; // Exit event listener
                                }

                                // Otherwise, process normally (escape and wildcard handling)
                                let escapedInput = inputText
                                    .split("|")
                                    .map(part => part.trim())
                                    .map(part => escapeSpecialChars(part)) // Escape regex special characters
                                    .join("|");

                                // Construct the regex string
                                let regexString = `(${escapedInput})`; // Match whole words
                                item.Syntax = regexString;

                                showDetails(item); // Update details view
                            } catch (error) {
                                alert("Error generating regex: " + error.message);
                            }
                        }
                        else
                        {
                            item.Syntax = "";
                            showDetails(item);
                        }

                    }
                });
                inputField.addEventListener("keydown", function(event) {
                    if (event.key === "Escape") {
                        showDetails(item);
                    }
                });

                const container = document.createElement("div");
                container.style.display = "flex";
                container.style.alignItems = "center";
                container.style.marginTop = "6px";
                container.style.gap = "0.5em";
                
                container.appendChild(inputField);
                container.appendChild(regexBtn);


                // Replace the caption with the input field
                this.replaceWith(container);
                inputField.focus();  // Focus on the input field
            });

            // Update parent key when selection changes
            if (document.getElementById("parentSelect")) {
                document.getElementById("parentSelect").addEventListener("change", function() {
                    let newParentKey = this.value === "null" ? null : this.value;
                    if (item.ParentKey !== newParentKey) {
                        item.ParentKey = newParentKey;
                        buildTreeView(true); // Rebuild the tree view after the parent key change
                    }
                });
            }

            document.getElementById("logic-field").addEventListener("click", function() {
                showEditor(item, "logic");
            });

            document.getElementById("output-field").addEventListener("click", function() {
                showEditor(item, "output");
            });

            // Handle delete
            document.getElementById("delete-element").addEventListener("click", function() {
                deleteElement(item.ElementKey);
                buildTreeView(true);
                details.innerHTML = "Select an item to see details.";
                adminInput.focus();
            });

            adminInput.focus();  // Focus the admin input field
        }

        // Events
        adminInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                let command = adminInput.value.trim();
                if (command) {
                    processAdminInput(command);
                }
                adminInput.value = "";
            }
        });
        window.onload = function() {
            // Ensure the database is not overwritten if it was injected from a saved file
            if (!Array.isArray(database) || database.length === 0) {
                database = [];
                createNewElement("game", "game", "Game", false, false);
                createNewElement("player", "player", "Player", false, false);
            }

            enterAdminMode();
        };
    </script>
</body></html>
